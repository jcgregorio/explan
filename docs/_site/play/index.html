<!doctype html>
<html>
  <head>
    <meta charset="UTF-8" />

    <style>
      body {
        --font: Roboto, Arial, 'Bitstream Vera Sans', sans-serif;
        --mono-font: Roboto Mono, monospace;

        background: var(--background);
        color: var(--on-background);
        margin: 0;
        padding: 0;
      }

      * {
        font-size: 14px;
        font-family: var(--font);
        box-sizing: border-box;
      }

      code,
      pre {
        font-family: var(--mono-font);
      }

      body.resizing {
        user-select: none;
      }

      select,
      option {
        border-radius: 4px;
        margin: 0;
        padding: 4px 4px;
        background-color: var(--surface);
        color: var(--on-surface);
        fill: var(--on-surface);
        line-height: 20px;
        vertical-align: middle;
      }

      select {
        border: solid 1px var(--on-surface);
        border-radius: 4px;
        overflow: hidden;
        margin: 8px;
      }

      option:hover {
        background-color: var(--surface-1dp);
      }

      option:focus {
        background-color: var(--primary);
        color: var(--on-primary);
        transition: background-color 0.1s cubic-bezier(0.4, 0, 0.2, 1);
      }

      option:checked {
        background-color: var(--primary);
        color: var(--on-primary);
        fill: var(--on-primary);
      }

      select {
        overflow-y: auto;
      }

      .input-like,
      input {
        border: solid 1px var(--on-surface);
        color: var(--on-surface);
        background: var(--surface);
        display: inline-block;
        border-radius: 4px;
        margin: 4px 2px;
        padding: 4px 4px;
      }

      .button-like,
      button {
        align-items: center;
        background: transparent;
        border-radius: 4px;
        border: solid 1px var(--on-surface);
        box-shadow: none;
        color: var(--on-surface);
        display: inline-flex;
        fill: var(--on-surface);
        font-size: 14px;
        height: 24px;
        justify-content: center;
        margin: 4px 2px;
        min-width: auto;
        padding: 0 4px;
        text-align: center;
        text-transform: none;

        svg {
          width: 20px;
          height: 20px;
        }
      }

      .button-like:hover,
      button.hover,
      button:hover,
      .button-like:focus,
      button.focus,
      button:focus {
        opacity: 0.85;
        outline: none;
        background-color: var(--surface-1dp);
      }

      .button-like:disabled,
      button:disabled {
        opacity: 0.85;
        background: var(--on-disabled);
        color: var(--disabled);
        fill: var(--disabled);
      }

      .button-like-action,
      .button-like.action,
      button.action {
        color: var(--on-primary);
        fill: var(--on-primary);
        border: none;
        background-color: var(--primary);
      }

      .button-like.action:hover,
      button.action.hover,
      button.action:hover {
        opacity: 0.85;
      }

      .button-like.action:disabled,
      button.action.disabled,
      button.action:disabled {
        opacity: 0.85;
        background: var(--on-disabled);
        color: var(--disabled);
        fill: var(--disabled);
      }

      chart-parent {
        grid-area: chart;
        overflow-y: scroll;
        scrollbar-color: var(--transparent-overlay) rgb(0, 0, 0, 0);
      }

      timeline-parent {
        grid-area: timeline;
        overflow-y: scroll;
        scrollbar-color: rgb(0, 0, 0, 0) rgb(0, 0, 0, 0);
      }

      #overlay {
        position: absolute;
        top: 0;
        left: 0;
      }

      vertical-divider {
        grid-area: vertical-divider;
        display: flex;
        flex-direction: column;
        cursor: col-resize;
        justify-content: center;

        divider-thumb {
          display: inline-block;
          background:
            linear-gradient(315deg, transparent 75%, #414141 0)-10px 0,
            linear-gradient(45deg, transparent 75%, #d1d1d1 0)-10px 0,
            linear-gradient(135deg, #b1b1b1 50%, transparent 0) 0 0,
            linear-gradient(45deg, #515050 50%, #2d2d2d 0) 0 0 #313030;
          background-size: 4px 4px;
          height: 40px;
        }
      }

      panels-parent {
        grid-area: panels;

        ul li {
          cursor: pointer;
        }
      }

      header {
        grid-area: header;
      }

      footer {
        grid-area: footer;
      }

      explan-main {
        display: grid;
        grid-gap: 0;
        grid-template-columns: 70% 10px auto;
        grid-template-rows: auto auto 1fr auto;
        grid-template-areas:
          'header   header           header'
          'timeline vertical-divider panels'
          'chart    vertical-divider panels'
          'footer   footer           footer';

        width: 100vw;
        height: 100vh;
        margin: 0;
        padding: 0;
        position: absolute;
      }

      error-popup {
        padding: 16px;
        border: solid 1px;
        border-radius: 8px;
        display: flex;
        position: absolute;
        bottom: 16px;
        left: 16px;
        align-items: center;
        justify-content: space-between;
        gap: 8px;
        animation-name: popup;
        animation-duration: 0.5s;
      }

      @keyframes popup {
        from {
          bottom: 0;
        }

        to {
          bottom: 16px;
        }
      }

      chart-parent,
      timeline-parent,
      radar-parent,
      chart-parent {
        display: flex;
        position: relative;
      }

      search-task-panel {
        border-bottom: solid 1px var(--on-surface-muted);
        display: block;
      }

      selected-task-panel,
      dependencies-panel,
      task-completion-panel,
      simulation-panel {
        display: block;
        padding: 8px;

        .aligned-td {
          display: flex;
          align-items: center;
        }
      }

      selected-task-panel td.task-description {
        display: flex;

        p a {
          color: var(--on-surface-muted);
        }
      }

      image-export-panel {
        input:invalid {
          background-color: var(--error);
          color: var(--on-error);
        }
      }

      panels-parent {
        display: block;

        tab-buttons {
          display: block;
          padding-left: 12px;

          button {
            opacity: 0.7;
          }

          button.selected {
            opacity: 1;
          }
        }

        tab-panel {
          display: block;
          background-color: var(--surface);
          margin-top: 0;
          padding: 12px;
          border-radius: 12px;
          margin: 8px 16px 8px 8px;

          h3 {
            margin-top: 0;
          }
        }
      }

      nav {
        display: flex;
        padding: 8px;
        justify-content: space-between;

        button.icon-button {
          background: var(--background);
          border: none;
        }
      }

      .hidden {
        display: none;
      }

      button[disabled] {
        color: var(--disabled);
        fill: var(--disabled);
      }

      task-search-control {
        ul {
          list-style-type: none;
          padding-inline-start: 4px;

          li {
            font-family: 'Courier New', Courier, monospace;

            b {
              color: var(--primary);
            }
          }

          li[data-focus] {
            color: var(--primary);
          }

          li:hover {
            text-decoration: underline;
          }
        }

        ul {
          display: none;
        }

        &:focus-within ul {
          display: block;
        }
      }

      dependencies-panel {
        display: block;

        th {
          text-align: left;
        }

        button.delete {
          border-radius: 2px;
          border: solid 1px var(--surface);
          background: var(--surface);
          color: var(--on-surface);

          &:hover {
            border: solid 1px var(--on-surface-muted);
          }

          &:active {
            background: var(--surface-1dp);
          }
        }
      }

      simulation-panel {
        .added {
          color: var(--added);
        }

        .removed {
          color: var(--removed);
        }

        table.paths td {
          cursor: pointer;
        }
      }

      plan-config-panel > div {
        margin-left: 8px;
      }

      edit-metrics-panel,
      edit-resources-panel {
        td,
        th {
          padding: 8px;
          text-align: left;
        }
      }

      .icon-button {
        background-color: var(--surface);
        border-radius: 2px;
        border: solid 1px var(--surface);
        background: var(--surface);
        color: var(--on-surface);
        fill: var(--on-surface-muted);

        &:hover {
          border: dashed 1px var(--on-surface-muted);
        }

        &:active {
          background: var(--surface-1dp);
        }
      }

      dialog {
        background: var(--surface);
        color: var(--on-surface);

        .dialog-footer {
          display: flex;
          flex-direction: row;
          justify-content: right;
          padding: 16px 0 0 0;
        }
      }

      .underline-first-char:first-letter {
        text-decoration: underline;
      }

      #project-tab {
        h3 {
          margin-top: 8px;
          text-decoration: underline;
        }
      }

      body {
        --primary: hsl(214, 70%, 47%);
        --on-primary: #ffffff;
        --primary-variant: rgba(59, 114, 177, 0.2);
        --on-primary-variant: #000000;
        --secondary: hsl(136, 54%, 40%);
        --secondary-variant: hsl(137, 7%, 79%);
        --on-secondary: #000000;
        --background: #fafafa;
        --on-background: #000000;
        --surface: #ffffff;
        --on-surface: #000000;
        --on-surface-muted: hsl(0, 0%, 24%);
        --surface-1dp: #eee;
        --surface-2dp: #bdbdbd;
        --disabled: #f5f5f5;
        --on-disabled: #616161;
        --error: #b71c1c;
        --on-error: #ffffff;
        --transparent-overlay: rgba(0, 0, 0, 0.25);
        --group-color: rgba(90, 206, 6, 0.15);

        --added: rgba(24, 132, 47);
        --removed: rgba(175, 15, 29);
      }

      body.darkmode {
        --primary: hsl(210, 72%, 45%);
        --on-primary: #000000;
        --primary-variant: rgba(59, 114, 177, 0.2);
        --on-primary-variant: #ffffff;
        --secondary: hsl(146, 75%, 33%);
        --secondary-variant: hsl(150, 2%, 22%);
        --on-secondary: #000000;
        --background: #000000;
        --on-background: #ffffff;
        --surface: #0f0f0f;
        --surface-1dp: #424242;
        --surface-2dp: #616161;
        --disabled: #757575;
        --on-disabled: #e0e0e0;
        --on-surface: #ffffff;
        --on-surface-muted: hsl(0, 0%, 74%);
        --error: #ec407a;
        --on-error: #000000;
        --transparent-overlay: rgba(255, 255, 255, 0.1);
        --group-color: rgba(89, 206, 6, 0.1);

        --added: rgb(36, 180, 67);
        --removed: rgb(227, 22, 39);
      }
    </style>
  </head>

  <body class="darkmode">
    <!-- These are hidden because they are never displayed, but used as templates
    for actual icons via the <use> tag. See `/icons/icons.ts`.

    Icons copied from https://github.com/marella/material-design-icons/blob/main/svg/filled/.
    View all icons here: https://fonts.google.com/icons
    -->
    <svg
      xmlns="http://www.w3.org/2000/svg"
      width="24"
      height="24"
      viewBox="0 0 24 24"
      style="display: none"
    >
      <path
        id="delete-icon"
        d="M16 9v10H8V9h8m-1.5-6h-5l-1 1H5v2h14V4h-3.5l-1-1zM18 7H6v12c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7z"
      />
      <path
        id="edit-icon"
        d="m14.06 9.02.92.92L5.92 19H5v-.92l9.06-9.06M17.66 3c-.25 0-.51.1-.7.29l-1.83 1.83 3.75 3.75 1.83-1.83a.996.996 0 0 0 0-1.41l-2.34-2.34c-.2-.2-.45-.29-.71-.29zm-3.6 3.19L3 17.25V21h3.75L17.81 9.94l-3.75-3.75z"
      />
      <path
        id="keyboard-up-icon"
        d="M7.41 15.41 12 10.83l4.59 4.58L18 14l-6-6-6 6 1.41 1.41z"
      />
      <path
        id="keyboard-down-icon"
        d="M7.41 8.59 12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z"
      />
      <g id="keyboard-double-up-icon">
        <path d="M6 17.59 7.41 19 12 14.42 16.59 19 18 17.59l-6-6z" />
        <path d="m6 11 1.41 1.41L12 7.83l4.59 4.58L18 11l-6-6z" />
      </g>
      <g id="keyboard-double-down-icon">
        <path d="M18 6.41 16.59 5 12 9.58 7.41 5 6 6.41l6 6z" />
        <path d="m18 13-1.41-1.41L12 16.17l-4.59-4.58L6 13l6 6z" />
      </g>
      <path id="add-icon" d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z" />
      <path id="check" d="M9 16.17 4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z" />
      <path
        id="dup"
        d="M18 4v5H6V4h12m0-2H6c-1.1 0-2 .9-2 2v5c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 13v5H6v-5h12m0-2H6c-1.1 0-2 .9-2 2v5c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2v-5c0-1.1-.9-2-2-2z"
      />
      <g id="split">
        <path
          d="M 0.046875 7.65625 L 0.046875 9.65625 L 9.4003906 9.65625 L 9.4003906 14.65625 L 0.046875 14.65625 L 0.046875 16.65625 L 9.4003906 16.65625 C 10.50039 16.65625 11.400391 15.756249 11.400391 14.65625 L 11.400391 9.65625 C 11.400391 8.5562511 10.50039 7.65625 9.4003906 7.65625 L 0.046875 7.65625 z "
        />
        <path
          d="M 15.429688 7.6289062 C 14.329689 7.6289062 13.429688 8.5289073 13.429688 9.6289062 L 13.429688 14.628906 C 13.429688 15.728905 14.329689 16.628906 15.429688 16.628906 L 24.046875 16.628906 L 24.046875 14.628906 L 15.429688 14.628906 L 15.429688 9.6289062 L 24.046875 9.6289062 L 24.046875 7.6289062 L 15.429688 7.6289062 z "
        />
      </g>
      <path
        id="calculate"
        d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-5.97 4.06L14.09 6l1.41 1.41L16.91 6l1.06 1.06-1.41 1.41 1.41 1.41-1.06 1.06-1.41-1.4-1.41 1.41-1.06-1.06 1.41-1.41-1.41-1.42zm-6.78.66h5v1.5h-5v-1.5zM11.5 16h-2v2H8v-2H6v-1.5h2v-2h1.5v2h2V16zm6.5 1.25h-5v-1.5h5v1.5zm0-2.5h-5v-1.5h5v1.5z"
      />
    </svg>
    <explan-main>
      <header>
        <nav>
          <span>
            <label> Group by <groupby-control></groupby-control> </label>
            <label>
              <input type="checkbox" id="radar-toggle" checked />
              Show radar.
            </label>
            <label>
              <input type="checkbox" id="critical-paths-toggle" />
              Only show critical paths
            </label>
            <span id="download-controls">
              <button id="download-button">Download PNG</button>
              <button id="download-json">Download JSON</button>
              <a id="download-link" download="plan.png" class="hidden" href=""
                >Download</a
              >
            </span>
            <label id="upload">
              Upload
              <input
                type="file"
                id="file-upload"
                accept="image/png, application/json"
            /></label>
            <button id="catchup">Catch Up</button>
          </span>
          <button
            id="dark-mode-toggle"
            class="icon-button"
            title="Toggle between light mode and dark mode."
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="24"
              height="24"
              viewBox="0 0 24 24"
            >
              <path
                id="invert-colors"
                d="M12 4.81V19c-3.31 0-6-2.63-6-5.87 0-1.56.62-3.03 1.75-4.14L12 4.81M6.35 7.56C4.9 8.99 4 10.96 4 13.13 4 17.48 7.58 21 12 21s8-3.52 8-7.87c0-2.17-.9-4.14-2.35-5.57L12 2 6.35 7.56z"
              />
            </svg>
          </button>
        </nav>
        <radar-parent>
          <canvas id="radar" width="1000" height="1000"></canvas>
        </radar-parent>
      </header>
      <timeline-parent>
        <canvas id="timeline" width="1000" height="1000"></canvas>
      </timeline-parent>
      <chart-parent>
        <canvas id="zoomed" width="1000" height="1000"></canvas>
        <canvas id="overlay" width="1000" height="1000"></canvas>
      </chart-parent>
      <vertical-divider>
        <divider-thumb></divider-thumb>
      </vertical-divider>
      <panels-parent>
        <tab-buttons>
          <button data-target="task-tab" class="selected">Task</button>
          <button data-target="project-tab">Project</button>
          <button data-target="simulate-tab">Simulation</button>
          <button data-target="config-tab">Config</button>
        </tab-buttons>
        <tab-panel id="task-tab">
          <search-task-panel class="hidden">
            <task-search-control></task-search-control>
          </search-task-panel>
          <selected-task-panel> </selected-task-panel>
          <task-completion-panel> </task-completion-panel>
          <dependencies-panel> </dependencies-panel>
        </tab-panel>
        <tab-panel id="project-tab" class="hidden">
          <plan-config-panel> </plan-config-panel>
          <edit-resources-panel> </edit-resources-panel>
          <edit-metrics-panel> </edit-metrics-panel>
        </tab-panel>
        <tab-panel id="simulate-tab" class="hidden">
          <button id="simulate">Simulate</button>
          <simulation-panel> </simulation-panel>
        </tab-panel>
        <tab-panel id="config-tab" class="hidden">
          <image-export-panel> </image-export-panel>
        </tab-panel>
      </panels-parent>
      <footer></footer>
      <keyboard-map-dialog> </keyboard-map-dialog>
      <add-dependency-dialog>
        <dialog>
          <h2>Predecessor/Successor</h2>
          <task-search-control></task-search-control>
        </dialog>
      </add-dependency-dialog>
      <edit-resource-definition> </edit-resource-definition>
      <edit-metric-definition> </edit-metric-definition>
      <developer-panel> </developer-panel>
      <error-popup class="hidden"> </error-popup>
      <prompt-dialog>
        <dialog>
          <h3></h3>
          <input type="text" />
          <div class="dialog-footer">
            <button id="prompt-cancel">Cancel</button>
            <button id="prompt-ok">OK</button>
          </div>
        </dialog>
      </prompt-dialog>
      <edit-description-dialog>
        <dialog>
          <h3>Description</h3>
          <textarea rows="5" cols="80"> </textarea>
          <div class="dialog-footer">
            <button id="description-cancel">Cancel</button>
            <button id="description-ok">OK</button>
          </div>
        </dialog>
      </edit-description-dialog>
    </explan-main>
    
    <script type="module">
      "use strict";(()=>{var ja=Object.create;var io=Object.defineProperty;var Wa=Object.getOwnPropertyDescriptor;var qa=Object.getOwnPropertyNames;var Ka=Object.getPrototypeOf,Ga=Object.prototype.hasOwnProperty;var Ja=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports);var Xa=(n,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of qa(e))!Ga.call(n,i)&&i!==t&&io(n,i,{get:()=>e[i],enumerable:!(r=Wa(e,i))||r.enumerable});return n};var Ya=(n,e,t)=>(t=n!=null?ja(Ka(n)):{},Xa(e||!n||!n.__esModule?io(t,"default",{value:n,enumerable:!0}):t,n));var Sa=Ja((Ea,xi)=>{((n,e)=>{typeof define=="function"&&define.amd?define([],e):typeof xi=="object"&&xi.exports?xi.exports=e():n.fuzzysort=e()})(Ea,n=>{"use strict";var e=(f,c)=>{if(!f||!c)return Q;var y=T(f);ue(c)||(c=m(c));var M=y.bitflags;return(M&c._bitflags)!==M?Q:P(y,c)},t=(f,c,y)=>{if(!f)return y?.all?S(c,y):pt;var M=T(f),E=M.bitflags,x=M.containsSpace,b=u(y?.threshold||0),w=y?.limit||ke,R=0,_=0,L=c.length;function q(mt){R<w?(Dt.add(mt),++R):(++_,mt._score>Dt.peek()._score&&Dt.replaceTop(mt))}if(y?.key)for(var K=y.key,F=0;F<L;++F){var de=c[F],j=Re(de,K);if(j&&(ue(j)||(j=m(j)),(E&j._bitflags)===E)){var G=P(M,j);G!==Q&&(G._score<b||(G.obj=de,q(G)))}}else if(y?.keys){var it=y.keys,De=it.length;e:for(var F=0;F<L;++F){var de=c[F];{for(var he=0,B=0;B<De;++B){var K=it[B],j=Re(de,K);if(!j){Be[B]=rt;continue}ue(j)||(j=m(j)),Be[B]=j,he|=j._bitflags}if((E&he)!==E)continue}if(x)for(let W=0;W<M.spaceSearches.length;W++)ce[W]=ee;for(var B=0;B<De;++B){if(j=Be[B],j===rt){ge[B]=rt;continue}if(ge[B]=P(M,j,!1,x),ge[B]===Q){ge[B]=rt;continue}if(x)for(let J=0;J<M.spaceSearches.length;J++){if(ve[J]>-1e3&&ce[J]>ee){var ae=(ce[J]+ve[J])/4;ae>ce[J]&&(ce[J]=ae)}ve[J]>ce[J]&&(ce[J]=ve[J])}}if(x){for(let W=0;W<M.spaceSearches.length;W++)if(ce[W]===ee)continue e}else{var U=!1;for(let W=0;W<De;W++)if(ge[W]._score!==ee){U=!0;break}if(!U)continue}var Te=new a(De);for(let W=0;W<De;W++)Te[W]=ge[W];if(x){var ie=0;for(let W=0;W<M.spaceSearches.length;W++)ie+=ce[W]}else{var ie=ee;for(let J=0;J<De;J++){var G=Te[J];if(G._score>-1e3&&ie>ee){var ae=(ie+G._score)/4;ae>ie&&(ie=ae)}G._score>ie&&(ie=G._score)}}if(Te.obj=de,Te._score=ie,y?.scoreFn){if(ie=y.scoreFn(Te),!ie)continue;ie=u(ie),Te._score=ie}ie<b||q(Te)}}else for(var F=0;F<L;++F){var j=c[F];if(j&&(ue(j)||(j=m(j)),(E&j._bitflags)===E)){var G=P(M,j);G!==Q&&(G._score<b||q(G))}}if(R===0)return pt;for(var st=new Array(R),F=R-1;F>=0;--F)st[F]=Dt.poll();return st.total=R+_,st},r=(f,c="<b>",y="</b>")=>{for(var M=typeof c=="function"?c:void 0,E=f.target,x=E.length,b=f.indexes,w="",R=0,_=0,L=!1,q=[],K=0;K<x;++K){var F=E[K];if(b[_]===K){if(++_,L||(L=!0,M?(q.push(w),w=""):w+=c),_===b.length){M?(w+=F,q.push(M(w,R++)),w="",q.push(E.substr(K+1))):w+=F+y+E.substr(K+1);break}}else L&&(L=!1,M?(q.push(M(w,R++)),w=""):w+=y);w+=F}return M?q:w},i=f=>{typeof f=="number"?f=""+f:typeof f!="string"&&(f="");var c=$(f);return l(f,{_targetLower:c._lower,_targetLowerCodes:c.lowerCodes,_bitflags:c.bitflags})},s=()=>{O.clear(),we.clear()};class o{get indexes(){return this._indexes.slice(0,this._indexes.len).sort((c,y)=>c-y)}set indexes(c){return this._indexes=c}highlight(c,y){return r(this,c,y)}get score(){return h(this._score)}set score(c){this._score=u(c)}}class a extends Array{get score(){return h(this._score)}set score(c){this._score=u(c)}}var l=(f,c)=>{let y=new o;return y.target=f,y.obj=c.obj??Q,y._score=c._score??ee,y._indexes=c._indexes??[],y._targetLower=c._targetLower??"",y._targetLowerCodes=c._targetLowerCodes??Q,y._nextBeginningIndexes=c._nextBeginningIndexes??Q,y._bitflags=c._bitflags??0,y},h=f=>f===ee?0:f>1?f:Math.E**(((-f+1)**.04307-1)*-2),u=f=>f===0?ee:f>1?f:1-Math.pow(Math.log(f)/-2+1,1/.04307),p=f=>{typeof f=="number"?f=""+f:typeof f!="string"&&(f=""),f=f.trim();var c=$(f),y=[];if(c.containsSpace){var M=f.split(/\s+/);M=[...new Set(M)];for(var E=0;E<M.length;E++)if(M[E]!==""){var x=$(M[E]);y.push({lowerCodes:x.lowerCodes,_lower:M[E].toLowerCase(),containsSpace:!1})}}return{lowerCodes:c.lowerCodes,_lower:c._lower,containsSpace:c.containsSpace,bitflags:c.bitflags,spaceSearches:y}},m=f=>{if(f.length>999)return i(f);var c=O.get(f);return c!==void 0||(c=i(f),O.set(f,c)),c},T=f=>{if(f.length>999)return p(f);var c=we.get(f);return c!==void 0||(c=p(f),we.set(f,c)),c},S=(f,c)=>{var y=[];y.total=f.length;var M=c?.limit||ke;if(c?.key)for(var E=0;E<f.length;E++){var x=f[E],b=Re(x,c.key);if(b!=Q){ue(b)||(b=m(b));var w=l(b.target,{_score:b._score,obj:x});if(y.push(w),y.length>=M)return y}}else if(c?.keys)for(var E=0;E<f.length;E++){for(var x=f[E],R=new a(c.keys.length),_=c.keys.length-1;_>=0;--_){var b=Re(x,c.keys[_]);if(!b){R[_]=rt;continue}ue(b)||(b=m(b)),b._score=ee,b._indexes.len=0,R[_]=b}if(R.obj=x,R._score=ee,y.push(R),y.length>=M)return y}else for(var E=0;E<f.length;E++){var b=f[E];if(b!=Q&&(ue(b)||(b=m(b)),b._score=ee,b._indexes.len=0,y.push(b),y.length>=M))return y}return y},P=(f,c,y=!1,M=!1)=>{if(y===!1&&f.containsSpace)return C(f,c,M);for(var E=f._lower,x=f.lowerCodes,b=x[0],w=c._targetLowerCodes,R=x.length,_=w.length,F=0,L=0,q=0;;){var K=b===w[L];if(K){if(me[q++]=L,++F,F===R)break;b=x[F]}if(++L,L>=_)return Q}var F=0,de=!1,j=0,G=c._nextBeginningIndexes;G===Q&&(G=c._nextBeginningIndexes=Se(c.target)),L=me[0]===0?0:G[me[0]-1];var it=0;if(L!==_)for(;;)if(L>=_){if(F<=0||(++it,it>200))break;--F;var De=nt[--j];L=G[De]}else{var K=x[F]===w[L];if(K){if(nt[j++]=L,++F,F===R){de=!0;break}++L}else L=G[L]}var he=R<=1?-1:c._targetLower.indexOf(E,me[0]),B=!!~he,ae=B?he===0||c._nextBeginningIndexes[he-1]===he:!1;if(B&&!ae){for(var U=0;U<G.length;U=G[U])if(!(U<=he)){for(var Te=0;Te<R&&x[Te]===c._targetLowerCodes[U+Te];Te++);if(Te===R){he=U,ae=!0;break}}}var ie=W=>{for(var J=0,ro=0,ze=1;ze<R;++ze)W[ze]-W[ze-1]!==1&&(J-=W[ze],++ro);var za=W[R-1]-W[0]-(R-1);if(J-=(12+za)*ro,W[0]!==0&&(J-=W[0]*W[0]*.2),!de)J*=1e3;else{for(var Di=1,ze=G[0];ze<_;ze=G[ze])++Di;Di>24&&(J*=(Di-24)*10)}return J-=(_-R)/2,B&&(J/=1+R*R*1),ae&&(J/=1+R*R*1),J-=(_-R)/2,J};if(de)if(ae){for(var U=0;U<R;++U)me[U]=he+U;var st=me,mt=ie(me)}else var st=nt,mt=ie(nt);else{if(B)for(var U=0;U<R;++U)me[U]=he+U;var st=me,mt=ie(st)}c._score=mt;for(var U=0;U<R;++U)c._indexes[U]=st[U];c._indexes.len=R;let xn=new o;return xn.target=c.target,xn._score=c._score,xn._indexes=c._indexes,xn},C=(f,c,y)=>{for(var M=new Set,E=0,x=Q,b=0,w=f.spaceSearches,R=w.length,_=0,L=()=>{for(let ae=_-1;ae>=0;ae--)c._nextBeginningIndexes[Fe[ae*2+0]]=Fe[ae*2+1]},q=!1,B=0;B<R;++B){ve[B]=ee;var K=w[B];if(x=P(K,c),y){if(x===Q)continue;q=!0}else if(x===Q)return L(),Q;var F=B===R-1;if(!F){var de=x._indexes,j=!0;for(let U=0;U<de.len-1;U++)if(de[U+1]-de[U]!==1){j=!1;break}if(j){var G=de[de.len-1]+1,it=c._nextBeginningIndexes[G-1];for(let U=G-1;U>=0&&it===c._nextBeginningIndexes[U];U--)c._nextBeginningIndexes[U]=G,Fe[_*2+0]=U,Fe[_*2+1]=it,_++}}E+=x._score/R,ve[B]=x._score/R,x._indexes[0]<b&&(E-=(b-x._indexes[0])*2),b=x._indexes[0];for(var De=0;De<x._indexes.len;++De)M.add(x._indexes[De])}if(y&&!q)return Q;L();var he=P(f,c,!0);if(he!==Q&&he._score>E){if(y)for(var B=0;B<R;++B)ve[B]=he._score/R;return he}y&&(x=c),x._score=E;var B=0;for(let ae of M)x._indexes[B++]=ae;return x._indexes.len=B,x},A=f=>f.replace(/\p{Script=Latin}+/gu,c=>c.normalize("NFD")).replace(/[\u0300-\u036f]/g,""),$=f=>{f=A(f);for(var c=f.length,y=f.toLowerCase(),M=[],E=0,x=!1,b=0;b<c;++b){var w=M[b]=y.charCodeAt(b);if(w===32){x=!0;continue}var R=w>=97&&w<=122?w-97:w>=48&&w<=57?26:w<=127?30:31;E|=1<<R}return{lowerCodes:M,bitflags:E,containsSpace:x,_lower:y}},tt=f=>{for(var c=f.length,y=[],M=0,E=!1,x=!1,b=0;b<c;++b){var w=f.charCodeAt(b),R=w>=65&&w<=90,_=R||w>=97&&w<=122||w>=48&&w<=57,L=R&&!E||!x||!_;E=R,x=_,L&&(y[M++]=b)}return y},Se=f=>{f=A(f);for(var c=f.length,y=tt(f),M=[],E=y[0],x=0,b=0;b<c;++b)E>b?M[b]=E:(E=y[++x],M[b]=E===void 0?c:E);return M},O=new Map,we=new Map,me=[],nt=[],Fe=[],ce=[],ve=[],Be=[],ge=[],Re=(f,c)=>{var y=f[c];if(y!==void 0)return y;if(typeof c=="function")return c(f);var M=c;Array.isArray(c)||(M=c.split("."));for(var E=M.length,x=-1;f&&++x<E;)f=f[M[x]];return f},ue=f=>typeof f=="object"&&typeof f._bitflags=="number",ke=1/0,ee=-ke,pt=[];pt.total=0;var Q=null,rt=i(""),Bt=f=>{var c=[],y=0,M={},E=x=>{for(var b=0,w=c[b],R=1;R<y;){var _=R+1;b=R,_<y&&c[_]._score<c[R]._score&&(b=_),c[b-1>>1]=c[b],R=1+(b<<1)}for(var L=b-1>>1;b>0&&w._score<c[L]._score;L=(b=L)-1>>1)c[b]=c[L];c[b]=w};return M.add=x=>{var b=y;c[y++]=x;for(var w=b-1>>1;b>0&&x._score<c[w]._score;w=(b=w)-1>>1)c[b]=c[w];c[b]=x},M.poll=x=>{if(y!==0){var b=c[0];return c[0]=c[--y],E(),b}},M.peek=x=>{if(y!==0)return c[0]},M.replaceTop=x=>{c[0]=x,E()},M},Dt=Bt();return{single:e,go:t,prepare:i,cleanup:s}})});var Ci=globalThis,En=Ci.trustedTypes,so=En?En.createPolicy("lit-html",{createHTML:n=>n}):void 0,Ai="$lit$",je=`lit$${Math.random().toFixed(9).slice(2)}$`,Pi="?"+je,Qa=`<${Pi}>`,bt=document,jt=()=>bt.createComment(""),Wt=n=>n===null||typeof n!="object"&&typeof n!="function",Oi=Array.isArray,ho=n=>Oi(n)||typeof n?.[Symbol.iterator]=="function",Mi=`[ 	
\f\r]`,zt=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,oo=/-->/g,ao=/>/g,ft=RegExp(`>|${Mi}(?:([^\\s"'>=/]+)(${Mi}*=${Mi}*(?:[^ 	
\f\r"'\`<>=]|("|')|))|$)`,"g"),lo=/'/g,co=/"/g,po=/^(?:script|style|textarea|title)$/i,Li=n=>(e,...t)=>({_$litType$:n,strings:e,values:t}),k=Li(1),ac=Li(2),lc=Li(3),Me=Symbol.for("lit-noChange"),te=Symbol.for("lit-nothing"),uo=new WeakMap,gt=bt.createTreeWalker(bt,129);function mo(n,e){if(!Oi(n)||!n.hasOwnProperty("raw"))throw Error("invalid template strings array");return so!==void 0?so.createHTML(e):e}var fo=(n,e)=>{let t=n.length-1,r=[],i,s=e===2?"<svg>":e===3?"<math>":"",o=zt;for(let a=0;a<t;a++){let l=n[a],h,u,p=-1,m=0;for(;m<l.length&&(o.lastIndex=m,u=o.exec(l),u!==null);)m=o.lastIndex,o===zt?u[1]==="!--"?o=oo:u[1]!==void 0?o=ao:u[2]!==void 0?(po.test(u[2])&&(i=RegExp("</"+u[2],"g")),o=ft):u[3]!==void 0&&(o=ft):o===ft?u[0]===">"?(o=i??zt,p=-1):u[1]===void 0?p=-2:(p=o.lastIndex-u[2].length,h=u[1],o=u[3]===void 0?ft:u[3]==='"'?co:lo):o===co||o===lo?o=ft:o===oo||o===ao?o=zt:(o=ft,i=void 0);let T=o===ft&&n[a+1].startsWith("/>")?" ":"";s+=o===zt?l+Qa:p>=0?(r.push(h),l.slice(0,p)+Ai+l.slice(p)+je+T):l+je+(p===-2?a:T)}return[mo(n,s+(n[t]||"<?>")+(e===2?"</svg>":e===3?"</math>":"")),r]},qt=class n{constructor({strings:e,_$litType$:t},r){let i;this.parts=[];let s=0,o=0,a=e.length-1,l=this.parts,[h,u]=fo(e,t);if(this.el=n.createElement(h,r),gt.currentNode=this.el.content,t===2||t===3){let p=this.el.content.firstChild;p.replaceWith(...p.childNodes)}for(;(i=gt.nextNode())!==null&&l.length<a;){if(i.nodeType===1){if(i.hasAttributes())for(let p of i.getAttributeNames())if(p.endsWith(Ai)){let m=u[o++],T=i.getAttribute(p).split(je),S=/([.?@])?(.*)/.exec(m);l.push({type:1,index:s,name:S[2],strings:T,ctor:S[1]==="."?wn:S[1]==="?"?Rn:S[1]==="@"?Dn:kt}),i.removeAttribute(p)}else p.startsWith(je)&&(l.push({type:6,index:s}),i.removeAttribute(p));if(po.test(i.tagName)){let p=i.textContent.split(je),m=p.length-1;if(m>0){i.textContent=En?En.emptyScript:"";for(let T=0;T<m;T++)i.append(p[T],jt()),gt.nextNode(),l.push({type:2,index:++s});i.append(p[m],jt())}}}else if(i.nodeType===8)if(i.data===Pi)l.push({type:2,index:s});else{let p=-1;for(;(p=i.data.indexOf(je,p+1))!==-1;)l.push({type:7,index:s}),p+=je.length-1}s++}}static createElement(e,t){let r=bt.createElement("template");return r.innerHTML=e,r}};function vt(n,e,t=n,r){if(e===Me)return e;let i=r!==void 0?t._$Co?.[r]:t._$Cl,s=Wt(e)?void 0:e._$litDirective$;return i?.constructor!==s&&(i?._$AO?.(!1),s===void 0?i=void 0:(i=new s(n),i._$AT(n,t,r)),r!==void 0?(t._$Co??=[])[r]=i:t._$Cl=i),i!==void 0&&(e=vt(n,i._$AS(n,e.values),i,r)),e}var Sn=class{constructor(e,t){this._$AV=[],this._$AN=void 0,this._$AD=e,this._$AM=t}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(e){let{el:{content:t},parts:r}=this._$AD,i=(e?.creationScope??bt).importNode(t,!0);gt.currentNode=i;let s=gt.nextNode(),o=0,a=0,l=r[0];for(;l!==void 0;){if(o===l.index){let h;l.type===2?h=new Mt(s,s.nextSibling,this,e):l.type===1?h=new l.ctor(s,l.name,l.strings,this,e):l.type===6&&(h=new Mn(s,this,e)),this._$AV.push(h),l=r[++a]}o!==l?.index&&(s=gt.nextNode(),o++)}return gt.currentNode=bt,i}p(e){let t=0;for(let r of this._$AV)r!==void 0&&(r.strings!==void 0?(r._$AI(e,r,t),t+=r.strings.length-2):r._$AI(e[t])),t++}},Mt=class n{get _$AU(){return this._$AM?._$AU??this._$Cv}constructor(e,t,r,i){this.type=2,this._$AH=te,this._$AN=void 0,this._$AA=e,this._$AB=t,this._$AM=r,this.options=i,this._$Cv=i?.isConnected??!0}get parentNode(){let e=this._$AA.parentNode,t=this._$AM;return t!==void 0&&e?.nodeType===11&&(e=t.parentNode),e}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(e,t=this){e=vt(this,e,t),Wt(e)?e===te||e==null||e===""?(this._$AH!==te&&this._$AR(),this._$AH=te):e!==this._$AH&&e!==Me&&this._(e):e._$litType$!==void 0?this.$(e):e.nodeType!==void 0?this.T(e):ho(e)?this.k(e):this._(e)}O(e){return this._$AA.parentNode.insertBefore(e,this._$AB)}T(e){this._$AH!==e&&(this._$AR(),this._$AH=this.O(e))}_(e){this._$AH!==te&&Wt(this._$AH)?this._$AA.nextSibling.data=e:this.T(bt.createTextNode(e)),this._$AH=e}$(e){let{values:t,_$litType$:r}=e,i=typeof r=="number"?this._$AC(e):(r.el===void 0&&(r.el=qt.createElement(mo(r.h,r.h[0]),this.options)),r);if(this._$AH?._$AD===i)this._$AH.p(t);else{let s=new Sn(i,this),o=s.u(this.options);s.p(t),this.T(o),this._$AH=s}}_$AC(e){let t=uo.get(e.strings);return t===void 0&&uo.set(e.strings,t=new qt(e)),t}k(e){Oi(this._$AH)||(this._$AH=[],this._$AR());let t=this._$AH,r,i=0;for(let s of e)i===t.length?t.push(r=new n(this.O(jt()),this.O(jt()),this,this.options)):r=t[i],r._$AI(s),i++;i<t.length&&(this._$AR(r&&r._$AB.nextSibling,i),t.length=i)}_$AR(e=this._$AA.nextSibling,t){for(this._$AP?.(!1,!0,t);e&&e!==this._$AB;){let r=e.nextSibling;e.remove(),e=r}}setConnected(e){this._$AM===void 0&&(this._$Cv=e,this._$AP?.(e))}},kt=class{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}constructor(e,t,r,i,s){this.type=1,this._$AH=te,this._$AN=void 0,this.element=e,this.name=t,this._$AM=i,this.options=s,r.length>2||r[0]!==""||r[1]!==""?(this._$AH=Array(r.length-1).fill(new String),this.strings=r):this._$AH=te}_$AI(e,t=this,r,i){let s=this.strings,o=!1;if(s===void 0)e=vt(this,e,t,0),o=!Wt(e)||e!==this._$AH&&e!==Me,o&&(this._$AH=e);else{let a=e,l,h;for(e=s[0],l=0;l<s.length-1;l++)h=vt(this,a[r+l],t,l),h===Me&&(h=this._$AH[l]),o||=!Wt(h)||h!==this._$AH[l],h===te?e=te:e!==te&&(e+=(h??"")+s[l+1]),this._$AH[l]=h}o&&!i&&this.j(e)}j(e){e===te?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,e??"")}},wn=class extends kt{constructor(){super(...arguments),this.type=3}j(e){this.element[this.name]=e===te?void 0:e}},Rn=class extends kt{constructor(){super(...arguments),this.type=4}j(e){this.element.toggleAttribute(this.name,!!e&&e!==te)}},Dn=class extends kt{constructor(e,t,r,i,s){super(e,t,r,i,s),this.type=5}_$AI(e,t=this){if((e=vt(this,e,t,0)??te)===Me)return;let r=this._$AH,i=e===te&&r!==te||e.capture!==r.capture||e.once!==r.once||e.passive!==r.passive,s=e!==te&&(r===te||i);i&&this.element.removeEventListener(this.name,this,r),s&&this.element.addEventListener(this.name,this,e),this._$AH=e}handleEvent(e){typeof this._$AH=="function"?this._$AH.call(this.options?.host??this.element,e):this._$AH.handleEvent(e)}},Mn=class{constructor(e,t,r){this.element=e,this.type=6,this._$AN=void 0,this._$AM=t,this.options=r}get _$AU(){return this._$AM._$AU}_$AI(e){vt(this,e)}},go={M:Ai,P:je,A:Pi,C:1,L:fo,R:Sn,D:ho,V:vt,I:Mt,H:kt,N:Rn,U:Dn,B:wn,F:Mn},Za=Ci.litHtmlPolyfillSupport;Za?.(qt,Mt),(Ci.litHtmlVersions??=[]).push("3.2.1");var N=(n,e,t)=>{let r=t?.renderBefore??e,i=r._$litPart$;if(i===void 0){let s=t?.renderBefore??null;r._$litPart$=i=new Mt(e.insertBefore(jt(),s),s,void 0,t??{})}return i._$AI(n),i};function d(n){return{ok:!0,value:n}}function v(n){return typeof n=="string"?{ok:!1,error:new Error(n)}:{ok:!1,error:n}}var _e=class n{description="Does nothing";postActionWork="";undo=!1;async do(e){return d(new n)}},ye=class n{name="ActionFromOp";description="Action constructed directly from an Op.";postActionWork;undo;op;constructor(e,t,r){this.postActionWork=t,this.undo=r,this.op=e,this.description=`ActionFromOp: ${this.op.name}`}async do(e){let t=this.op.applyTo(e.plan);return t.ok?(e.plan=t.value.plan,d(new n(t.value.inverse,this.postActionWork,this.undo))):t}};var se=class n{i=0;j=0;constructor(e=0,t=0){this.i=e,this.j=t}equal(e){return e.i===this.i&&e.j===this.j}toJSON(){return{i:this.i,j:this.j}}static fromJSON(e){return new n(e.i,e.j)}},ot=n=>{let e=new Map;return n.forEach(t=>{let r=e.get(t.i)||[];r.push(t),e.set(t.i,r)}),e},Ct=n=>{let e=new Map;return n.forEach(t=>{let r=e.get(t.j)||[];r.push(t),e.set(t.j,r)}),e},We=n=>{let e={bySrc:new Map,byDst:new Map};return n.forEach(t=>{let r=e.bySrc.get(t.i)||[];r.push(t),e.bySrc.set(t.i,r),r=e.byDst.get(t.j)||[],r.push(t),e.byDst.set(t.j,r)}),e};var V=class n{name;subOps=[];constructor(e,t="unset"){this.subOps=e,this.name=t}applyAllInverseSubOpsToPlan(e,t){for(let r=0;r<t.length;r++){let i=t[r].applyTo(e);if(!i.ok)return i;e=i.value.plan}return d(e)}applyTo(e){let t=[];for(let r=0;r<this.subOps.length;r++){let i=this.subOps[r].applyTo(e);if(!i.ok){let s=this.applyAllInverseSubOpsToPlan(e,t);return s.ok?i:s}e=i.value.plan,t.unshift(i.value.inverse)}return d({plan:e,inverse:new n(t,`-${this.name}`)})}},el=(n,e)=>{for(let t=0;t<n.length;t++){let r=n[t].applyTo(e);if(!r.ok)return r;e=r.value.plan}return d(e)},Ii=(n,e)=>{let t=[];for(let r=0;r<n.length;r++){let i=n[r].applyTo(e);if(!i.ok){let s=el(t,e);return s.ok?i:s}t.unshift(i.value.inverse),e=i.value.plan}return d({ops:t,plan:e})};var Cn=class{name;metricDefinition;taskMetricValues;constructor(e,t,r=new Map){this.name=e,this.metricDefinition=t,this.taskMetricValues=r}applyTo(e){return e.getMetricDefinition(this.name)!==void 0?v(`${this.name} already exists as a Metric`):(e.setMetricDefinition(this.name,this.metricDefinition),e.chart.Vertices.forEach((t,r)=>{t.setMetric(this.name,this.taskMetricValues.get(r)||this.metricDefinition.default)}),d({plan:e,inverse:this.inverse()}))}inverse(){return new An(this.name)}},An=class{name;constructor(e){this.name=e}applyTo(e){let t=e.getMetricDefinition(this.name);if(t===void 0)return v(`The metric with name ${this.name} does not exist and can't be deleted.`);if(t.isStatic)return v(`The static Metric ${this.name} can't be deleted.`);e.deleteMetricDefinition(this.name);let r=new Map;return e.chart.Vertices.forEach((i,s)=>{let o=i.getMetric(this.name);o!==void 0&&r.set(s,o),i.deleteMetric(this.name)}),d({plan:e,inverse:this.inverse(t,r)})}inverse(e,t){return new Cn(this.name,e,t)}},$i=class n{oldName;newName;constructor(e,t){this.oldName=e,this.newName=t}applyTo(e){if(e.getMetricDefinition(this.newName)!==void 0)return v(`${this.newName} already exists as a metric.`);let t=e.getMetricDefinition(this.oldName);return t===void 0?v(`${this.oldName} does not exist as a Metric`):t.isStatic?v(`Static metric ${this.oldName} can't be renamed.`):(e.setMetricDefinition(this.newName,t),e.deleteMetricDefinition(this.oldName),e.chart.Vertices.forEach(r=>{let i=r.getMetric(this.oldName)||t.default;r.setMetric(this.newName,i),r.deleteMetric(this.oldName)}),d({plan:e,inverse:this.inverse()}))}inverse(){return new n(this.newName,this.oldName)}},_i=class n{name;metricDefinition;taskMetricValues;constructor(e,t,r=new Map){this.name=e,this.metricDefinition=t,this.taskMetricValues=r}applyTo(e){let t=e.getMetricDefinition(this.name);if(t===void 0)return v(`${this.name} does not exist as a Metric`);if(t.isStatic)return v(`Static metric ${this.name} can't be updated.`);this.metricDefinition.default=this.metricDefinition.range.clamp(this.metricDefinition.default),e.setMetricDefinition(this.name,this.metricDefinition);let r=new Map;return e.chart.Vertices.forEach((i,s)=>{let o=i.getMetric(this.name),a;this.taskMetricValues.has(s)?a=this.taskMetricValues.get(s):o===t.default&&this.metricDefinition.range.min<=o&&this.metricDefinition.range.max>o?(a=this.metricDefinition.default,r.set(s,o)):(a=this.metricDefinition.range.clamp(o),a=this.metricDefinition.precision.round(a),r.set(s,o)),i.setMetric(this.name,a)}),d({plan:e,inverse:this.inverse(t,r)})}inverse(e,t){return new n(this.name,e,t)}},At=class n{name;value;taskIndex;constructor(e,t,r){this.name=e,this.value=t,this.taskIndex=r}applyTo(e){let t=e.getMetricDefinition(this.name);if(t===void 0)return v(`${this.name} does not exist as a Metric`);let r=e.chart.Vertices[this.taskIndex],i=r.getMetric(this.name)||t.default;return r.setMetric(this.name,t.clampAndRound(this.value)),d({plan:e,inverse:this.inverse(i)})}inverse(e){return new n(this.name,e,this.taskIndex)}};function Pn(n,e){return new V([new Cn(n,e)],"AddMetricOp")}function bo(n){return new V([new An(n)],"DeleteMetricOp")}function vo(n,e){return new V([new $i(n,e)],"RenameMetricOp")}function ko(n,e){return new V([new _i(n,e)],"UpdateMetricOp")}function Pt(n,e,t){return new V([new At(n,e,t)],"SetMetricValueOp")}var Ot=n=>n===Number.MAX_VALUE?"(max float)":n===-Number.MAX_VALUE?"(min float)":n.toString(),at=(n,e,t)=>n>t?t:n<e?e:n,le=class n{_min=-Number.MAX_VALUE;_max=Number.MAX_VALUE;constructor(e=-Number.MAX_VALUE,t=Number.MAX_VALUE){t<e&&([e,t]=[t,e]),this._min=e,this._max=t}clamp(e){return at(e,this._min,this._max)}get min(){return this._min}get max(){return this._max}toJSON(){return{min:this._min,max:this._max}}static fromJSON(e){return e===void 0?new n:new n(e.min,e.max)}};var Ce=n=>n.toISOString().slice(0,10),tl=/\d{4}-\d{2}-\d{2}/,Lt=n=>tl.test(n)?d(new Date(n+"T12:00:00.000Z")):v(new Error(`${n} is not a valid date`)),To=()=>{let n=new Date;return new Date(Date.UTC(n.getFullYear(),n.getMonth(),n.getDate(),12,0,0))};var Kt=n=>n.stage==="unstarted"?To():new Date(n.start);var On=n=>{let e={stage:"unstarted",start:""};return n.stage==="started"&&(e.stage="started",e.start=Ce(new Date(n.start))),e},Ln=n=>{let e={stage:"unstarted",start:0};if(n.stage===void 0)return e;if(n.stage==="started"){if(n.start===void 0)return e;let t=Lt(n.start);return t.ok?{stage:"started",start:t.value.getTime()}:e}return e};var yo=n=>{let e={hasCycles:!1,cycle:[],order:[]},t=ot(n.Edges),r=new Set;n.Vertices.forEach((l,h)=>r.add(h));let i=l=>!r.has(l),s=new Set,o=l=>{if(i(l))return!0;if(s.has(l))return!1;s.add(l);let h=t.get(l);if(h!==void 0)for(let u=0;u<h.length;u++){let p=h[u];if(!o(p.j))return!1}return s.delete(l),r.delete(l),e.order.unshift(l),!0};return o(0)||(e.hasCycles=!0,e.cycle=[...s.keys()]),e};var nl="Task Name",Tt=class n{resources;metrics;name;description;id;constructor(e=""){this.name=e||nl,this.metrics={},this.resources={},this.id=crypto.randomUUID(),this.description=""}toJSON(){return{resources:this.resources,metrics:this.metrics,name:this.name,description:this.description,id:this.id}}static fromJSON(e){let t=new n(e.name);return t.description=e.description||"",t.id=e.id,t.resources=e.resources,t.metrics=e.metrics,t}get duration(){return this.getMetric("Duration")}set duration(e){this.setMetric("Duration",e)}getMetric(e){return this.metrics[e]}setMetric(e,t){this.metrics[e]=t}deleteMetric(e){delete this.metrics[e]}getResource(e){return this.resources[e]}setResource(e,t){this.resources[e]=t}deleteResource(e){delete this.resources[e]}dup(){let e=new n;return e.resources=Object.assign({},this.resources),e.metrics=Object.assign({},this.metrics),e.name=this.name,e}},Gt=class n{Vertices;Edges;constructor(){let e=new Tt("Start");e.setMetric("Duration",0);let t=new Tt("Finish");t.setMetric("Duration",0),this.Vertices=[e,t],this.Edges=[new se(0,1)]}toJSON(){return{vertices:this.Vertices.map(e=>e.toJSON()),edges:this.Edges.map(e=>e.toJSON())}}static fromJSON(e){let t=new n;return t.Vertices=e.vertices.map(r=>Tt.fromJSON(r)),t.Edges=e.edges.map(r=>se.fromJSON(r)),t}};function rl(n){if(n.Vertices.length<2)return v("Chart must contain at least two node, the start and finish tasks.");let e=Ct(n.Edges),t=ot(n.Edges);if(e.get(0)!==void 0)return v("The start node (0) has an incoming edge.");for(let s=1;s<n.Vertices.length;s++)if(e.get(s)===void 0)return v(`Found node that isn't (0) that has no incoming edges: ${s}`);if(t.get(n.Vertices.length-1)!==void 0)return v("The last node, which should be the Finish Milestone, has an outgoing edge.");for(let s=0;s<n.Vertices.length-1;s++)if(t.get(s)===void 0)return v(`Found node that isn't T_finish that has no outgoing edges: ${s}`);let r=n.Vertices.length;for(let s=0;s<n.Edges.length;s++){let o=n.Edges[s];if(o.i<0||o.i>=r||o.j<0||o.j>=r)return v(`Edge ${o} points to a non-existent Vertex.`)}let i=yo(n);return i.hasCycles?v(`Chart has cycle: ${[...i.cycle].join(", ")}`):d(i.order)}function lt(n,e=null){e===null&&(e=i=>n.Vertices[i].duration);let t=rl(n);if(!t.ok)return t;if(e(0)!==0)return v(`Start Milestone must have duration of 0, instead got ${e(0)}`);if(e(n.Vertices.length-1)!==0)return v(`Finish Milestone must have duration of 0, instead got ${e(n.Vertices.length-1)}`);let r=new Set;for(let i=0;i<n.Vertices.length;i++){let s=n.Vertices[i];if(r.has(s.id))return v(new Error(`Two tasks contain the same ID: ${s.id}`));r.add(s.id)}return t}var ct=class{start;finish;constructor(e=0,t=0){this.start=e,this.finish=t}},Ni=class{early=new ct;late=new ct;slack=0};function In(n,e=null,t,r=null,i=null){e===null&&(e=h=>n.Vertices[h].duration);let s=new Array(n.Vertices.length);for(let h=0;h<n.Vertices.length;h++)s[h]=new Ni;let o=lt(n,e);if(!o.ok)return v(o.error);let a=We(n.Edges),l=o.value;return l.slice(1).forEach(h=>{let u=s[h];u.early.start=Math.max(...a.byDst.get(h).map(T=>s[T.i].early.finish));let p=r?.(h);p!==void 0&&(u.early.start=p);let m=i?.(h);m!==void 0?u.early.finish=m:u.early.finish=t(u.early.start+e(h))}),l.reverse().forEach(h=>{let u=s[h];if(!a.bySrc.get(h)||r?.(h))u.late.finish=u.early.finish,u.late.start=u.early.start,u.slack=0;else{let m=a.bySrc.get(h).map(T=>s[T.j].late.start);m.length===0?u.late.finish=u.early.finish:u.late.finish=Math.min(...m),u.late.start=t(u.late.finish-e(h)),u.slack=t(u.late.finish-u.early.finish)}}),d(s)}var $n=(n,e)=>{let t=[];return n.forEach((r,i)=>{e(r.late.finish-r.early.finish)<Number.EPSILON&&e(r.early.finish-r.early.start)>Number.EPSILON&&t.push(i)}),t};var yt=n=>{let e={stage:n.stage,start:0,finish:0,percentComplete:0};switch(n.stage){case"unstarted":break;case"started":e.start=n.start,e.percentComplete=n.percentComplete;break;case"finished":e.start=n.span.start,e.finish=n.span.finish;break;default:break}return e},xt=n=>{let e={stage:"unstarted"};switch(n.stage){case"unstarted":return{stage:"unstarted"};case"started":return n.start===void 0?e:{stage:"started",start:n.start,percentComplete:n.percentComplete};case"finished":return n.start===void 0||n.finish===void 0?e:{stage:"finished",span:new ct(n.start,n.finish)};default:return e}},_n=n=>Object.fromEntries(Object.entries(n).map(([e,t])=>[e,yt(t)])),Nn=n=>Object.fromEntries(Object.entries(n).map(([e,t])=>[e,xt(t)]));var Hi=class n{value;taskCompletions=null;constructor(e,t=null){this.value=e,this.taskCompletions=t}applyTo(e){let t=Ln(On(e.status));e.status=this.value;let r=Nn(_n(e.taskCompletion));return this.taskCompletions!==null&&(e.taskCompletion=this.taskCompletions),e.status.stage==="unstarted"&&e.chart.Vertices.forEach(i=>{e.taskCompletion[i.id]={stage:"unstarted"}}),d({plan:e,inverse:new n(t,r)})}};var Ui=class n{unit;constructor(e){this.unit=e}applyTo(e){let t=e.durationUnits.kind();return e.setDurationUnits(this.unit),d({plan:e,inverse:new n(t)})}},Jt=class n{taskIndex;value;constructor(e,t){this.taskIndex=e,this.value=t}applyTo(e){if(this.value.stage!=="unstarted"&&e.status.stage==="unstarted")return v(new Error("Can't start a task if the plan hasn't been started."));if(this.value.stage==="started"){if(this.value.start<0)return v(new Error("The start of a task can't come befoe the start of the plan."));if(this.value.percentComplete<1||this.value.percentComplete>99)return v(new Error("Percent Complete must be in [1, 99]."))}if(this.value.stage==="finished"){if(this.value.span.finish<this.value.span.start)return v(new Error("Finish can't come before Start."));if(this.value.span.start<0)return v(new Error("The start of a task can't come befoe the start of the plan."))}let t=e.getTaskCompletion(this.taskIndex);if(!t.ok)return t;let r=xt(yt(t.value)),i=e.setTaskCompletion(this.taskIndex,this.value);return i.ok?d({plan:e,inverse:new n(this.taskIndex,r)}):i}};function xo(n,e){return new V([new Jt(n,e)],"SetTaskCompletionOp")}function Eo(n){return new V([new Ui(n)],"SetPlanUnitsOp")}function Hn(n){return new V([new Hi(n)],"SetPlanStartStateOp")}var il=100,sl=n=>{let e=n/2;return[Math.ceil(e),Math.floor(e)]};function So(n,e,t){let r=t.chart;return e===-1&&(e=r.Vertices.length-1),n<0||n>=r.Vertices.length?v(`i index out of range: ${n} not in [0, ${r.Vertices.length-1}]`):e<0||e>=r.Vertices.length?v(`j index out of range: ${e} not in [0, ${r.Vertices.length-1}]`):n===e?v(`A Task can not depend on itself: ${n} === ${e}`):d(new se(n,e))}var qe=class{i=0;j=0;constructor(e,t){this.i=e,this.j=t}applyTo(e){this.i===-1&&(this.i=e.chart.Vertices.length-1),this.j===-1&&(this.j=e.chart.Vertices.length-1);let t=So(this.i,this.j,e);return t.ok?(e.chart.Edges.find(r=>r.equal(t.value))||e.chart.Edges.push(t.value),d({plan:e,inverse:this.inverse()})):t}inverse(){return new Un(this.i,this.j)}},Un=class{i=0;j=0;constructor(e,t){this.i=e,this.j=t}applyTo(e){this.i===-1&&(this.i=e.chart.Vertices.length-1),this.j===-1&&(this.j=e.chart.Vertices.length-1);let t=So(this.i,this.j,e);return t.ok?(e.chart.Edges=e.chart.Edges.filter(r=>!r.equal(t.value)),d({plan:e,inverse:this.inverse()})):t}inverse(){return new qe(this.i,this.j)}};function Qt(n,e){return n<0||n>e.Vertices.length-2?v(`${n} is not in range [0, ${e.Vertices.length-2}]`):d(null)}function Et(n,e){return n<1||n>e.Vertices.length-2?v(`${n} is not in range [1, ${e.Vertices.length-2}]`):d(null)}var Xt=class{index=0;fullTaskToBeRestored;constructor(e,t=null){this.index=e,this.fullTaskToBeRestored=t}applyTo(e){let t=e.chart,r=Qt(this.index,t);if(!r.ok)return r;let i=e.newTask();this.fullTaskToBeRestored!==null&&(i=this.fullTaskToBeRestored.task),e.chart.Vertices.splice(this.index+1,0,i);for(let s=0;s<t.Edges.length;s++){let o=t.Edges[s];o.i>=this.index+1&&o.i++,o.j>=this.index+1&&o.j++}return this.fullTaskToBeRestored!==null&&t.Edges.push(...this.fullTaskToBeRestored.edges),d({plan:e,inverse:this.inverse()})}inverse(){return new Yt(this.index+1)}},Vn=class{index=0;constructor(e){this.index=e}applyTo(e){let t=e.chart,r=Et(this.index,t);if(!r.ok)return r;let s=e.chart.Vertices[this.index].dup();e.chart.Vertices.splice(this.index,0,s);for(let o=0;o<t.Edges.length;o++){let a=t.Edges[o];a.i>this.index&&a.i++,a.j>this.index&&a.j++}return d({plan:e,inverse:this.inverse()})}inverse(){return new Yt(this.index+1)}},Fn=class{sourceIndex;targetIndex;constructor(e,t){this.sourceIndex=e,this.targetIndex=t}applyTo(e){let t=e.chart,r=Et(this.sourceIndex,t);if(!r.ok||(r=Et(this.targetIndex,t),!r.ok))return r;let i=e.chart.Vertices[this.sourceIndex],s=e.chart.Vertices[this.targetIndex],[o,a]=sl(i.duration);return i.duration=o,s.duration=a,d({plan:e,inverse:new Vi(this.sourceIndex,this.targetIndex)})}},Vi=class{sourceIndex;targetIndex;constructor(e,t){this.sourceIndex=e,this.targetIndex=t}applyTo(e){let t=e.chart,r=Et(this.sourceIndex,t);if(!r.ok||(r=Et(this.targetIndex,t),!r.ok))return r;let i=e.chart.Vertices[this.sourceIndex],s=e.chart.Vertices[this.targetIndex];return i.duration=i.duration+s.duration,d({plan:e,inverse:new Fn(this.sourceIndex,this.targetIndex)})}},Fi=class n{fromTaskIndex=0;toTaskIndex=0;actualMoves;constructor(e,t,r=new Map){this.fromTaskIndex=e,this.toTaskIndex=t,this.actualMoves=r}applyTo(e){let t=e.chart,r=Et(this.fromTaskIndex,t);if(!r.ok||(r=Et(this.toTaskIndex,t),!r.ok))return r;if(this.actualMoves.values.length===0){let i=new Map;for(let s=0;s<t.Edges.length;s++){let o=t.Edges[s];o.i===this.fromTaskIndex&&o.j===this.toTaskIndex||o.i===this.fromTaskIndex&&(i.set(new se(this.toTaskIndex,o.j),new se(o.i,o.j)),o.i=this.toTaskIndex)}return d({plan:e,inverse:this.inverse(this.toTaskIndex,this.fromTaskIndex,i)})}else{for(let i=0;i<t.Edges.length;i++){let s=this.actualMoves.get(e.chart.Edges[i]);s!==void 0&&(e.chart.Edges[i]=s)}return d({plan:e,inverse:new n(this.toTaskIndex,this.fromTaskIndex)})}}inverse(e,t,r){return new n(e,t,r)}},Bi=class{fromIndex=0;toIndex=0;constructor(e,t){this.fromIndex=e,this.toIndex=t}applyTo(e){let t=Qt(this.fromIndex,e.chart);if(!t.ok)return t;let r=[];return e.chart.Edges.forEach(i=>{i.i===this.fromIndex&&r.push(new se(this.toIndex,i.j)),i.j===this.fromIndex&&r.push(new se(i.i,this.toIndex))}),e.chart.Edges.push(...r),d({plan:e,inverse:new Bn(r)})}},Bn=class{edges;constructor(e){this.edges=e}applyTo(e){return e.chart.Edges=e.chart.Edges.filter(t=>this.edges.findIndex(r=>t.equal(r))===-1),d({plan:e,inverse:new zi(this.edges)})}},zi=class{edges;constructor(e){this.edges=e}applyTo(e){return e.chart.Edges.push(...this.edges),d({plan:e,inverse:new Bn(this.edges)})}},Yt=class{index=0;constructor(e){this.index=e}applyTo(e){let t=e.chart,r=Qt(this.index,t);if(!r.ok)return r;let i=t.Edges.filter(a=>a.i===this.index||a.j===this.index);t.Edges=t.Edges.filter(a=>!(a.i===this.index||a.j===this.index));for(let a=0;a<t.Edges.length;a++){let l=t.Edges[a];l.i>this.index&&l.i--,l.j>this.index&&l.j--}let s=t.Vertices.splice(this.index,1),o={edges:i,task:s[0]};return d({plan:e,inverse:this.inverse(o)})}inverse(e){return new Xt(this.index-1,e)}},xe=class n{constructor(){}applyTo(e){let t=We(e.chart.Edges),r=0,i=e.chart.Vertices.length-1;for(let s=r;s<i;s++){let o=t.bySrc.get(s);if(o===void 0){let a=new se(s,i);e.chart.Edges.push(a)}else if(o.length>1&&o.find(a=>a.j===i)){let a=new se(s,i);e.chart.Edges=e.chart.Edges.filter(l=>!a.equal(l))}}for(let s=r+1;s<i;s++){let o=t.byDst.get(s);if(o===void 0){let a=new se(r,s);e.chart.Edges.push(a)}else if(o.length>1&&o.find(a=>a.i===r)){let a=new se(r,s);e.chart.Edges=e.chart.Edges.filter(l=>!a.equal(l))}}return e.chart.Edges.length===0&&e.chart.Edges.push(new se(r,i)),d({plan:e,inverse:this.inverse()})}inverse(){return new n}},ji=class n{taskIndex;name;constructor(e,t){this.taskIndex=e,this.name=t}applyTo(e){let t=Qt(this.taskIndex,e.chart);if(!t.ok)return t;let r=e.chart.Vertices[this.taskIndex].name;return e.chart.Vertices[this.taskIndex].name=this.name,d({plan:e,inverse:this.inverse(r)})}inverse(e){return new n(this.taskIndex,e)}},Wi=class n{taskIndex;description;constructor(e,t){this.taskIndex=e,this.description=t}applyTo(e){let t=Qt(this.taskIndex,e.chart);if(!t.ok)return t;let r=e.chart.Vertices[this.taskIndex].description;return e.chart.Vertices[this.taskIndex].description=this.description,d({plan:e,inverse:new n(this.taskIndex,r)})}},qi=class{taskCompletions;today;spans;constructor(e,t=-1,r=[]){this.taskCompletions=e,this.today=t,this.spans=r}applyTo(e){return e.chart.Vertices.forEach((t,r)=>{e.setTaskCompletion(r,this.taskCompletions[r])}),d({plan:e,inverse:new zn(this.today,this.spans)})}},Ki=class{today;taskIndex;span;constructor(e,t,r){this.today=e,this.taskIndex=t,this.span=r}applyTo(e){let t=e.getTaskCompletion(this.taskIndex);if(!t.ok)return t;let r=t.value,i=e.chart.Vertices[this.taskIndex],s=this.span.start,o=this.span.finish;return this.today<=s||(this.today>=o?e.setTaskCompletion(this.taskIndex,{stage:"finished",span:this.span}):e.setTaskCompletion(this.taskIndex,{stage:"started",start:s,percentComplete:at(Math.floor(100*(this.today-s)/i.duration),1,99)})),d({plan:e,inverse:new Jt(this.taskIndex,r)})}},zn=class{today;spans;constructor(e,t){this.today=e,this.spans=t}applyTo(e){let t=e.chart.Vertices.map((r,i)=>{let s=e.getTaskCompletion(i);return s.ok?s.value:{stage:"unstarted"}});return e.chart.Vertices.forEach((r,i)=>{let s=this.spans[i].start,o=this.spans[i].finish;this.today<=s||(this.today>=o?e.setTaskCompletion(i,{stage:"finished",span:this.spans[i]}):e.setTaskCompletion(i,{stage:"started",start:s,percentComplete:at(Math.floor(100*(this.today-s)/r.duration),1,99)}))}),d({plan:e,inverse:new qi(t,this.today,this.spans)})}},Gi=class{today;taskIndex;constructor(e,t){this.today=e,this.taskIndex=t}applyTo(e){let t=e.chart.Vertices[this.taskIndex],r=e.getTaskCompletion(this.taskIndex);if(!r.ok)return r;let i=r.value;if(i.stage!=="started")return v(new Error("Recalculating duration can only be applied to started tasks."));let s=e.chart.Vertices[this.taskIndex].duration,o=i.percentComplete,a=i.start,l=(this.today-a)/(o/100);return t.duration=e.getStaticMetricDefinition("Duration").clampAndRound(l),d({plan:e,inverse:new At("Duration",s,this.taskIndex)})}};function wo(n){return new V([new xe,new Xt(n),new qe(0,n+1),new qe(n+1,-1),new xe],"InsertNewEmptyMilestoneAfterOp")}function It(n,e){return new V([new ji(n,e)],"SetTaskNameOp")}function jn(n){let e=[new Vn(n),new Fn(n,n+1),new Fi(n,n+1),new qe(n,n+1)];return new V(e,"SplitTaskOp")}function Wn(n){let e=[new Vn(n),new Bi(n,n+1)];return new V(e,"DupTaskOp")}function Ro(n){return new V([new xe,new Yt(n),new xe],"DeleteTaskOp")}function qn(n,e){return new V([new xe,new qe(n,e),new xe],"AddEdgeOp")}function Do(){return new V([new xe],"RationalizeEdgesOp")}function Mo(n,e){return new V([new xe,new Un(n,e),new xe],"RemoveEdgeOp")}function Kn(n){return new V([new xe,new Xt(n),new At("Duration",il,n+1),new qe(0,n+1),new qe(n+1,-1),new xe],"InsertNewEmptyTaskAfterOp")}function Co(n,e){return new V([new zn(n,e)],"CatchupOp")}function Ao(n,e){return new V([new Gi(n,e)],"RecalculateDurationOp")}function Po(n,e,t){return new V([new Ki(n,e,t)],"CatchupTaskOp")}function Oo(n,e){return new V([new Wi(n,e)],"SetTaskDescriptionOp")}var Gn=class{description="Prompts for and adds a predecessor to the current Task.";postActionWork="planDefinitionChanged";undo=!0;async do(e){if(e.selectedTask===-1)return v(new Error("A Task must be selected."));let t=await e.querySelector("add-dependency-dialog").selectDependency(e.plan.chart,e.selectedTask,"pred");if(t===void 0)return v(new Error("No predecessor was selected."));let r=qn(t,e.selectedTask).applyTo(e.plan);return r.ok?d(new ye(r.value.inverse,this.postActionWork=this.postActionWork,!0)):r}};var Jn=class{description="Prompts for and adds a successor to the current Task.";postActionWork="planDefinitionChanged";undo=!0;async do(e){if(e.selectedTask===-1)return v(new Error("A Task must be selected."));let t=await e.querySelector("add-dependency-dialog").selectDependency(e.plan.chart,e.selectedTask,"succ");if(t===void 0)return v(new Error("No successor was selected."));let r=qn(e.selectedTask,t).applyTo(e.plan);return r.ok?d(new ye(r.value.inverse,this.postActionWork=this.postActionWork,!0)):r}};var Xn=class{description="Opens the developer panel.";postActionWork="";undo=!1;async do(e){return e.querySelector("developer-panel").showDialog(e),d(new _e)}};var Yn=class{description="Moves focus to search control.";postActionWork="";undo=!1;async do(e){return document.querySelector("search-task-panel").setKeyboardFocusToInput("name-only"),d(this)}},Qn=class{description="Moves focus to search control and does a full search of all resource values.";postActionWork="";undo=!1;async do(e){return document.querySelector("search-task-panel").setKeyboardFocusToInput("full-info"),d(this)}};var Zn=class{description="Displays the help dialog.";postActionWork="";undo=!1;async do(e){return e.querySelector("keyboard-map-dialog").showModal(),d(this)}};var er=class{description="Undoes the zoom.";postActionWork="paintChart";undo=!1;async do(e){return e.displayRange=null,d(this)}};var tr=class{description="Splits a task.";postActionWork="planDefinitionChanged";undo=!0;async do(e){if(e.selectedTask===-1)return v(new Error("A task must be selected first."));let t=jn(e.selectedTask).applyTo(e.plan);return t.ok?d(new ye(t.value.inverse,this.postActionWork,this.undo)):t}},nr=class{description="Duplicates a task.";postActionWork="planDefinitionChanged";undo=!0;async do(e){if(e.selectedTask===-1)return v(new Error("A task must be selected first."));let t=Wn(e.selectedTask).applyTo(e.plan);return t.ok?d(new ye(t.value.inverse,this.postActionWork,this.undo)):t}},rr=class{description="Creates a new task.";postActionWork="planDefinitionChanged";undo=!0;async do(e){let t=Kn(0).applyTo(e.plan);return t.ok?d(new ye(t.value.inverse,this.postActionWork,this.undo)):t}},ir=class{description="Deletes a task.";postActionWork="planDefinitionChanged";undo=!0;async do(e){if(e.selectedTask===-1)return v(new Error("A task must be selected first."));let t=Ro(e.selectedTask).applyTo(e.plan);return t.ok?(e.selectedTask=-1,d(new ye(t.value.inverse,this.postActionWork,this.undo))):t}},Ae=class{description="Moves focus to the first predecessor task.";postActionWork="planDefinitionChanged";undo=!1;predIndex=0;async do(e){if(e.selectedTask===-1)return v(new Error("A task must be selected first."));let r=(We(e.plan.chart.Edges).byDst.get(e.selectedTask)||[]).map(s=>s.i);r.reverse();let i=r.length>this.predIndex&&r[this.predIndex];return i===!1||i===0?v(new Error("Can't edit that task.")):(e.selectedTask=i,d(new _e))}},sr=class extends Ae{constructor(){super(),this.predIndex=1,this.description="Moves focus to the second predecessor task."}},or=class extends Ae{constructor(){super(),this.predIndex=2,this.description="Moves focus to the third predecessor task."}},ar=class extends Ae{constructor(){super(),this.predIndex=3,this.description="Moves focus to the fourth predecessor task."}},lr=class extends Ae{constructor(){super(),this.predIndex=4,this.description="Moves focus to the fifth predecessor task."}},cr=class extends Ae{constructor(){super(),this.predIndex=5,this.description="Moves focus to the sixth predecessor task."}},ur=class extends Ae{constructor(){super(),this.predIndex=6,this.description="Moves focus to the seventh predecessor task."}},dr=class extends Ae{constructor(){super(),this.predIndex=7,this.description="Moves focus to the eigth predecessor task."}},hr=class extends Ae{constructor(){super(),this.predIndex=8,this.description="Moves focus to the ninth predecessor task."}},Pe=class{description="Moves focus to the first successor task.";postActionWork="planDefinitionChanged";undo=!1;succIndex=0;async do(e){if(e.selectedTask===-1)return v(new Error("A task must be selected first."));let r=(We(e.plan.chart.Edges).bySrc.get(e.selectedTask)||[]).map(s=>s.j);r.reverse();let i=r.length>this.succIndex&&r[this.succIndex];return i===!1||i===e.plan.chart.Vertices.length-1?v(new Error("Can't edit that task.")):(e.selectedTask=i,d(new _e))}},pr=class extends Pe{constructor(){super(),this.succIndex=1,this.description="Moves focus to the second successor task."}},mr=class extends Pe{constructor(){super(),this.succIndex=2,this.description="Moves focus to the third successor task."}},fr=class extends Pe{constructor(){super(),this.succIndex=3,this.description="Moves focus to the fourth successor task."}},gr=class extends Pe{constructor(){super(),this.succIndex=4,this.description="Moves focus to the fifth successor task."}},br=class extends Pe{constructor(){super(),this.succIndex=5,this.description="Moves focus to the sixth successor task."}},vr=class extends Pe{constructor(){super(),this.succIndex=6,this.description="Moves focus to the seventh successor task."}},kr=class extends Pe{constructor(){super(),this.succIndex=7,this.description="Moves focus to the eigth successor task."}},Tr=class extends Pe{constructor(){super(),this.succIndex=8,this.description="Moves focus to the ninth successor task."}};var Lo="explan-darkmode",Io=()=>{window.localStorage.setItem(Lo,document.body.classList.toggle("darkmode")?"1":"0")},$o=()=>{document.body.classList.toggle("darkmode",window.localStorage.getItem(Lo)==="1")};var yr=class{description="Toggles dark mode.";postActionWork="paintChart";undo=!1;async do(e){return Io(),d(this)}};var xr=class{description="Toggles the radar view.";postActionWork="";undo=!1;async do(e){return e.toggleRadar(),d(this)}};var Er=class{description="Undoes the last action.";postActionWork="";undo=!1;async do(e){let t=await _o(e);return t.ok?d(new _e):t}},Sr=class{description="Redoes the most recent undo action.";postActionWork="";undo=!1;async do(e){let t=await No(e);return t.ok?d(new _e):t}};var wr={ToggleDarkModeAction:new yr,ToggleRadarAction:new xr,ResetZoomAction:new er,UndoAction:new Er,RedoAction:new Sr,HelpAction:new Zn,SplitTaskAction:new tr,DupTaskAction:new nr,NewTaskAction:new rr,DeleteTaskAction:new ir,GoToSearchAction:new Yn,GoToFullSearchAction:new Qn,AddPredecessorAction:new Gn,AddSuccessorAction:new Jn,DeveloperPanelAction:new Xn,MoveFocusToPredecessor1:new Ae,MoveFocusToPredecessor2:new sr,MoveFocusToPredecessor3:new or,MoveFocusToPredecessor4:new ar,MoveFocusToPredecessor5:new lr,MoveFocusToPredecessor6:new cr,MoveFocusToPredecessor7:new ur,MoveFocusToPredecessor8:new dr,MoveFocusToPredecessor9:new hr,MoveFocusToSuccessor1:new Pe,MoveFocusToSuccessor2:new pr,MoveFocusToSuccessor3:new mr,MoveFocusToSuccessor4:new fr,MoveFocusToSuccessor5:new gr,MoveFocusToSuccessor6:new br,MoveFocusToSuccessor7:new vr,MoveFocusToSuccessor8:new kr,MoveFocusToSuccessor9:new Tr};var Rr=[],Dr=[],Ho=()=>[Rr,Dr],_o=async n=>{let e=Rr.pop();return e?await Mr(e,n,"undo"):d(null)},No=async n=>{let e=Dr.pop();return e?await Mr(e,n,"redo"):d(null)},be=async(n,e)=>Mr(wr[n],e),Mr=async(n,e,t="normal")=>{let r=await n.do(e);if(!r.ok)return r;switch(n.postActionWork){case"":break;case"paintChart":e.paintChart();break;case"planDefinitionChanged":e.planDefinitionHasBeenChanged(),e.paintChart(),document.dispatchEvent(new CustomEvent("plan-definition-changed"));default:break}if(n.undo)switch(t){case"normal":Rr.push(r.value),Dr.length=0,document.dispatchEvent(new CustomEvent("edit-action"));break;case"undo":Dr.push(r.value);break;case"redo":Rr.push(r.value);break;default:break}return d(null)},X=async(n,e,t,r)=>Mr(new ye(n,e,t),r);var Y=n=>k`
  <svg
    xmlns="http://www.w3.org/2000/svg"
    width="24"
    height="24"
    viewBox="0 0 24 24"
  >
    <use href=#${n}>
  </svg>`;var Zt=class extends HTMLElement{message="";static displayMessage(e,t=0){document.querySelector("error-popup").displayMessageImpl(e,t)}displayMessageImpl(e,t=0){this.message=e,t!==0&&window.setTimeout(()=>this.hide(),t),this.render(),this.unhide()}unhide(){this.classList.remove("hidden")}hide(){this.classList.add("hidden")}render(){N(this.template(),this)}template(){return k`
      <span>${this.message}</span>
      <button class="icon-button" title="Close" @click=${()=>this.hide()}>
        ${Y("check")}
      </button>
    `}};customElements.define("error-popup",Zt);var Uo="ErrorPopup",Vo=n=>{Uo=n},fe=n=>{Uo==="ErrorPopup"?Zt.displayMessage(n.message):document.dispatchEvent(new CustomEvent("error-report",{detail:n}))},H=n=>{n.ok||fe(n.error)};var en=new Map([["shift-ctrl-R","ToggleRadarAction"],["shift-ctrl-M","ToggleDarkModeAction"],["shift-ctrl-Z","ResetZoomAction"],["ctrl-z","UndoAction"],["ctrl-y","RedoAction"],["shift-ctrl-H","HelpAction"],["shift-ctrl-|","SplitTaskAction"],["shift-ctrl-_","DupTaskAction"],["alt-Insert","NewTaskAction"],["alt-Delete","DeleteTaskAction"],["ctrl-f","GoToSearchAction"],["shift-ctrl-F","GoToFullSearchAction"],["shift-ctrl-<","AddPredecessorAction"],["shift-ctrl->","AddSuccessorAction"],["shift-ctrl-V","DeveloperPanelAction"],["ctrl-meta-1","MoveFocusToPredecessor1"],["ctrl-meta-2","MoveFocusToPredecessor2"],["ctrl-meta-3","MoveFocusToPredecessor3"],["ctrl-meta-4","MoveFocusToPredecessor4"],["ctrl-meta-5","MoveFocusToPredecessor5"],["ctrl-meta-6","MoveFocusToPredecessor6"],["ctrl-meta-7","MoveFocusToPredecessor7"],["ctrl-meta-8","MoveFocusToPredecessor8"],["ctrl-meta-9","MoveFocusToPredecessor9"],["ctrl-1","MoveFocusToSuccessor1"],["ctrl-2","MoveFocusToSuccessor2"],["ctrl-3","MoveFocusToSuccessor3"],["ctrl-4","MoveFocusToSuccessor4"],["ctrl-5","MoveFocusToSuccessor5"],["ctrl-6","MoveFocusToSuccessor6"],["ctrl-7","MoveFocusToSuccessor7"],["ctrl-8","MoveFocusToSuccessor8"],["ctrl-9","MoveFocusToSuccessor9"]]),Fo,Bo=n=>{Fo=n,document.addEventListener("keydown",ol)},ol=async n=>{let e=`${n.shiftKey?"shift-":""}${n.ctrlKey?"ctrl-":""}${n.metaKey?"meta-":""}${n.altKey?"alt-":""}${n.key}`;console.log(e);let t=en.get(e);if(t===void 0)return;n.stopPropagation(),n.preventDefault();let r=await be(t,Fo);H(r)},zo=()=>{en.delete("ctrl-z"),en.delete("ctrl-y")};var Ji=class extends HTMLElement{connectedCallback(){let e=[...en.entries()];e.sort(),N(k`
        <dialog>
          <table>
            ${e.map(([t,r])=>k`<tr>
                  <td>${t}</td>
                  <td>${wr[r].description}</td>
                </tr>`)}
          </table>
        </dialog>
      `,this)}showModal(){this.querySelector("dialog").showModal()}};customElements.define("keyboard-map-dialog",Ji);var Xi=class extends HTMLElement{explanMain=null;planDefinitionChangedCallback;constructor(){super(),this.planDefinitionChangedCallback=()=>{this.explanMain!==null&&this.render()}}connectedCallback(){document.addEventListener("plan-definition-changed",this.planDefinitionChangedCallback)}disconnectedCallback(){document.removeEventListener("plan-definition-changed",this.planDefinitionChangedCallback)}render(){N(this.template(),this)}setConfig(e){this.explanMain=e,this.render()}template(){if(!this.explanMain)return k``;let e=this.explanMain.imageExportWidthPx;return k` <h3>Image Export</h3>
    
    <div>
        <label>
        Width (px) 
        <input 
            type=number 
            .value=${e}
            @change=${t=>this.widthChange(t)}
            min=100
            max=1000000
            step=1
            required
        >
        </lable>
    </div>
    <div>
        <label>
        <input 
            type=checkbox 
            .checked=${this.explanMain.imageExportBackgroundTransparent}
            @input=${t=>{this.transparentChange(t)}}
        >
        Transparent Background
        </label>
    </div>
    `}widthChange(e){let t=+e.target.value;t>0&&t<1e6&&(this.explanMain.imageExportWidthPx=t)}transparentChange(e){let t=e.target.checked;this.explanMain.imageExportBackgroundTransparent=t}};customElements.define("image-export-panel",Xi);var Yi=class extends HTMLElement{dialog=null;heading=null;inputElement=null;resolve=()=>{};connectedCallback(){this.dialog=this.querySelector("dialog"),this.heading=this.querySelector("h3"),this.inputElement=this.querySelector("input"),this.querySelector("#prompt-cancel").addEventListener("click",()=>{this.dialog.close(),this.resolve(null)}),this.querySelector("#prompt-ok").addEventListener("click",()=>{this.dialog.close(),this.resolve(this.inputElement.value)})}prompt(e){let t=new Promise(r=>{this.resolve=r});return this.heading.textContent=e,this.inputElement.value="",this.dialog.showModal(),t}};customElements.define("prompt-dialog",Yi);var Qi=class extends HTMLElement{dialog=null;inputElement=null;resolve=()=>{};connectedCallback(){this.dialog=this.querySelector("dialog"),this.inputElement=this.querySelector("textarea"),this.querySelector("#description-cancel").addEventListener("click",()=>{this.dialog.close(),this.resolve(null)}),this.querySelector("#description-ok").addEventListener("click",()=>{this.dialog.close(),this.resolve(this.inputElement.value)})}prompt(e){let t=new Promise(r=>{this.resolve=r});return this.inputElement.value=e,this.dialog.showModal(),t}};customElements.define("edit-description-dialog",Qi);var Zi=class extends HTMLElement{explanMain=null;groupByOptions=[];selectedGroupBy="";planDefinitionChangedCallback;constructor(){super(),this.planDefinitionChangedCallback=()=>{this.explanMain!==null&&(this.populateGroupBy(),this.render())}}populateGroupBy(){let e=this.explanMain?.plan;e!==void 0&&(this.groupByOptions=["",...Object.keys(e.resourceDefinitions)],this.groupByOptions.includes(this.selectedGroupBy)||(this.selectedGroupBy=""))}connectedCallback(){document.addEventListener("plan-definition-changed",this.planDefinitionChangedCallback)}disconnectedCallback(){document.removeEventListener("plan-definition-changed",this.planDefinitionChangedCallback)}render(){N(this.template(),this)}setConfig(e){this.explanMain=e,this.render()}getSelectedGroup(){return this.selectedGroupBy}groupByChanged(e){this.selectedGroupBy=e.target.value,this.dispatchEvent(new CustomEvent("group-by-resource-changed",{bubbles:!0,detail:this.selectedGroupBy}))}template(){return k`
      <select @input=${e=>this.groupByChanged(e)}>
        ${this.groupByOptions.map(e=>{let t=e||"(none)";return k`<option
            ?selected=${e===this.selectedGroupBy}
            value="${e}"
          >
            ${t}
          </option>`})}
      </select>
    `}};customElements.define("groupby-control",Zi);var es=class extends HTMLElement{allButtons=[];connectedCallback(){this.querySelectorAll("button").forEach(e=>{let t=e.dataset.target;t&&(this.allButtons.push(e),e.addEventListener("click",()=>this.hideAllBut(t)))})}hideAllBut(e){this.allButtons.forEach(t=>{let r=document.getElementById(t.dataset.target);t.dataset.target===e?(r?.classList.remove("hidden"),t.classList.add("selected")):(r?.classList.add("hidden"),t.classList.remove("selected"))})}};customElements.define("tab-buttons",es);var al=/^[\d\.]+$/,$t=n=>{switch(n){case"Days":return 7;case"Weekdays":return 5;default:return 0}},Cr=(n,e)=>{if(n=n.trim(),n==="")return d(0);if(n.match(al)){let s=+n;return Number.isNaN(s)?v(new Error(`Invalid number value: ${n}`)):d(s)}if(e===0)return v(new Error(`${n} is not a valid unitless duration.`));let t=0,r=0,i=[...n];for(let s=0;s<i.length;s++){let o=i[s];if(o==="d")t+=r,r=0;else if(o==="w")t+=r*e,r=0;else if(o==="m")t+=r*(e*4+2),r=0;else if(o==="y")t+=r*e*52,r=0;else if("0123456789".includes(o))r=r*10+ +o;else return v(new Error(`invalid duration format: ${n}`))}return d(t)},ts=(n,e)=>{if(n<0)return v(new Error(`Can't convert negative days: ${n}`));if(n===0)return d("0");if(e===0)return d(`${n}`);n=Math.floor(n);let t=52*e,r=4*e+2;if(n%t===0)return d(`${n/t}y`);if(n%r===0)return d(`${n/r}m`);if(n%e===0&&n<52*e)return d(`${n/e}w`);let i=[];if(n>=t){let s=Math.floor(n/t);n=n%t,i.push(`${s}y`)}if(n>=r){let s=Math.floor(n/r);n=n%r,i.push(`${s}m`)}if(n>=e){let s=Math.floor(n/e);n=n%e,i.push(`${s}w`)}return n>0&&i.push(`${n}d`),d(i.join(""))},jo=(n,e,t)=>{if(t===0)return d(n);let r=ts(n,e);return r.ok?Cr(r.value,t):r};var Ar=class{start;cache;lastCacheEntry;constructor(e){this.start=e,this.cache=new Map,this.cache.set(0,0),this.lastCacheEntry=0}dateToWeekday(e){let t=Lt(e);if(!t.ok)return t;let r=t.value;if(r<=this.start)return v(new Error(`${r} comes before ${this.start}`));let i=new Date(this.start.getTime()),s=Ce(i),o=0;for(;s<e;){let a=i.getDate();i.setDate(a+1);let l=i.getDay();l===0||l===6||(o+=1,s=Ce(i))}return d(o)}weekdaysToDays(e){if(e<0)return 0;e=Math.trunc(e);let t=this.cache.get(e);if(t!==void 0)return t;let r=new Date(this.start.getTime()),i=this.lastCacheEntry,s=this.cache.get(i);for(r.setDate(r.getDate()+s);i!==e;){let o=r.getDate();r.setDate(o+1),s+=1;let a=r.getDay();a===0||a===6||(i+=1,this.cache.set(i,s))}return this.lastCacheEntry=i,s}};var St=class{start;metricDefn;unitType;constructor(e,t,r){this.start=e,this.metricDefn=t,this.unitType=r}displayTime(e){throw new Error("Method implemented in subclasses.")}asDate(e){throw new Error("Method implemented in subclasses.")}parseHumanDuration(e){return Cr(e,$t(this.unitType))}durationToHuman(e){return ts(e,$t(this.unitType))}dateStringToDuration(e){throw new Error("Method implemented in subclasses.")}kind(){return this.unitType}toJSON(){return{unitType:this.unitType}}static fromJSON(e,t,r){return Or[is(e.unitType)](t,r)}},Pr=["Unitless","Days","Weekdays"];var Or={Unitless:(n,e)=>new ns(n,e),Days:(n,e)=>new tn(n,e),Weekdays:(n,e)=>new rs(n,e)},is=n=>Pr.some(e=>e===n)?n:"Unitless",ns=class extends St{constructor(e,t){super(e,t,"Unitless")}displayTime(e,t){return this.metricDefn.clampAndRound(e).toString()}asDate(e){return this.start}dateStringToDuration(e){let t=Cr(e,0);return t.ok?d(this.metricDefn.clampAndRound(t.value)):t}},tn=class extends St{constructor(e,t){super(e,t,"Days")}displayTime(e){return Ce(this.asDate(e))}asDate(e){let t=new Date(this.start.getTime());return t.setDate(t.getDate()+e),t}dateStringToDuration(e){let t=Lt(e);if(!t.ok)return t;let r=t.value.getTime()-this.start.getTime()+1;return r<0?v(new Error("Dates before the plan start are not allowed.")):d(this.metricDefn.clampAndRound(r/(1e3*60*60*24)))}},rs=class extends St{weekdays;constructor(e,t){super(e,t,"Weekdays"),this.weekdays=new Ar(e)}displayTime(e){return Ce(this.asDate(e))}asDate(e){let t=new Date(this.start.getTime());return t.setDate(t.getDate()+this.weekdays.weekdaysToDays(e)),t}dateStringToDuration(e){return this.weekdays.dateToWeekday(e)}};var ss=class extends HTMLElement{explanMain=null;planDefinitionChangedCallback;constructor(){super(),this.planDefinitionChangedCallback=()=>{this.explanMain!==null&&this.render()}}connectedCallback(){document.addEventListener("plan-definition-changed",this.planDefinitionChangedCallback)}disconnectedCallback(){document.removeEventListener("plan-definition-changed",this.planDefinitionChangedCallback)}render(){N(this.template(),this)}setConfig(e){this.explanMain=e,this.render()}template(){return k`
      <h3>Plan Status</h3>
      <div>
        <div>${this.unstartedContent()} ${this.startedContent()}</div>
        <label>
          Units
          <select
            size=${Pr.length}
            @input=${e=>this.unitChanged(e)}
          >
            ${Pr.map(e=>k`<option
                ?selected=${this.explanMain.plan.durationUnits.kind()===e}
                value=${e}
              >
                ${e}
              </option>`)}
          </select>
        </label>
      </div>
    `}async unitChanged(e){let t=e.target.value,r=await X(Eo(is(t)),"planDefinitionChanged",!0,this.explanMain);H(r),this.render()}unstartedContent(){return this.explanMain.plan.status.stage==="unstarted"?k`
        <label>
          <input type="checkbox" @input=${()=>this.start()} /> Started
        </label>
      `:k``}startedContent(){return this.explanMain.plan.status.stage==="started"?k`
        <label>
          <input type="checkbox" checked @input=${()=>this.unstart()} />
          Started
        </label>
        ${this.explanMain.plan.durationUnits.kind()==="Unitless"?k``:k`
              <input
                type="date"
                .value=${Ce(new Date(this.explanMain.plan.status.start))}
                @input=${e=>this.dateChanged(e)}
              />
            `}
      `:k``}async dateChanged(e){let t=e.target.valueAsDate.getTime(),r=await X(Hn({stage:"started",start:t}),"planDefinitionChanged",!0,this.explanMain);H(r),this.render()}async start(){let e=Date.now(),t=await X(Hn({stage:"started",start:e}),"planDefinitionChanged",!0,this.explanMain);H(t),this.render()}async unstart(){let e=await X(Hn({stage:"unstarted",start:0}),"planDefinitionChanged",!0,this.explanMain);H(e),this.render()}};customElements.define("plan-config-panel",ss);var Ke={ATTRIBUTE:1,CHILD:2,PROPERTY:3,BOOLEAN_ATTRIBUTE:4,EVENT:5,ELEMENT:6},Lr=n=>(...e)=>({_$litDirective$:n,values:e}),_t=class{constructor(e){}get _$AU(){return this._$AM._$AU}_$AT(e,t,r){this._$Ct=e,this._$AM=t,this._$Ci=r}_$AS(e,t){return this.update(e,t)}update(e,t){return this.render(...t)}};var{I:Ph}=go;var Wo=n=>n.strings===void 0;var ll={},qo=(n,e=ll)=>n._$AH=e;var oe=Lr(class extends _t{constructor(n){if(super(n),n.type!==Ke.PROPERTY&&n.type!==Ke.ATTRIBUTE&&n.type!==Ke.BOOLEAN_ATTRIBUTE)throw Error("The `live` directive is not allowed on child or event bindings");if(!Wo(n))throw Error("`live` bindings can only contain a single expression")}render(n){return n}update(n,[e]){if(e===Me||e===te)return e;let t=n.element,r=n.name;if(n.type===Ke.PROPERTY){if(e===t[r])return Me}else if(n.type===Ke.BOOLEAN_ATTRIBUTE){if(!!e===t.hasAttribute(r))return Me}else if(n.type===Ke.ATTRIBUTE&&t.getAttribute(r)===e+"")return Me;return qo(n),e}});var os=class extends HTMLElement{_value=null;set value(e){this._value=e,this.render()}render(){N(this.template(),this)}template(){return this._value===null?k``:this._value.unit.kind()==="Unitless"?k` <input
        type="text"
        .value=${oe(this._value.dateOffset)}
        @change=${t=>this.inputChanged(t)}
      />`:k`
        <input
          type="date"
          .value=${oe(Ce(this._value.unit.asDate(this._value.dateOffset)))}
          @input=${t=>this.inputChanged(t)}
        />
      `}inputChanged(e){let t=this._value.unit.dateStringToDuration(e.target.value);t.ok?this.dispatchEvent(new CustomEvent("date-picker-input",{bubbles:!0,detail:t.value})):(this.render(),fe(t.error))}};customElements.define("date-picker",os);var as=class extends HTMLElement{explanMain=null;span=null;taskIndex=0;taskCompletion=null;planDefinitionChangedCallback;constructor(){super(),this.planDefinitionChangedCallback=()=>{this.updateOnInput()}}connectedCallback(){document.addEventListener("plan-definition-changed",this.planDefinitionChangedCallback)}disconnectedCallback(){document.removeEventListener("plan-definition-changed",this.planDefinitionChangedCallback)}update(e,t,r){this.explanMain=e,this.taskIndex=t,this.span=r,this.updateOnInput()}updateOnInput(){let e=this.explanMain.plan.getTaskCompletion(this.taskIndex);e.ok&&(this.taskCompletion=e.value),N(this.template(),this)}template(){if(this.taskCompletion===null)return k``;if(this.explanMain.plan.status.stage==="unstarted")return k``;if(this.taskIndex===-1)return k``;switch(this.taskCompletion.stage){case"unstarted":return k`<div>
          <label>
            <input type="checkbox" @change=${()=>this.start()} />
            Started
          </label>
        </div>`;case"started":return k`<div>
            <label>
              <input type="checkbox" checked @change=${()=>this.unstart()} />
              Started
            </label>

            <date-picker
              .value=${{unit:this.explanMain.plan.durationUnits,dateOffset:this.taskCompletion.start}}
              @date-picker-input=${e=>this.startDateChanged(e)}
            ></date-picker>

            <label>
              <input type="checkbox" @change=${()=>this.finish()} />
              Finished
            </label>
          </div>
          <div>
            <label>
              <input
                type="number"
                min="1"
                max="99"
                step="1"
                .value=${oe(this.taskCompletion.percentComplete)}
                @change=${e=>this.percentChange(e)}
              />
              % Complete
              <button
                title="Set the completion of the task to match today."
                @click=${async()=>{let e=await this.explanMain.getToday();if(!e.ok){fe(e.error);return}let t=e.value,r=await X(Po(t,this.taskIndex,this.span),"planDefinitionChanged",!0,this.explanMain);H(r)}}
              >
                Catchup
              </button>
            </label>
          </div>`;case"finished":return k`<div>
          <label>
            <input type="checkbox" checked @change=${()=>this.unstart()} />
            Started
          </label>

          <date-picker
            .value=${{unit:this.explanMain.plan.durationUnits,dateOffset:this.taskCompletion.span.start}}
            @date-picker-input=${e=>this.startDateChanged(e)}
          ></date-picker>

          <label>
            <input type="checkbox" checked @change=${()=>this.unfinish()} />
            Finished
          </label>

          <date-picker
            .value=${{unit:this.explanMain.plan.durationUnits,dateOffset:this.taskCompletion.span.finish}}
            @date-picker-input=${e=>this.finishDateChanged(e)}
          ></date-picker>
        </div>`;default:return this.taskCompletion,k``;break}}async taskCompletionChanged(e){let t=await X(xo(this.taskIndex,e),"planDefinitionChanged",!0,this.explanMain);t.ok||(this.updateOnInput(),fe(t.error))}async start(){this.taskCompletionChanged({stage:"started",start:this.span.start,percentComplete:10})}unstart(){this.taskCompletionChanged({stage:"unstarted"})}finish(){this.taskCompletion.stage==="started"&&this.taskCompletionChanged({stage:"finished",span:new ct(this.taskCompletion.start,this.span.finish)})}unfinish(){this.taskCompletion.stage==="finished"&&this.taskCompletionChanged({stage:"started",percentComplete:90,start:this.taskCompletion.span.start})}percentChange(e){let t=xt(yt(this.taskCompletion));t.stage==="started"&&(t.percentComplete=e.target.valueAsNumber,this.taskCompletionChanged(t))}startDateChanged(e){let t=xt(yt(this.taskCompletion));t.stage==="finished"?t.span.start=e.detail:t.stage==="started"&&(t.start=e.detail),this.taskCompletionChanged(t)}finishDateChanged(e){let t=xt(yt(this.taskCompletion));t.stage==="finished"&&(t.span.finish=e.detail),this.taskCompletionChanged(t)}};customElements.define("task-completion-panel",as);var nn="",Ge=class n{values;isStatic;constructor(e=[nn],t=!1){this.values=e,this.isStatic=t}toJSON(){return{values:this.values,static:this.isStatic}}static fromJSON(e){return new n(e.values,e.static)}};var Ir=class{key;deleteResourceUndoState;constructor(e,t=null){this.key=e,this.deleteResourceUndoState=t}applyTo(e){return e.getResourceDefinition(this.key)!==void 0?v(`${this.key} already exists as a Resource`):(e.setResourceDefinition(this.key,this.deleteResourceUndoState&&this.deleteResourceUndoState.resourceDefinition||new Ge),e.chart.Vertices.forEach((r,i)=>{r.setResource(this.key,this.deleteResourceUndoState&&this.deleteResourceUndoState.taskIndexToDeletedResourceValue.get(i)||nn)}),d({plan:e,inverse:this.inverse()}))}inverse(){return new $r(this.key)}},$r=class{key;constructor(e){this.key=e}applyTo(e){let t=e.getResourceDefinition(this.key);if(t===void 0)return v(`The resource with name ${this.key} does not exist and can't be deleted.`);e.deleteResourceDefinition(this.key);let r=new Map;e.chart.Vertices.forEach((s,o)=>{let a=s.getResource(this.key)||nn;r.set(o,a),s.deleteResource(this.key)});let i={resourceDefinition:t,taskIndexToDeletedResourceValue:r};return d({plan:e,inverse:this.inverse(i)})}inverse(e){return new Ir(this.key,e)}},_r=class{key;value;indicesOfTasksToChange=[];constructor(e,t,r=[]){this.key=e,this.value=t,this.indicesOfTasksToChange=r}applyTo(e){let t=e.getResourceDefinition(this.key);return t===void 0?v(`${this.key} doesn't exist as a Resource`):t.values.findIndex(i=>i===this.value)!==-1?v(`${this.value} already exists as a value in the Resource ${this.key}.`):(t.values.push(this.value),this.indicesOfTasksToChange.forEach(i=>{e.chart.Vertices[i].setResource(this.key,this.value)}),d({plan:e,inverse:this.inverse()}))}inverse(){return new Nr(this.key,this.value,this.indicesOfTasksToChange)}},Nr=class{key;value;indicesOfTasksToChange;constructor(e,t,r=[]){this.key=e,this.value=t,this.indicesOfTasksToChange=r}applyTo(e){let t=e.getResourceDefinition(this.key);if(t===void 0)return v(`${this.key} doesn't exist as a Resource`);let r=t.values.findIndex(s=>s===this.value);if(r===-1)return v(`${this.value} does not exist as a value in the Resource ${this.key}.`);if(t.values.length===1)return v(`Resources must have at least one value. ${this.value} only has one value, so it can't be deleted. `);t.values.splice(r,1);let i=[];return e.chart.Vertices.forEach((s,o)=>{let a=s.getResource(this.key);a!==void 0&&a===this.value&&(s.setResource(this.key,t.values[0]),i.push(o))}),d({plan:e,inverse:this.inverse(i)})}inverse(e){return new _r(this.key,this.value,e)}},ls=class n{oldKey;newKey;constructor(e,t){this.oldKey=e,this.newKey=t}applyTo(e){let t=e.getResourceDefinition(this.oldKey);return t===void 0?v(`${this.oldKey} does not exist as a Resource`):e.getResourceDefinition(this.newKey)!==void 0?v(`${this.newKey} already exists as a resource name.`):(e.deleteResourceDefinition(this.oldKey),e.setResourceDefinition(this.newKey,t),e.chart.Vertices.forEach(i=>{let s=i.getResource(this.oldKey)||nn;i.setResource(this.newKey,s),i.deleteResource(this.oldKey)}),d({plan:e,inverse:this.inverse()}))}inverse(){return new n(this.newKey,this.oldKey)}},cs=class n{key;oldValue;newValue;constructor(e,t,r){this.key=e,this.oldValue=t,this.newValue=r}applyTo(e){let t=e.getResourceDefinition(this.key);if(t===void 0)return v(`${this.key} does not exist as a Resource`);let r=t.values.indexOf(this.oldValue);return r===-1?v(`${this.key} does not a value ${this.oldValue}`):t.values.indexOf(this.newValue)!==-1?v(`${this.key} already has a value ${this.newValue}`):(t.values.splice(r,1,this.newValue),e.chart.Vertices.forEach(s=>{s.getResource(this.key)===this.oldValue&&s.setResource(this.key,this.newValue)}),d({plan:e,inverse:this.inverse()}))}inverse(){return new n(this.key,this.newValue,this.oldValue)}},us=class n{key;oldIndex;newIndex;constructor(e,t,r){this.key=e,this.oldIndex=t,this.newIndex=r}applyTo(e){let t=e.getResourceDefinition(this.key);if(t===void 0)return v(`${this.key} does not exist as a Resource`);if(this.newIndex<0)return v(`${this.newIndex} is not a valid target value.`);if(this.oldIndex>t.values.length-1)return v(`${this.key} does not have a value at index ${this.oldIndex}`);if(this.newIndex>t.values.length-1)return v(`${this.key} does not have a value at index ${this.newIndex}`);let r=t.values[this.oldIndex];return t.values[this.oldIndex]=t.values[this.newIndex],t.values[this.newIndex]=r,d({plan:e,inverse:this.inverse()})}inverse(){return new n(this.key,this.newIndex,this.oldIndex)}},ds=class n{key;value;taskIndex;constructor(e,t,r){this.key=e,this.value=t,this.taskIndex=r}applyTo(e){let t=e.getResourceDefinition(this.key);if(t===void 0)return v(`${this.key} does not exist as a Resource`);if(t.values.findIndex(o=>o===this.value)===-1)return v(`${this.key} does not have a value of ${this.value}`);if(this.taskIndex<0||this.taskIndex>=e.chart.Vertices.length)return v(`There is no Task at index ${this.taskIndex}`);let i=e.chart.Vertices[this.taskIndex],s=i.getResource(this.key);return i.setResource(this.key,this.value),d({plan:e,inverse:this.inverse(s)})}inverse(e){return new n(this.key,e,this.taskIndex)}};function Hr(n){return new V([new Ir(n)],"AddResourceOp")}function Ko(n){return new V([new $r(n)],"DeleteResourceOp")}function Ur(n,e){return new V([new _r(n,e)],"AddResourceOptionOp")}function Vr(n,e){return new V([new Nr(n,e)],"DeleteResourceOptionOp")}function Go(n,e,t){return new V([new cs(n,e,t)],"RenameResourceOptionOp")}function Jo(n,e){return new V([new ls(n,e)],"RenameResourceOp")}function rn(n,e,t){return new V([new us(n,e,t)],"MoveResourceOptionOp")}function Ne(n,e,t){return new V([new ds(n,e,t)],"SetResourceValueOp")}var hs=class extends HTMLElement{explanMain=null;resourceDefinition=new Ge;name="";planDefinitionChangedCallback;newValueCounter=0;constructor(){super(),this.planDefinitionChangedCallback=()=>{this.render()}}connectedCallback(){document.addEventListener("plan-definition-changed",this.planDefinitionChangedCallback)}disconnectedCallback(){document.removeEventListener("plan-definition-changed",this.planDefinitionChangedCallback)}showModal(e,t,r){this.explanMain=e,this.resourceDefinition=r,this.name=t,this.render(),this.querySelector("dialog").showModal()}render(){N(this.template(),this)}cancel(){this.querySelector("dialog").close()}async executeOp(e){let t=await X(e,"planDefinitionChanged",!0,this.explanMain);return H(t),t}async changeResourceName(e,t,r){let i=await this.executeOp(Jo(r,t));H(i),this.name=t}async changeResourceValueName(e,t,r){let i=await this.executeOp(Go(this.name,r,t));H(i)}getProposedResourceName(){return this.newValueCounter++,`New Value ${this.newValueCounter}`}async newResourceValue(){this.newValueCounter=0;let e=this.getProposedResourceName();for(;this.explanMain.plan.resourceDefinitions[this.name].values.findIndex(t=>t===e)!=-1;)e=this.getProposedResourceName();await this.executeOp(Ur(this.name,e))}async moveUp(e,t){await this.executeOp(rn(this.name,t,t-1))}async moveDown(e,t){await this.executeOp(rn(this.name,t,t+1))}async moveToTop(e,t){await this.executeOp(rn(this.name,t,0))}async moveToBottom(e,t){await this.executeOp(rn(this.name,t,this.explanMain.plan.resourceDefinitions[this.name].values.length-1))}async deleteResourceValue(e,t){await this.executeOp(Vr(this.name,e))}template(){return k`
      <dialog>
        <label>
          Name:
          <input
            type="text"
            .value=${oe(this.name)}
            data-old-name=${this.name}
            @change=${e=>{let t=e.target;this.changeResourceName(e,t.value,t.dataset.oldName||"")}}
          />
        </label>
        <table>
          ${this.resourceDefinition.values.map((e,t)=>k`<tr>
                <td>
                  <input
                    data-old-value=${e}
                    @change=${r=>{let i=r.target;this.changeResourceValueName(r,i.value,i.dataset.oldValue||"")}}
                    .value=${oe(e)}
                    type="text"
                  />
                </td>
                <td>
                  <button
                    @click=${()=>this.moveUp(e,t)}
                    class="icon-button"
                    .disabled=${t===0}
                  >
                    ${Y("keyboard-up-icon")}
                  </button>
                </td>
                <td>
                  <button
                    .disabled=${t===this.resourceDefinition.values.length-1}
                    class="icon-button"
                    @click=${()=>this.moveDown(e,t)}
                  >
                    ${Y("keyboard-down-icon")}
                  </button>
                </td>
                <td>
                  <button
                    .disabled=${t===this.resourceDefinition.values.length-1}
                    class="icon-button"
                    @click=${()=>this.moveToBottom(e,t)}
                  >
                    ${Y("keyboard-double-down-icon")}
                  </button>
                </td>
                <td>
                  <button
                    .disabled=${t===0}
                    class="icon-button"
                    @click=${()=>this.moveToTop(e,t)}
                  >
                    ${Y("keyboard-double-up-icon")}
                  </button>
                </td>
                <td>
                  <button
                    .disabled=${this.resourceDefinition.values.length===1}
                    class="icon-button"
                    @click=${()=>this.deleteResourceValue(e,t)}
                  >
                    ${Y("delete-icon")}
                  </button>
                </td>
              </tr>`)}
          <tr>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td>
              <button
                @click=${()=>{this.newResourceValue()}}
              >
                New
              </button>
            </td>
          </tr>
        </table>
        <div class="dialog-footer">
          <button @click=${()=>this.cancel()}>Close</button>
        </div>
      </dialog>
    `}};customElements.define("edit-resource-definition",hs);var Ie=class n{_precision;constructor(e=0){Number.isFinite(e)||(e=0),this._precision=Math.abs(Math.trunc(e))}round(e){return+e.toFixed(this._precision)}rounder(){return e=>this.round(e)}get precision(){return this._precision}toJSON(){return{precision:this._precision}}static fromJSON(e){return e===void 0?new n:new n(e.precision)}};var $e=class n{range;default;isStatic;precision;hideEditor;constructor(e,t=new le,r=!1,i=new Ie(1),s=!1){this.precision=i,this.range=t,this.default=e,this.isStatic=r,this.hideEditor=s,this.rationalize()}rationalize(){this.range=new le(this.precision.round(this.range.min),this.precision.round(this.range.max)),this.default=this.clampAndRound(this.default)}clampAndRound(e){return this.precision.round(this.range.clamp(e))}toJSON(){return{range:this.range.toJSON(),default:this.default,precision:this.precision.toJSON()}}static fromJSON(e){return e===void 0?new n(0):new n(e.default||0,le.fromJSON(e.range),!1,Ie.fromJSON(e.precision))}};var ps=class extends HTMLElement{explanMain=null;planDefinitionChangedCallback;constructor(){super(),this.planDefinitionChangedCallback=()=>{this.explanMain!==null&&this.render()}}connectedCallback(){document.addEventListener("plan-definition-changed",this.planDefinitionChangedCallback)}disconnectedCallback(){document.removeEventListener("plan-definition-changed",this.planDefinitionChangedCallback)}render(){N(this.template(),this)}setConfig(e){this.explanMain=e,this.render()}template(){let e=this.explanMain.plan.metricDefinitions,t=Object.keys(e).sort((r,i)=>{let s=e[r],o=e[i];return s.isStatic===o.isStatic?r.localeCompare(i):s.isStatic?-1:1});return k` <h3>Metrics</h3>
      <table>
        <tr>
          <th>Name</th>
          <th>Min</th>
          <th>Max</th>
          <th>Default</th>
          <th></th>
          <th></th>
        </tr>

        ${t.map(r=>{let i=this.explanMain.plan.metricDefinitions[r];return k`
            <tr>
              <td>${r}</td>
              <td>${Ot(i.range.min)}</td>
              <td>${Ot(i.range.max)}</td>
              <td>${i.default}</td>
              <td>
                ${this.delButtonIfNotStatic(r,i.isStatic)}
              </td>
              <td>
                ${this.editButtonIfNotStatic(r,i.isStatic)}
              </td>
            </tr>
          `})}
        <tr>
          <td></td>
          <td></td>
          <td></td>
          <td></td>
          <td>
            <button
              class="icon-button"
              title="Add a new Resource."
              @click=${()=>{this.newMetric()}}
            >
              ${Y("add-icon")}
            </button>
          </td>
        </tr>
      </table>`}delButtonIfNotStatic(e,t){return t?k``:k`<button
      class="icon-button"
      title="Delete this metric."
      @click=${()=>this.deleteMetric(e)}
    >
      ${Y("delete-icon")}
    </button>`}async deleteMetric(e){let t=await X(bo(e),"planDefinitionChanged",!0,this.explanMain);H(t),this.render()}editButtonIfNotStatic(e,t){return t?k``:k`<button
      class="icon-button"
      title="Edit the resource definition."
      @click=${()=>this.editMetric(e)}
    >
      ${Y("edit-icon")}
    </button>`}editMetric(e){this.explanMain.querySelector("edit-metric-definition").showModal(this.explanMain,e)}async newMetric(){let e=await document.querySelector("prompt-dialog").prompt("Metric Name");if(e===null)return;if(e=e.trim(),e===""){fe(new Error("Metric names cannot be empty and must contain more than whitespace characters."));return}let t=await X(Pn(e,new $e(0)),"planDefinitionChanged",!0,this.explanMain);H(t),this.render()}};customElements.define("edit-metrics-panel",ps);var ms=class extends HTMLElement{explanMain=null;metricName="";planDefinitionChangedCallback;constructor(){super(),this.planDefinitionChangedCallback=()=>{this.render()}}connectedCallback(){document.addEventListener("plan-definition-changed",this.planDefinitionChangedCallback)}disconnectedCallback(){document.removeEventListener("plan-definition-changed",this.planDefinitionChangedCallback)}render(){N(this.template(),this)}template(){let e=this.explanMain?.plan.metricDefinitions[this.metricName];return e?k`<dialog>
      <table>
        <tr>
          <th>Name</th>
          <td>
            <input
              .value=${oe(this.metricName)}
              @change=${t=>this.nameChange(t)}
            />
          </td>
          <td></td>
        </tr>
        <tr>
          <th>Min</th>
          <td>
            <input
              .value=${oe(Ot(e.range.min))}
              ?disabled=${e.range.min===-Number.MAX_VALUE}
              @change=${t=>this.minChange(t)}
            />
          </td>
          <td>
            <label>
              <input
                type="checkbox"
                ?checked=${e.range.min!==-Number.MAX_VALUE}
                @change=${t=>{this.minLimitChange(t)}}
              />
              Limit</label
            >
          </td>
        </tr>
        <tr>
          <th>Max</th>
          <td>
            <input
              .value=${oe(Ot(e.range.max))}
              ?disabled=${e.range.max===Number.MAX_VALUE}
              @change=${t=>this.maxChange(t)}
            />
          </td>
          <td>
            <label>
              <input
                type="checkbox"
                ?checked=${e.range.max!==Number.MAX_VALUE}
                @change=${t=>{this.maxLimitChange(t)}}
              />
              Limit</label
            >
          </td>
        </tr>
        <tr>
          <th>Precision</th>
          <td>
            <input
              .value=${oe(e.precision.precision)}
              @change=${t=>{this.precisionChange(t)}}
            />
          </td>
          <td></td>
        </tr>
        <tr>
          <th>Default</th>
          <td>
            <input
              .value=${oe(e.default)}
              @change=${t=>{this.defaultChange(t)}}
            />
          </td>
          <td></td>
        </tr>
      </table>
      <div class="dialog-footer">
        <button @click=${()=>this.cancel()}>Close</button>
      </div>
    </dialog>`:k``}async executeOp(e){let t=await X(e,"planDefinitionChanged",!0,this.explanMain);return H(t),t}async minLimitChange(e){let t=e.target,r=this.getDefinitionCopy();if(t.checked){let i=0<r.range.max?0:r.range.max-1;r.range=new le(i,r.range.max)}else r.range=new le(-Number.MAX_VALUE,r.range.max);this.updateMetricDefinition(r)}async maxLimitChange(e){let t=e.target,r=this.getDefinitionCopy();if(t.checked){let i=100>r.range.min?100:r.range.min+1;r.range=new le(r.range.min,i)}else r.range=new le(r.range.min,Number.MAX_VALUE);this.updateMetricDefinition(r)}async nameChange(e){let t=e.target,r=this.metricName,i=t.value;this.metricName=i,(await this.executeOp(vo(r,i))).ok||(this.metricName=r),this.render()}async defaultChange(e){let t=e.target,r=this.getDefinitionCopy();r.default=+t.value,this.updateMetricDefinition(r)}async precisionChange(e){let t=e.target,r=this.getDefinitionCopy();r.precision=new Ie(+t.value),this.updateMetricDefinition(r)}async minChange(e){let r=+e.target.value,i=this.getDefinitionCopy();i.range=new le(r,i.range.max),this.updateMetricDefinition(i)}async maxChange(e){let r=+e.target.value,i=this.getDefinitionCopy();i.range=new le(i.range.min,r),this.updateMetricDefinition(i)}async updateMetricDefinition(e){e.rationalize();let t=await this.executeOp(ko(this.metricName,e));t.ok||fe(t.error),this.render()}getDefinitionCopy(){let e=this.explanMain?.plan.metricDefinitions[this.metricName];return $e.fromJSON(e?.toJSON())}cancel(){this.querySelector("dialog").close()}showModal(e,t){this.explanMain=e,this.metricName=t,this.render(),this.querySelector("dialog").showModal()}};customElements.define("edit-metric-definition",ms);var gs={pred:"Predecessors",succ:"Successors"},Xo=(n,e,t)=>k`
  <tr>
    <th>${gs[e]}</th>
    <th></th>
  </tr>
  ${t.map(r=>{let i=n.tasks[r];return k`<tr>
      <td>${i.name}</td>
      <td>
        <button
          class="icon-button"
          title="Delete the dependency on ${i.name}"
          @click=${()=>n.deleteDep(r,e)}
        >
          ${Y("delete-icon")}
        </button>
      </td>
    </tr>`})}
  <tr>
    <td></td>
    <td>
      <button
        class="icon-button"
        @click=${()=>n.addDep(e)}
        title="Add dependency."
      >
        ${Y("add-icon")}
      </button>
    </td>
  </tr>
`,Yo=n=>k`
  <table>
    ${Xo(n,"pred",n.predIndexes)}
    ${Xo(n,"succ",n.succIndexes)}
  </table>
`,fs=class extends HTMLElement{tasks=[];predIndexes=[];succIndexes=[];connectedCallback(){N(Yo(this),this)}setTasksAndIndices(e,t,r){this.tasks=e,this.predIndexes=t,this.succIndexes=r,N(Yo(this),this)}deleteDep(e,t){this.dispatchEvent(new CustomEvent("delete-dependency",{bubbles:!0,detail:{taskIndex:e,depType:t}}))}addDep(e){this.dispatchEvent(new CustomEvent("add-dependency",{bubbles:!0,detail:{taskIndex:-1,depType:e}}))}};customElements.define("dependencies-panel",fs);var Qo=(n,e,t)=>{let r=ot(n.Edges),i=s=>{if(t(n.Vertices[s],s)===!1)return;let o=r.get(s);o!==void 0&&o.forEach(a=>{i(a.j)})};i(e)};var cl=(n,e)=>{if(n>=e.Vertices.length-1||n<=0)return[];let t=new Set;return Qo(e,n,(r,i)=>(t.add(i),!0)),t.delete(e.Vertices.length-1),[...t.values()]},ul=(n,e)=>{if(n>=e.Vertices.length-1||n<=0)return[];let t=[n],r=new Set,i=Ct(e.Edges);for(;t.length!==0;){let s=t.pop();r.add(s);let o=i.get(s);o&&t.push(...o.map(a=>a.i))}return r.delete(0),[...r.values()]},Zo=n=>{let e=[];for(let t=1;t<n.Vertices.length-1;t++)e.push(t);return e},sn=(n,e)=>{let t=new Set(e);return n.filter(r=>t.has(r)===!1)},ea=(n,e)=>{let i=(ot(e.Edges).get(n)||[]).map(s=>s.j);return sn(Zo(e),[...ul(n,e),...i])},ta=(n,e)=>{let i=(Ct(e.Edges).get(n)||[]).map(l=>l.i),s=cl(n,e),o=Zo(e),a=[...s,...i];return sn(o,a)};var bs=class extends HTMLElement{titleElement=null;taskSearchControl=null;dialog=null;resolve=()=>{};connectedCallback(){this.titleElement=this.querySelector("h2"),this.taskSearchControl=this.querySelector("task-search-control"),this.dialog=this.querySelector("dialog"),this.dialog.addEventListener("cancel",()=>this.resolve(void 0)),this.taskSearchControl.addEventListener("task-change",e=>{this.dialog.close(),this.resolve(e.detail.taskIndex)})}selectDependency(e,t,r){this.titleElement.textContent=gs[r];let i=[];return r==="pred"?i=ta(t,e):i=ea(t,e),this.taskSearchControl.tasks=e.Vertices,this.taskSearchControl.includedIndexes=i,this.taskSearchControl.setKeyboardFocusToInput("name-only"),new Promise((o,a)=>{this.resolve=o,this.dialog.showModal()})}};customElements.define("add-dependency-dialog",bs);var na=80,vs=class extends HTMLElement{explanMain=null;planDefinitionChangedCallback;constructor(){super(),this.planDefinitionChangedCallback=()=>{this.explanMain!==null&&this.render()}}connectedCallback(){document.addEventListener("plan-definition-changed",this.planDefinitionChangedCallback)}disconnectedCallback(){document.removeEventListener("plan-definition-changed",this.planDefinitionChangedCallback)}setConfig(e){this.explanMain=e,this.render()}render(){N(this.template(),this)}valuesToShortString(e){let t=e.join(", ");return t.length>na&&(t=t.slice(0,na)+" ..."),t}delButtonIfNotStatic(e,t){return t?k``:k`<button
      class="icon-button"
      title="Delete this resource."
      @click=${()=>this.deleteResource(e)}
    >
      ${Y("delete-icon")}
    </button>`}editButtonIfNotStatic(e,t){return t?k``:k`<button
      class="icon-button"
      title="Edit the resource definition."
      @click=${()=>this.editResource(e)}
    >
      ${Y("edit-icon")}
    </button>`}async deleteResource(e){let t=await X(Ko(e),"planDefinitionChanged",!0,this.explanMain);H(t),this.render()}editResource(e){this.explanMain.querySelector("edit-resource-definition").showModal(this.explanMain,e,this.explanMain.plan.resourceDefinitions[e])}async newResource(){let e=await document.querySelector("prompt-dialog").prompt("Metric Name");if(e===null)return;if(e=e.trim(),e===""){fe(new Error("Resource names cannot be empty and must contain more than whitespace characters."));return}let t=await X(Hr(e),"planDefinitionChanged",!0,this.explanMain);H(t),this.render()}template(){let e=this.explanMain.plan.resourceDefinitions,t=Object.keys(e).sort((r,i)=>{let s=e[r],o=e[i];return s.isStatic===o.isStatic?r.localeCompare(i):s.isStatic?-1:1});return k`
      <h3>Resources</h3>
      <table>
        <tr>
          <th>Name</th>
          <th>Values</th>
          <th>Delete</th>
          <th>Edit</th>
        </tr>
        ${t.map(r=>{let i=e[r];return k`<tr>
            <td>${r}</td>
            <td>${this.valuesToShortString(i.values)}</td>
            <td>${this.delButtonIfNotStatic(r,i.isStatic)}</td>
            <td>${this.editButtonIfNotStatic(r,i.isStatic)}</td>
          </tr>`})}
        <tr>
          <td></td>
          <td></td>
          <td></td>
          <td>
            <button
              class="icon-button"
              title="Add a new Resource."
              @click=${()=>{this.newResource()}}
            >
              ${Y("add-icon")}
            </button>
          </td>
        </tr>
      </table>
    `}};customElements.define("edit-resources-panel",vs);var Fr=class{a;b;c;F_c;constructor(e,t,r){this.a=e,this.b=t,this.c=r,this.F_c=(r-e)/(t-e)}sample(e){return e<0?0:e>1?1:e<this.F_c?this.a+Math.sqrt(e*(this.b-this.a)*(this.c-this.a)):this.b-Math.sqrt((1-e)*(this.b-this.a)*(this.b-this.c))}};var ks={low:1.1,moderate:1.5,high:2,extreme:5},Br=class{triangular;constructor(e,t){let r=ks[t];this.triangular=new Fr(e/r,e*r,e)}sample(e){return this.triangular.sample(e)}};var ra={Duration:new $e(0,new le(0),!0,new Ie(0),!0)},ia={Uncertainty:new Ge(Object.keys(ks),!0)},He=class n{chart;_durationUnits;_status={stage:"unstarted",start:0};taskCompletion={};resourceDefinitions;metricDefinitions;get status(){return this._status}get durationUnits(){return this._durationUnits}set status(e){this._status=e,this._durationUnits=Or[this._durationUnits.kind()](new Date(Kt(this.status)),this.getStaticMetricDefinition("Duration"))}setTaskCompletion(e,t){let r=this.chart.Vertices[e];return r===void 0?v(new Error(`${e} is not a valid Task index.`)):(this.taskCompletion[r.id]=t,d(null))}getTaskCompletion(e){let t=this.chart.Vertices[e];return t===void 0?v(new Error(`${e} is not a valid Task index.`)):d(this.taskCompletion[t.id]||{stage:"unstarted"})}constructor(){this.chart=new Gt,this.resourceDefinitions=Object.assign({},ia),this.metricDefinitions=Object.assign({},ra),this._durationUnits=new tn(new Date(Kt(this.status)),this.getStaticMetricDefinition("Duration")),this.applyMetricsAndResourcesToVertices()}setDurationUnits(e){let t=$t(this._durationUnits.kind()),r=$t(e);this._durationUnits=Or[e](new Date(Kt(this.status)),this.getStaticMetricDefinition("Duration")),this.chart.Vertices.forEach(i=>{let s=jo(i.duration,t,r);if(!s.ok){reportError(s.error);return}i.duration=s.value})}getStaticMetricDefinition(e){return this.metricDefinitions[e]}getStaticResourceDefinition(e){return this.resourceDefinitions[e]}applyMetricsAndResourcesToVertices(){Object.keys(this.metricDefinitions).forEach(e=>{let t=this.metricDefinitions[e];this.chart.Vertices.forEach(r=>{r.setMetric(e,t.default)})}),Object.entries(this.resourceDefinitions).forEach(([e,t])=>{this.chart.Vertices.forEach(r=>{r.setResource(e,t.values[0])})})}getMetricDefinition(e){return this.metricDefinitions[e]}setMetricDefinition(e,t){this.metricDefinitions[e]=t}deleteMetricDefinition(e){delete this.metricDefinitions[e]}getResourceDefinition(e){return this.resourceDefinitions[e]}setResourceDefinition(e,t){this.resourceDefinitions[e]=t}deleteResourceDefinition(e){delete this.resourceDefinitions[e]}newTask(){let e=new Tt;return Object.keys(this.metricDefinitions).forEach(t=>{let r=this.getMetricDefinition(t);e.setMetric(t,r.default)}),Object.entries(this.resourceDefinitions).forEach(([t,r])=>{e.setResource(t,r.values[0])}),e}toJSON(){return{status:On(this.status),taskCompletion:_n(this.taskCompletion),_durationUnits:this._durationUnits.toJSON(),chart:this.chart.toJSON(),resourceDefinitions:Object.fromEntries(Object.entries(this.resourceDefinitions).filter(([e,t])=>!t.isStatic).map(([e,t])=>[e,t.toJSON()])),metricDefinitions:Object.fromEntries(Object.entries(this.metricDefinitions).filter(([e,t])=>!t.isStatic).map(([e,t])=>[e,t.toJSON()]))}}static fromJSON(e){let t=new n;t.chart=Gt.fromJSON(e.chart),t.status=Ln(e.status),t.taskCompletion=Nn(e.taskCompletion);let r=Object.fromEntries(Object.entries(e.metricDefinitions).map(([s,o])=>[s,$e.fromJSON(o)]));t.metricDefinitions=Object.assign({},ra,r);let i=Object.fromEntries(Object.entries(e.resourceDefinitions).map(([s,o])=>[s,Ge.fromJSON(o)]));return t.resourceDefinitions=Object.assign({},ia,i),t._durationUnits=St.fromJSON(e._durationUnits,new Date(Kt(t.status)),t.getStaticMetricDefinition("Duration")),t}static FromJSONText=e=>{try{let t=JSON.parse(e),r=n.fromJSON(t),i=Do().applyTo(r);if(!i.ok)return i;let s=lt(r.chart);return s.ok?d(r):s}catch(t){return v(t)}}};var dl="aaa1rp3bb0ott3vie4c1le2ogado5udhabi7c0ademy5centure6ountant0s9o1tor4d0s1ult4e0g1ro2tna4f0l1rica5g0akhan5ency5i0g1rbus3force5tel5kdn3l0ibaba4pay4lfinanz6state5y2sace3tom5m0azon4ericanexpress7family11x2fam3ica3sterdam8nalytics7droid5quan4z2o0l2partments8p0le4q0uarelle8r0ab1mco4chi3my2pa2t0e3s0da2ia2sociates9t0hleta5torney7u0ction5di0ble3o3spost5thor3o0s4w0s2x0a2z0ure5ba0by2idu3namex4d1k2r0celona5laycard4s5efoot5gains6seball5ketball8uhaus5yern5b0c1t1va3cg1n2d1e0ats2uty4er2rlin4st0buy5t2f1g1h0arti5i0ble3d1ke2ng0o3o1z2j1lack0friday9ockbuster8g1omberg7ue3m0s1w2n0pparibas9o0ats3ehringer8fa2m1nd2o0k0ing5sch2tik2on4t1utique6x2r0adesco6idgestone9oadway5ker3ther5ussels7s1t1uild0ers6siness6y1zz3v1w1y1z0h3ca0b1fe2l0l1vinklein9m0era3p2non3petown5ital0one8r0avan4ds2e0er0s4s2sa1e1h1ino4t0ering5holic7ba1n1re3c1d1enter4o1rn3f0a1d2g1h0anel2nel4rity4se2t2eap3intai5ristmas6ome4urch5i0priani6rcle4sco3tadel4i0c2y3k1l0aims4eaning6ick2nic1que6othing5ud3ub0med6m1n1o0ach3des3ffee4llege4ogne5m0mbank4unity6pany2re3uter5sec4ndos3struction8ulting7tact3ractors9oking4l1p2rsica5untry4pon0s4rses6pa2r0edit0card4union9icket5own3s1uise0s6u0isinella9v1w1x1y0mru3ou3z2dad1nce3ta1e1ing3sun4y2clk3ds2e0al0er2s3gree4livery5l1oitte5ta3mocrat6ntal2ist5si0gn4v2hl2iamonds6et2gital5rect0ory7scount3ver5h2y2j1k1m1np2o0cs1tor4g1mains5t1wnload7rive4tv2ubai3nlop4pont4rban5vag2r2z2earth3t2c0o2deka3u0cation8e1g1mail3erck5nergy4gineer0ing9terprises10pson4quipment8r0icsson6ni3s0q1tate5t1u0rovision8s2vents5xchange6pert3osed4ress5traspace10fage2il1rwinds6th3mily4n0s2rm0ers5shion4t3edex3edback6rrari3ero6i0delity5o2lm2nal1nce1ial7re0stone6mdale6sh0ing5t0ness6j1k1lickr3ghts4r2orist4wers5y2m1o0o0d1tball6rd1ex2sale4um3undation8x2r0ee1senius7l1ogans4ntier7tr2ujitsu5n0d2rniture7tbol5yi3ga0l0lery3o1up4me0s3p1rden4y2b0iz3d0n2e0a1nt0ing5orge5f1g0ee3h1i0ft0s3ves2ing5l0ass3e1obal2o4m0ail3bh2o1x2n1odaddy5ld0point6f2o0dyear5g0le4p1t1v2p1q1r0ainger5phics5tis4een3ipe3ocery4up4s1t1u0cci3ge2ide2tars5ru3w1y2hair2mburg5ngout5us3bo2dfc0bank7ealth0care8lp1sinki6re1mes5iphop4samitsu7tachi5v2k0t2m1n1ockey4ldings5iday5medepot5goods5s0ense7nda3rse3spital5t0ing5t0els3mail5use3w2r1sbc3t1u0ghes5yatt3undai7ibm2cbc2e1u2d1e0ee3fm2kano4l1m0amat4db2mo0bilien9n0c1dustries8finiti5o2g1k1stitute6urance4e4t0ernational10uit4vestments10o1piranga7q1r0ish4s0maili5t0anbul7t0au2v3jaguar4va3cb2e0ep2tzt3welry6io2ll2m0p2nj2o0bs1urg4t1y2p0morgan6rs3uegos4niper7kaufen5ddi3e0rryhotels6properties14fh2g1h1i0a1ds2m1ndle4tchen5wi3m1n1oeln3matsu5sher5p0mg2n2r0d1ed3uokgroup8w1y0oto4z2la0caixa5mborghini8er3nd0rover6xess5salle5t0ino3robe5w0yer5b1c1ds2ease3clerc5frak4gal2o2xus4gbt3i0dl2fe0insurance9style7ghting6ke2lly3mited4o2ncoln4k2ve1ing5k1lc1p2oan0s3cker3us3l1ndon4tte1o3ve3pl0financial11r1s1t0d0a3u0ndbeck6xe1ury5v1y2ma0drid4if1son4keup4n0agement7go3p1rket0ing3s4riott5shalls7ttel5ba2c0kinsey7d1e0d0ia3et2lbourne7me1orial6n0u2rckmsd7g1h1iami3crosoft7l1ni1t2t0subishi9k1l0b1s2m0a2n1o0bi0le4da2e1i1m1nash3ey2ster5rmon3tgage6scow4to0rcycles9v0ie4p1q1r1s0d2t0n1r2u0seum3ic4v1w1x1y1z2na0b1goya4me2vy3ba2c1e0c1t0bank4flix4work5ustar5w0s2xt0direct7us4f0l2g0o2hk2i0co2ke1on3nja3ssan1y5l1o0kia3rton4w0ruz3tv4p1r0a1w2tt2u1yc2z2obi1server7ffice5kinawa6layan0group9lo3m0ega4ne1g1l0ine5oo2pen3racle3nge4g0anic5igins6saka4tsuka4t2vh3pa0ge2nasonic7ris2s1tners4s1y3y2ccw3e0t2f0izer5g1h0armacy6d1ilips5one2to0graphy6s4ysio5ics1tet2ures6d1n0g1k2oneer5zza4k1l0ace2y0station9umbing5s3m1n0c2ohl2ker3litie5rn2st3r0america6xi3ess3ime3o0d0uctions8f1gressive8mo2perties3y5tection8u0dential9s1t1ub2w0c2y2qa1pon3uebec3st5racing4dio4e0ad1lestate6tor2y4cipes5d0stone5umbrella9hab3ise0n3t2liance6n0t0als5pair3ort3ublican8st0aurant8view0s5xroth6ich0ardli6oh3l1o1p2o0cks3deo3gers4om3s0vp3u0gby3hr2n2w0e2yukyu6sa0arland6fe0ty4kura4le1on3msclub4ung5ndvik0coromant12ofi4p1rl2s1ve2xo3b0i1s2c0b1haeffler7midt4olarships8ol3ule3warz5ience5ot3d1e0arch3t2cure1ity6ek2lect4ner3rvices6ven3w1x0y3fr2g1h0angrila6rp3ell3ia1ksha5oes2p0ping5uji3w3i0lk2na1gles5te3j1k0i0n2y0pe4l0ing4m0art3ile4n0cf3o0ccer3ial4ftbank4ware6hu2lar2utions7ng1y2y2pa0ce3ort2t3r0l2s1t0ada2ples4r1tebank4farm7c0group6ockholm6rage3e3ream4udio2y3yle4u0cks3pplies3y2ort5rf1gery5zuki5v1watch4iss4x1y0dney4stems6z2tab1ipei4lk2obao4rget4tamotors6r2too4x0i3c0i2d0k2eam2ch0nology8l1masek5nnis4va3f1g1h0d1eater2re6iaa2ckets5enda4ps2res2ol4j0maxx4x2k0maxx5l1m0all4n1o0day3kyo3ols3p1ray3shiba5tal3urs3wn2yota3s3r0ade1ing4ining5vel0ers0insurance16ust3v2t1ube2i1nes3shu4v0s2w1z2ua1bank3s2g1k1nicom3versity8o2ol2ps2s1y1z2va0cations7na1guard7c1e0gas3ntures6risign5m\xF6gensberater2ung14sicherung10t2g1i0ajes4deo3g1king4llas4n1p1rgin4sa1ion4va1o3laanderen9n1odka3lvo3te1ing3o2yage5u2wales2mart4ter4ng0gou5tch0es6eather0channel12bcam3er2site5d0ding5ibo2r3f1hoswho6ien2ki2lliamhill9n0dows4e1ners6me2olterskluwer11odside6rk0s2ld3w2s1tc1f3xbox3erox4ihuan4n2xx2yz3yachts4hoo3maxun5ndex5e1odobashi7ga2kohama6u0tube6t1un3za0ppos4ra3ero3ip2m1one3uerich6w2",hl="\u03B5\u03BB1\u03C52\u0431\u04331\u0435\u043B3\u0434\u0435\u0442\u04384\u0435\u044E2\u043A\u0430\u0442\u043E\u043B\u0438\u043A6\u043E\u043C3\u043C\u043A\u04342\u043E\u043D1\u0441\u043A\u0432\u04306\u043E\u043D\u043B\u0430\u0439\u043D5\u0440\u04333\u0440\u0443\u04412\u04442\u0441\u0430\u0439\u04423\u0440\u04313\u0443\u043A\u04403\u049B\u0430\u04373\u0570\u0561\u05753\u05D9\u05E9\u05E8\u05D0\u05DC5\u05E7\u05D5\u05DD3\u0627\u0628\u0648\u0638\u0628\u064A5\u0631\u0627\u0645\u0643\u06485\u0644\u0627\u0631\u062F\u06464\u0628\u062D\u0631\u064A\u06465\u062C\u0632\u0627\u0626\u06315\u0633\u0639\u0648\u062F\u064A\u06296\u0639\u0644\u064A\u0627\u06465\u0645\u063A\u0631\u06285\u0645\u0627\u0631\u0627\u062A5\u06CC\u0631\u0627\u06465\u0628\u0627\u0631\u062A2\u0632\u0627\u06314\u064A\u062A\u06433\u06BE\u0627\u0631\u062A5\u062A\u0648\u0646\u06334\u0633\u0648\u062F\u0627\u06463\u0631\u064A\u06295\u0634\u0628\u0643\u06294\u0639\u0631\u0627\u06422\u06282\u0645\u0627\u06464\u0641\u0644\u0633\u0637\u064A\u06466\u0642\u0637\u06313\u0643\u0627\u062B\u0648\u0644\u064A\u06436\u0648\u06453\u0645\u0635\u06312\u0644\u064A\u0633\u064A\u06275\u0648\u0631\u064A\u062A\u0627\u0646\u064A\u06277\u0642\u06394\u0647\u0645\u0631\u0627\u06475\u067E\u0627\u06A9\u0633\u062A\u0627\u06467\u0680\u0627\u0631\u062A4\u0915\u0949\u092E3\u0928\u0947\u091F3\u092D\u093E\u0930\u09240\u092E\u094D3\u094B\u09245\u0938\u0902\u0917\u0920\u09285\u09AC\u09BE\u0982\u09B2\u09BE5\u09AD\u09BE\u09B0\u09A42\u09F0\u09A44\u0A2D\u0A3E\u0A30\u0A244\u0AAD\u0ABE\u0AB0\u0AA44\u0B2D\u0B3E\u0B30\u0B244\u0B87\u0BA8\u0BCD\u0BA4\u0BBF\u0BAF\u0BBE6\u0BB2\u0B99\u0BCD\u0B95\u0BC86\u0B9A\u0BBF\u0B99\u0BCD\u0B95\u0BAA\u0BCD\u0BAA\u0BC2\u0BB0\u0BCD11\u0C2D\u0C3E\u0C30\u0C24\u0C4D5\u0CAD\u0CBE\u0CB0\u0CA44\u0D2D\u0D3E\u0D30\u0D24\u0D025\u0DBD\u0D82\u0D9A\u0DCF4\u0E04\u0E2D\u0E213\u0E44\u0E17\u0E223\u0EA5\u0EB2\u0EA73\u10D2\u10D42\u307F\u3093\u306A3\u30A2\u30DE\u30BE\u30F34\u30AF\u30E9\u30A6\u30C94\u30B0\u30FC\u30B0\u30EB4\u30B3\u30E02\u30B9\u30C8\u30A23\u30BB\u30FC\u30EB3\u30D5\u30A1\u30C3\u30B7\u30E7\u30F36\u30DD\u30A4\u30F3\u30C84\u4E16\u754C2\u4E2D\u4FE11\u56FD1\u570B1\u6587\u7F513\u4E9A\u9A6C\u900A3\u4F01\u4E1A2\u4F5B\u5C712\u4FE1\u606F2\u5065\u5EB72\u516B\u53662\u516C\u53F81\u76CA2\u53F0\u6E7E1\u70632\u5546\u57CE1\u5E971\u68072\u5609\u91CC0\u5927\u9152\u5E975\u5728\u7EBF2\u5927\u62FF2\u5929\u4E3B\u65593\u5A31\u4E502\u5BB6\u96FB2\u5E7F\u4E1C2\u5FAE\u535A2\u6148\u55842\u6211\u7231\u4F603\u624B\u673A2\u62DB\u80582\u653F\u52A11\u5E9C2\u65B0\u52A0\u57612\u95FB2\u65F6\u5C1A2\u66F8\u7C4D2\u673A\u67842\u6DE1\u9A6C\u95213\u6E38\u620F2\u6FB3\u95802\u70B9\u770B2\u79FB\u52A82\u7EC4\u7EC7\u673A\u67844\u7F51\u57401\u5E971\u7AD91\u7EDC2\u8054\u901A2\u8C37\u6B4C2\u8D2D\u72692\u901A\u8CA92\u96C6\u56E22\u96FB\u8A0A\u76C8\u79D14\u98DE\u5229\u6D663\u98DF\u54C12\u9910\u53852\u9999\u683C\u91CC\u62C93\u6E2F2\uB2F7\uB1371\uCEF42\uC0BC\uC1312\uD55C\uAD6D2",Ht=(n,e)=>{for(let t in e)n[t]=e[t];return n},Rs="numeric",Ds="ascii",Ms="alpha",ln="asciinumeric",an="alphanumeric",Cs="domain",da="emoji",pl="scheme",ml="slashscheme",Ts="whitespace";function fl(n,e){return n in e||(e[n]=[]),e[n]}function wt(n,e,t){e[Rs]&&(e[ln]=!0,e[an]=!0),e[Ds]&&(e[ln]=!0,e[Ms]=!0),e[ln]&&(e[an]=!0),e[Ms]&&(e[an]=!0),e[an]&&(e[Cs]=!0),e[da]&&(e[Cs]=!0);for(let r in e){let i=fl(r,t);i.indexOf(n)<0&&i.push(n)}}function gl(n,e){let t={};for(let r in e)e[r].indexOf(n)>=0&&(t[r]=!0);return t}function Ee(n=null){this.j={},this.jr=[],this.jd=null,this.t=n}Ee.groups={};Ee.prototype={accepts(){return!!this.t},go(n){let e=this,t=e.j[n];if(t)return t;for(let r=0;r<e.jr.length;r++){let i=e.jr[r][0],s=e.jr[r][1];if(s&&i.test(n))return s}return e.jd},has(n,e=!1){return e?n in this.j:!!this.go(n)},ta(n,e,t,r){for(let i=0;i<n.length;i++)this.tt(n[i],e,t,r)},tr(n,e,t,r){r=r||Ee.groups;let i;return e&&e.j?i=e:(i=new Ee(e),t&&r&&wt(e,t,r)),this.jr.push([n,i]),i},ts(n,e,t,r){let i=this,s=n.length;if(!s)return i;for(let o=0;o<s-1;o++)i=i.tt(n[o]);return i.tt(n[s-1],e,t,r)},tt(n,e,t,r){r=r||Ee.groups;let i=this;if(e&&e.j)return i.j[n]=e,e;let s=e,o,a=i.go(n);if(a?(o=new Ee,Ht(o.j,a.j),o.jr.push.apply(o.jr,a.jr),o.jd=a.jd,o.t=a.t):o=new Ee,s){if(r)if(o.t&&typeof o.t=="string"){let l=Ht(gl(o.t,r),t);wt(s,l,r)}else t&&wt(s,t,r);o.t=s}return i.j[n]=o,o}};var I=(n,e,t,r,i)=>n.ta(e,t,r,i),ne=(n,e,t,r,i)=>n.tr(e,t,r,i),sa=(n,e,t,r,i)=>n.ts(e,t,r,i),g=(n,e,t,r,i)=>n.tt(e,t,r,i),Ye="WORD",As="UWORD",ha="ASCIINUMERICAL",pa="ALPHANUMERICAL",mn="LOCALHOST",Ps="TLD",Os="UTLD",qr="SCHEME",Nt="SLASH_SCHEME",Is="NUM",Ls="WS",$s="NL",cn="OPENBRACE",un="CLOSEBRACE",Kr="OPENBRACKET",Gr="CLOSEBRACKET",Jr="OPENPAREN",Xr="CLOSEPAREN",Yr="OPENANGLEBRACKET",Qr="CLOSEANGLEBRACKET",Zr="FULLWIDTHLEFTPAREN",ei="FULLWIDTHRIGHTPAREN",ti="LEFTCORNERBRACKET",ni="RIGHTCORNERBRACKET",ri="LEFTWHITECORNERBRACKET",ii="RIGHTWHITECORNERBRACKET",si="FULLWIDTHLESSTHAN",oi="FULLWIDTHGREATERTHAN",ai="AMPERSAND",li="APOSTROPHE",ci="ASTERISK",dt="AT",ui="BACKSLASH",di="BACKTICK",hi="CARET",ht="COLON",_s="COMMA",pi="DOLLAR",Ue="DOT",mi="EQUALS",Ns="EXCLAMATION",Le="HYPHEN",dn="PERCENT",fi="PIPE",gi="PLUS",bi="POUND",hn="QUERY",Hs="QUOTE",ma="FULLWIDTHMIDDLEDOT",Us="SEMI",Ve="SLASH",pn="TILDE",vi="UNDERSCORE",fa="EMOJI",ki="SYM",ga=Object.freeze({__proto__:null,ALPHANUMERICAL:pa,AMPERSAND:ai,APOSTROPHE:li,ASCIINUMERICAL:ha,ASTERISK:ci,AT:dt,BACKSLASH:ui,BACKTICK:di,CARET:hi,CLOSEANGLEBRACKET:Qr,CLOSEBRACE:un,CLOSEBRACKET:Gr,CLOSEPAREN:Xr,COLON:ht,COMMA:_s,DOLLAR:pi,DOT:Ue,EMOJI:fa,EQUALS:mi,EXCLAMATION:Ns,FULLWIDTHGREATERTHAN:oi,FULLWIDTHLEFTPAREN:Zr,FULLWIDTHLESSTHAN:si,FULLWIDTHMIDDLEDOT:ma,FULLWIDTHRIGHTPAREN:ei,HYPHEN:Le,LEFTCORNERBRACKET:ti,LEFTWHITECORNERBRACKET:ri,LOCALHOST:mn,NL:$s,NUM:Is,OPENANGLEBRACKET:Yr,OPENBRACE:cn,OPENBRACKET:Kr,OPENPAREN:Jr,PERCENT:dn,PIPE:fi,PLUS:gi,POUND:bi,QUERY:hn,QUOTE:Hs,RIGHTCORNERBRACKET:ni,RIGHTWHITECORNERBRACKET:ii,SCHEME:qr,SEMI:Us,SLASH:Ve,SLASH_SCHEME:Nt,SYM:ki,TILDE:pn,TLD:Ps,UNDERSCORE:vi,UTLD:Os,UWORD:As,WORD:Ye,WS:Ls}),Je=/[a-z]/,on=/\p{L}/u,ys=/\p{Emoji}/u;var Xe=/\d/,xs=/\s/;var oa="\r",Es=`
`,bl="\uFE0F",vl="\u200D",Ss="\uFFFC",zr=null,jr=null;function kl(n=[]){let e={};Ee.groups=e;let t=new Ee;zr==null&&(zr=aa(dl)),jr==null&&(jr=aa(hl)),g(t,"'",li),g(t,"{",cn),g(t,"}",un),g(t,"[",Kr),g(t,"]",Gr),g(t,"(",Jr),g(t,")",Xr),g(t,"<",Yr),g(t,">",Qr),g(t,"\uFF08",Zr),g(t,"\uFF09",ei),g(t,"\u300C",ti),g(t,"\u300D",ni),g(t,"\u300E",ri),g(t,"\u300F",ii),g(t,"\uFF1C",si),g(t,"\uFF1E",oi),g(t,"&",ai),g(t,"*",ci),g(t,"@",dt),g(t,"`",di),g(t,"^",hi),g(t,":",ht),g(t,",",_s),g(t,"$",pi),g(t,".",Ue),g(t,"=",mi),g(t,"!",Ns),g(t,"-",Le),g(t,"%",dn),g(t,"|",fi),g(t,"+",gi),g(t,"#",bi),g(t,"?",hn),g(t,'"',Hs),g(t,"/",Ve),g(t,";",Us),g(t,"~",pn),g(t,"_",vi),g(t,"\\",ui),g(t,"\u30FB",ma);let r=ne(t,Xe,Is,{[Rs]:!0});ne(r,Xe,r);let i=ne(r,Je,ha,{[ln]:!0}),s=ne(r,on,pa,{[an]:!0}),o=ne(t,Je,Ye,{[Ds]:!0});ne(o,Xe,i),ne(o,Je,o),ne(i,Xe,i),ne(i,Je,i);let a=ne(t,on,As,{[Ms]:!0});ne(a,Je),ne(a,Xe,s),ne(a,on,a),ne(s,Xe,s),ne(s,Je),ne(s,on,s);let l=g(t,Es,$s,{[Ts]:!0}),h=g(t,oa,Ls,{[Ts]:!0}),u=ne(t,xs,Ls,{[Ts]:!0});g(t,Ss,u),g(h,Es,l),g(h,Ss,u),ne(h,xs,u),g(u,oa),g(u,Es),ne(u,xs,u),g(u,Ss,u);let p=ne(t,ys,fa,{[da]:!0});g(p,"#"),ne(p,ys,p),g(p,bl,p);let m=g(p,vl);g(m,"#"),ne(m,ys,p);let T=[[Je,o],[Xe,i]],S=[[Je,null],[on,a],[Xe,s]];for(let P=0;P<zr.length;P++)ut(t,zr[P],Ps,Ye,T);for(let P=0;P<jr.length;P++)ut(t,jr[P],Os,As,S);wt(Ps,{tld:!0,ascii:!0},e),wt(Os,{utld:!0,alpha:!0},e),ut(t,"file",qr,Ye,T),ut(t,"mailto",qr,Ye,T),ut(t,"http",Nt,Ye,T),ut(t,"https",Nt,Ye,T),ut(t,"ftp",Nt,Ye,T),ut(t,"ftps",Nt,Ye,T),wt(qr,{scheme:!0,ascii:!0},e),wt(Nt,{slashscheme:!0,ascii:!0},e),n=n.sort((P,C)=>P[0]>C[0]?1:-1);for(let P=0;P<n.length;P++){let C=n[P][0],$=n[P][1]?{[pl]:!0}:{[ml]:!0};C.indexOf("-")>=0?$[Cs]=!0:Je.test(C)?Xe.test(C)?$[ln]=!0:$[Ds]=!0:$[Rs]=!0,sa(t,C,C,$)}return sa(t,"localhost",mn,{ascii:!0}),t.jd=new Ee(ki),{start:t,tokens:Ht({groups:e},ga)}}function ba(n,e){let t=Tl(e.replace(/[A-Z]/g,a=>a.toLowerCase())),r=t.length,i=[],s=0,o=0;for(;o<r;){let a=n,l=null,h=0,u=null,p=-1,m=-1;for(;o<r&&(l=a.go(t[o]));)a=l,a.accepts()?(p=0,m=0,u=a):p>=0&&(p+=t[o].length,m++),h+=t[o].length,s+=t[o].length,o++;s-=p,o-=m,h-=p,i.push({t:u.t,v:e.slice(s-h,s),s:s-h,e:s})}return i}function Tl(n){let e=[],t=n.length,r=0;for(;r<t;){let i=n.charCodeAt(r),s,o=i<55296||i>56319||r+1===t||(s=n.charCodeAt(r+1))<56320||s>57343?n[r]:n.slice(r,r+2);e.push(o),r+=o.length}return e}function ut(n,e,t,r,i){let s,o=e.length;for(let a=0;a<o-1;a++){let l=e[a];n.j[l]?s=n.j[l]:(s=new Ee(r),s.jr=i.slice(),n.j[l]=s),n=s}return s=new Ee(t),s.jr=i.slice(),n.j[e[o-1]]=s,s}function aa(n){let e=[],t=[],r=0,i="0123456789";for(;r<n.length;){let s=0;for(;i.indexOf(n[r+s])>=0;)s++;if(s>0){e.push(t.join(""));for(let o=parseInt(n.substring(r,r+s),10);o>0;o--)t.pop();r+=s}else t.push(n[r]),r++}return e}var fn={defaultProtocol:"http",events:null,format:la,formatHref:la,nl2br:!1,tagName:"a",target:null,rel:null,validate:!0,truncate:1/0,className:null,attributes:null,ignoreTags:[],render:null};function Ti(n,e=null){let t=Ht({},fn);n&&(t=Ht(t,n instanceof Ti?n.o:n));let r=t.ignoreTags,i=[];for(let s=0;s<r.length;s++)i.push(r[s].toUpperCase());this.o=t,e&&(this.defaultRender=e),this.ignoreTags=i}Ti.prototype={o:fn,ignoreTags:[],defaultRender(n){return n},check(n){return this.get("validate",n.toString(),n)},get(n,e,t){let r=e!=null,i=this.o[n];return i&&(typeof i=="object"?(i=t.t in i?i[t.t]:fn[n],typeof i=="function"&&r&&(i=i(e,t))):typeof i=="function"&&r&&(i=i(e,t.t,t)),i)},getObj(n,e,t){let r=this.o[n];return typeof r=="function"&&e!=null&&(r=r(e,t.t,t)),r},render(n){let e=n.render(this);return(this.get("render",null,n)||this.defaultRender)(e,n.t,n)}};function la(n){return n}function va(n,e){this.t="token",this.v=n,this.tk=e}va.prototype={isLink:!1,toString(){return this.v},toHref(n){return this.toString()},toFormattedString(n){let e=this.toString(),t=n.get("truncate",e,this),r=n.get("format",e,this);return t&&r.length>t?r.substring(0,t)+"\u2026":r},toFormattedHref(n){return n.get("formatHref",this.toHref(n.get("defaultProtocol")),this)},startIndex(){return this.tk[0].s},endIndex(){return this.tk[this.tk.length-1].e},toObject(n=fn.defaultProtocol){return{type:this.t,value:this.toString(),isLink:this.isLink,href:this.toHref(n),start:this.startIndex(),end:this.endIndex()}},toFormattedObject(n){return{type:this.t,value:this.toFormattedString(n),isLink:this.isLink,href:this.toFormattedHref(n),start:this.startIndex(),end:this.endIndex()}},validate(n){return n.get("validate",this.toString(),this)},render(n){let e=this,t=this.toHref(n.get("defaultProtocol")),r=n.get("formatHref",t,this),i=n.get("tagName",t,e),s=this.toFormattedString(n),o={},a=n.get("className",t,e),l=n.get("target",t,e),h=n.get("rel",t,e),u=n.getObj("attributes",t,e),p=n.getObj("events",t,e);return o.href=r,a&&(o.class=a),l&&(o.target=l),h&&(o.rel=h),u&&Ht(o,u),{tagName:i,attributes:o,content:s,eventListeners:p}}};function yi(n,e){class t extends va{constructor(i,s){super(i,s),this.t=n}}for(let r in e)t.prototype[r]=e[r];return t.t=n,t}var ca=yi("email",{isLink:!0,toHref(){return"mailto:"+this.toString()}}),ua=yi("text"),yl=yi("nl"),Wr=yi("url",{isLink:!0,toHref(n=fn.defaultProtocol){return this.hasProtocol()?this.v:`${n}://${this.v}`},hasProtocol(){let n=this.tk;return n.length>=2&&n[0].t!==mn&&n[1].t===ht}});var Oe=n=>new Ee(n);function xl({groups:n}){let e=n.domain.concat([ai,ci,dt,ui,di,hi,pi,mi,Le,Is,dn,fi,gi,bi,Ve,ki,pn,vi]),t=[li,ht,_s,Ue,Ns,dn,hn,Hs,Us,Yr,Qr,cn,un,Gr,Kr,Jr,Xr,Zr,ei,ti,ni,ri,ii,si,oi],r=[ai,li,ci,ui,di,hi,pi,mi,Le,cn,un,dn,fi,gi,bi,hn,Ve,ki,pn,vi],i=Oe(),s=g(i,pn);I(s,r,s),I(s,n.domain,s);let o=Oe(),a=Oe(),l=Oe();I(i,n.domain,o),I(i,n.scheme,a),I(i,n.slashscheme,l),I(o,r,s),I(o,n.domain,o);let h=g(o,dt);g(s,dt,h),g(a,dt,h),g(l,dt,h);let u=g(s,Ue);I(u,r,s),I(u,n.domain,s);let p=Oe();I(h,n.domain,p),I(p,n.domain,p);let m=g(p,Ue);I(m,n.domain,p);let T=Oe(ca);I(m,n.tld,T),I(m,n.utld,T),g(h,mn,T);let S=g(p,Le);g(S,Le,S),I(S,n.domain,p),I(T,n.domain,p),g(T,Ue,m),g(T,Le,S);let P=g(T,ht);I(P,n.numeric,ca);let C=g(o,Le),A=g(o,Ue);g(C,Le,C),I(C,n.domain,o),I(A,r,s),I(A,n.domain,o);let $=Oe(Wr);I(A,n.tld,$),I(A,n.utld,$),I($,n.domain,o),I($,r,s),g($,Ue,A),g($,Le,C),g($,dt,h);let tt=g($,ht),Se=Oe(Wr);I(tt,n.numeric,Se);let O=Oe(Wr),we=Oe();I(O,e,O),I(O,t,we),I(we,e,O),I(we,t,we),g($,Ve,O),g(Se,Ve,O);let me=g(a,ht),nt=g(l,ht),Fe=g(nt,Ve),ce=g(Fe,Ve);I(a,n.domain,o),g(a,Ue,A),g(a,Le,C),I(l,n.domain,o),g(l,Ue,A),g(l,Le,C),I(me,n.domain,O),g(me,Ve,O),g(me,hn,O),I(ce,n.domain,O),I(ce,e,O),g(ce,Ve,O);let ve=[[cn,un],[Kr,Gr],[Jr,Xr],[Yr,Qr],[Zr,ei],[ti,ni],[ri,ii],[si,oi]];for(let Be=0;Be<ve.length;Be++){let[ge,Re]=ve[Be],ue=g(O,ge);g(we,ge,ue),g(ue,Re,O);let ke=Oe(Wr);I(ue,e,ke);let ee=Oe();I(ue,t),I(ke,e,ke),I(ke,t,ee),I(ee,e,ke),I(ee,t,ee),g(ke,Re,O),g(ee,Re,O)}return g(i,mn,$),g(i,$s,yl),{start:i,tokens:ga}}function El(n,e,t){let r=t.length,i=0,s=[],o=[];for(;i<r;){let a=n,l=null,h=null,u=0,p=null,m=-1;for(;i<r&&!(l=a.go(t[i].t));)o.push(t[i++]);for(;i<r&&(h=l||a.go(t[i].t));)l=null,a=h,a.accepts()?(m=0,p=a):m>=0&&m++,i++,u++;if(m<0)i-=u,i<r&&(o.push(t[i]),i++);else{o.length>0&&(s.push(ws(ua,e,o)),o=[]),i-=m,u-=m;let T=p.t,S=t.slice(i-u,i);s.push(ws(T,e,S))}}return o.length>0&&s.push(ws(ua,e,o)),s}function ws(n,e,t){let r=t[0].s,i=t[t.length-1].e,s=e.slice(r,i);return new n(s,t)}var pe={scanner:null,parser:null,tokenQueue:[],pluginQueue:[],customSchemes:[],initialized:!1};function Sl(){pe.scanner=kl(pe.customSchemes);for(let n=0;n<pe.tokenQueue.length;n++)pe.tokenQueue[n][1]({scanner:pe.scanner});pe.parser=xl(pe.scanner.tokens);for(let n=0;n<pe.pluginQueue.length;n++)pe.pluginQueue[n][1]({scanner:pe.scanner,parser:pe.parser});return pe.initialized=!0,pe}function Vs(n){return pe.initialized||Sl(),El(pe.parser.start,n,ba(pe.scanner.start,n))}Vs.scan=ba;function ka(n){return n.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function wl(n){return n.replace(/"/g,"&quot;")}function Rl(n){let e=[];for(let t in n){let r=n[t]+"";e.push(`${t}="${wl(r)}"`)}return e.join(" ")}function Dl({tagName:n,attributes:e,content:t}){return`<${n} ${Rl(e)}>${ka(t)}</${n}>`}function Fs(n,e={}){e=new Ti(e,Dl);let t=Vs(n),r=[];for(let i=0;i<t.length;i++){let s=t[i];s.t==="nl"&&e.get("nl2br")?r.push(`<br>
`):!s.isLink||!e.check(s)?r.push(ka(s.toString())):r.push(e.render(s))}return r.join("")}String.prototype.linkify||Object.defineProperty(String.prototype,"linkify",{writable:!1,value:function(e){return Fs(this,e)}});var gn=class extends _t{constructor(e){if(super(e),this.it=te,e.type!==Ke.CHILD)throw Error(this.constructor.directiveName+"() can only be used in child bindings")}render(e){if(e===te||e==null)return this._t=void 0,this.it=e;if(e===Me)return e;if(typeof e!="string")throw Error(this.constructor.directiveName+"() called with a non-string value");if(e===this.it)return this._t;this.it=e;let t=[e];return t.raw=t,this._t={_$litType$:this.constructor.resultType,strings:t,values:[]}}};gn.directiveName="unsafeHTML",gn.resultType=1;var Ta=Lr(gn);var Bs=class extends HTMLElement{explanMain=null;plan=new He;taskIndex=-1;planDefinitionChangedCallback;constructor(){super(),this.planDefinitionChangedCallback=()=>{this.render()}}connectedCallback(){this.render(),document.addEventListener("plan-definition-changed",this.planDefinitionChangedCallback)}disconnectedCallback(){document.removeEventListener("plan-definition-changed",this.planDefinitionChangedCallback)}updateSelectedTaskPanel(e,t){this.explanMain=e,this.plan=e.plan,this.taskIndex=t,this.render()}render(){N(this.template(),this)}humanDurationValue(e){let t=this.plan.durationUnits.durationToHuman(e.duration);return t.ok?t.value:(fe(t.error),"")}template(){let e=this.taskIndex;if(e===-1)return k`
        <button
          class="icon-button"
          @click=${async()=>await be("NewTaskAction",this.explanMain)}
          title="Add Task"
        >
          ${Y("add-icon")}
        </button>
        <div>No task selected.</div>
      `;if(this.explanMain===null)return k``;let t=Object.keys(this.plan.metricDefinitions).filter(s=>this.plan.metricDefinitions[s].hideEditor===!1).sort(),r=Object.keys(this.plan.resourceDefinitions).sort(),i=this.plan.chart.Vertices[e];return k`
      <button
        class="icon-button"
        @click=${async()=>await be("NewTaskAction",this.explanMain)}
        title="Add Task"
      >
        ${Y("add-icon")}
      </button>
      <button
        class="icon-button"
        @click=${async()=>await be("DupTaskAction",this.explanMain)}
        title="Duplicate Task"
      >
        ${Y("dup")}
      </button>
      <button
        class="icon-button"
        @click=${async()=>await be("SplitTaskAction",this.explanMain)}
        title="Split Task"
      >
        ${Y("split")}
      </button>

      <button
        class="icon-button"
        @click=${async()=>be("DeleteTaskAction",this.explanMain)}
        title="Delete Task"
      >
        ${Y("delete-icon")}
      </button>
      <table>
        <tr>
          <td class="underline-first-char">Name</td>
          <td>
            <input
              type="text"
              id="task-name"
              accesskey="n"
              .value="${oe(i.name)}"
              @change=${s=>this.dispatchEvent(new CustomEvent("task-name-change",{bubbles:!0,detail:{taskIndex:e,name:s.target.value}}))}
            />
          </td>
        </tr>
        <tr>
          <!-- 
          
          Should be a div with an edit button. Contents processed through linkify.

          Assure the linkify links open in another tab/window.

          Add an edit button to open a dialog for editing the description.
          
          -->
          <td>De<u>s</u>cription</td>
          <td class="task-description">
            <p>
              ${Ta(Fs(i.description,{target:"_blank"}))}
            </p>
            <button
              accesskey="s"
              class="icon-button"
              title="Edit description"
              @click=${()=>this.editDescription()}
            >
              ${Y("edit-icon")}
            </button>
          </td>
        </tr>
        <tr>
          <td>D<u>u</u>ration</td>
          <td class="aligned-td">
            <input
              type="text"
              spellcheck="false"
              id="human-duration"
              accesskey="u"
              .value="${oe(this.humanDurationValue(i))}"
              @change="${s=>{let o=s.target.value,a=this.plan.durationUnits.parseHumanDuration(o);if(!a.ok){fe(a.error),s.stopPropagation(),s.preventDefault();return}this.dispatchEvent(new CustomEvent("task-metric-value-change",{bubbles:!0,detail:{taskIndex:e,value:a.value,name:"Duration"}}))}}"
            />
            ${this.optionalCalculateButton(e)}
          </td>
        </tr>

        ${r.map(s=>k` <tr>
              <td>
                <label for="${s}">${s}</label>
              </td>
              <td>
                <select
                  id="${s}"
                  @change=${async o=>this.dispatchEvent(new CustomEvent("task-resource-value-change",{bubbles:!0,detail:{taskIndex:e,value:o.target.value,name:s}}))}
                >
                  ${this.plan.resourceDefinitions[s].values.map(o=>k`<option
                        name=${o}
                        .selected=${i.resources[s]===o}
                      >
                        ${o}
                      </option>`)}
                </select>
              </td>
            </tr>`)}
        ${t.map(s=>k` <tr>
              <td><label for="${s}">${s}</label></td>
              <td>
                <input
                  id="${s}"
                  .value=${oe(i.metrics[s])}
                  type="number"
                  @change=${async o=>this.dispatchEvent(new CustomEvent("task-metric-value-change",{bubbles:!0,detail:{taskIndex:e,value:+o.target.value,name:s}}))}
                />
              </td>
            </tr>`)}
      </table>
    `}optionalCalculateButton(e){if(this.plan.status.stage!=="started")return k``;let t=this.plan.getTaskCompletion(e);return t.ok?t.value.stage!=="started"?k``:k`
      <button
        class="icon-button"
        @click=${async()=>{let r=this.explanMain.getToday();r.ok&&await X(Ao(r.value,e),"planDefinitionChanged",!0,this.explanMain)}}
        title="Recalculate Duration"
      >
        ${Y("calculate")}
      </button>
    `:k``}async editDescription(){let e=this.plan.chart.Vertices[this.taskIndex],t=await document.querySelector("edit-description-dialog")?.prompt(e.description);t!=null&&await X(Oo(this.taskIndex,t),"planDefinitionChanged",!0,this.explanMain)}};customElements.define("selected-task-panel",Bs);var ya=1e3,zs=new Ie(2),Ml=n=>Math.floor(Math.random()*n),xa=(n,e,t,r)=>{let i=new Map;i.set(`${t}`,{count:0,criticalPath:t.slice(),durations:n.Vertices.map(s=>s.duration)});for(let s=0;s<e;s++){let o=n.Vertices.map((p,m)=>{if(r.has(m))return p.duration;let T=new Br(p.duration,p.getResource("Uncertainty")).sample(Ml(ya)/ya);return zs.round(T)}),a=In(n,p=>o[p],zs.rounder());if(!a.ok)throw a.error;let l=$n(a.value,zs.rounder()),h=`${l}`,u=i.get(h);u===void 0&&(u={count:0,criticalPath:l,durations:o},i.set(h,u)),u.count++}return{paths:i,tasks:Cl(i,n)}},Cl=(n,e)=>{let t=new Map;return n.forEach(r=>{r.criticalPath.forEach(i=>{let s=t.get(i);s===void 0&&(s={taskIndex:i,duration:e.Vertices[i].duration,numTimesAppeared:0},t.set(i,s)),s.numTimesAppeared+=r.count})}),[...t.values()].sort((r,i)=>i.duration-r.duration)};var js=class extends HTMLElement{results={paths:new Map,tasks:[]};chart=null;numSimulationLoops=0;originalCriticalPath=[];connectedCallback(){this.render()}simulate(e,t,r,i){return this.results=xa(e,t,r,i),this.chart=e,this.numSimulationLoops=t,this.originalCriticalPath=r,this.render(),this.results.tasks.map(s=>s.taskIndex)}clear(){this.results={paths:new Map,tasks:[]},this.dispatchEvent(new CustomEvent("simulation-select",{bubbles:!0,detail:{durations:null,criticalPath:[]}})),this.render()}pathClicked(e){this.dispatchEvent(new CustomEvent("simulation-select",{bubbles:!0,detail:{durations:this.results.paths.get(e).durations,criticalPath:this.results.paths.get(e).criticalPath}}))}render(){N(this.template(),this)}displayCriticalPathDifferences(e){let t=sn(this.originalCriticalPath,e),r=sn(e,this.originalCriticalPath);return t.length===0&&r.length===0?k`Original Critical Path`:k`
      ${r.map(i=>k`
          <span class="added">+${this.chart.Vertices[i].name}</span>
        `)}
      ${t.map(i=>k`
          <span class="removed">-${this.chart.Vertices[i].name}</span>
        `)}
    `}template(){if(this.results.paths.size===0)return k``;let t=[...this.results.paths.keys()].sort((r,i)=>this.results.paths.get(i).count-this.results.paths.get(r).count);return k`
      <button
        @click=${()=>{this.clear()}}
      >
        Clear
      </button>

      <table class="paths">
        <tr>
          <th>Count</th>
          <th>Critical Path</th>
        </tr>
        ${t.map(r=>k`<tr @click=${()=>this.pathClicked(r)}>
              <td>${this.results.paths.get(r).count}</td>
              <td>
                ${this.displayCriticalPathDifferences(this.results.paths.get(r).criticalPath)}
              </td>
            </tr>`)}
      </table>
      <table>
        <tr>
          <th>Name</th>
          <th>Duration</th>
          <th>Frequency (%)</th>
        </tr>
        ${this.results.tasks.map(r=>k`<tr>
              <td>${this.chart.Vertices[r.taskIndex].name}</td>
              <td>${r.duration}</td>
              <td>
                ${Math.floor(100*r.numTimesAppeared/this.numSimulationLoops)}
              </td>
            </tr>`)}
      </table>
    `}};customElements.define("simulation-panel",js);var Ws=class extends HTMLElement{explanMain=null;taskSearchControl=null;connectedCallback(){this.explanMain=document.querySelector("explan-main"),this.explanMain&&(this.taskSearchControl=this.querySelector("task-search-control"),this.addEventListener("task-change",e=>{this.explanMain.setSelection(e.detail.taskIndex,e.detail.focus,!0),this.classList.add("hidden")}),this.addEventListener("task-focus",()=>this.setKeyboardFocusToInput("full-info")))}setKeyboardFocusToInput(e){this.classList.remove("hidden"),this.taskSearchControl.tasks=this.explanMain.plan.chart.Vertices,this.taskSearchControl.includedIndexes=this.explanMain.plan.chart.Vertices.map((t,r)=>r).slice(1,-1),this.taskSearchControl.setKeyboardFocusToInput(e)}};customElements.define("search-task-panel",Ws);var wa=Ya(Sa(),1),Al=(n,e)=>[0,...n.map(r=>[r,r+1]).flat(),e],Pl=(n,e)=>{let t=[],r=!1;for(let i=0;i<n.length-1;i++){let s=e.slice(n[i],n[i+1]);r?t.push(k`<b>${s}</b>`):t.push(k`${s}`),r=!r}return t},Ol=(n,e)=>Pl(Al(n,e.length),e),Ll=n=>n.searchResults.map((e,t)=>k` <li
        tabindex="0"
        @click="${()=>n.selectSearchResult(t,!1)}"
        ?data-focus=${t===n.focusIndex}
        data-index=${t}
      >
        ${Ol(e.indexes,e.target)}
      </li>`),bn=n=>k`
  <input
    autocomplete="off"
    name="task_search"
    id="search_input"
    placeholder="Search"
    type="text"
    @input="${e=>n.onInput(e.target.value)}"
    @keydown="${e=>n.onKeyDown(e)}"
    @focus="${()=>n.searchInputReceivedFocus()}"
  />
  <ul>
    ${Ll(n)}
  </ul>
`,Il=(n,e,t,r)=>e==="full-info"?i=>{if(t.size!==0){let o=n.indexOf(i);if(!t.has(o))return""}let s=Object.keys(i.resources);return s.sort(),`${i.name} ${"-".repeat(r-i.name.length+2)} ${s.map(o=>i.resources[o]).join(" ")}`}:i=>{if(t.size!==0){let s=n.indexOf(i);if(!t.has(s))return""}return i.name},$l=(n,e,t)=>n.filter((r,i)=>t.has(i)).map(r=>({obj:r,indexes:[],target:e(r)})),qs=class extends HTMLElement{_tasks=[];_includedIndexes=new Set;focusIndex=0;searchResults=[];searchType="name-only";taskToSearchString=()=>"";connectedCallback(){N(bn(this),this)}onInput(e){e===""?this.searchResults=$l(this._tasks,this.taskToSearchString,this._includedIndexes):this.searchResults=wa.default.go(e,this._tasks.slice(1,-1),{key:this.taskToSearchString,limit:this._tasks.length,threshold:.2}),this.focusIndex=0,N(bn(this),this)}onKeyDown(e){if(this.searchResults.length===0)return;switch(`${e.shiftKey?"shift-":""}${e.ctrlKey?"ctrl-":""}${e.metaKey?"meta-":""}${e.altKey?"alt-":""}${e.key}`){case"ArrowDown":this.focusIndex=(this.focusIndex+1)%this.searchResults.length,e.stopPropagation(),e.preventDefault();break;case"ArrowUp":this.focusIndex=(this.focusIndex-1+this.searchResults.length)%this.searchResults.length,e.stopPropagation(),e.preventDefault();break;case"Enter":if(this.searchResults.length===0)return;this.selectSearchResult(this.focusIndex,!1),e.stopPropagation(),e.preventDefault();break;case"ctrl-Enter":if(this.searchResults.length===0)return;this.selectSearchResult(this.focusIndex,!0),e.stopPropagation(),e.preventDefault();break;default:break}N(bn(this),this)}selectSearchResult(e,t){let r=this._tasks.indexOf(this.searchResults[e].obj);this.dispatchEvent(new CustomEvent("task-change",{bubbles:!0,detail:{taskIndex:r,focus:t}})),this.searchResults=[],N(bn(this),this)}searchInputReceivedFocus(){this.dispatchEvent(new CustomEvent("task-focus",{bubbles:!0}))}setKeyboardFocusToInput(e){this.searchType=e;let t=this.querySelector("input");t.focus(),t.select(),this.onInput(t.value),N(bn(this),this)}set tasks(e){this._tasks=e,this.buildTaskToSearchString()}set includedIndexes(e){this._includedIndexes=new Set(e),this.buildTaskToSearchString()}buildTaskToSearchString(){let e=this._tasks.reduce((t,r)=>r.name.length>t?r.name.length:t,0);this.taskToSearchString=Il(this._tasks,this.searchType,this._includedIndexes,e),this.onInput("")}};customElements.define("task-search-control",qs);var z=(n,e)=>({x:n,y:e});var re=(n,e)=>{let[t,r]=e;return{x:Math.floor(n.x+t),y:Math.floor(n.y+r)}},Ut=(n,e)=>n.x===e.x&&n.y===e.y,Qe=n=>({x:n.x,y:n.y}),Ra=(n,e)=>[e.x-n.x,e.y-n.y];var Ks="divider_move",Da="resizing",_l=n=>{let e=n.getBoundingClientRect();return{top:e.top+window.scrollY,left:e.left+window.scrollX,width:e.width,height:e.height}},Ei=class{begin=null;parentRect=null;currentMoveLocation=z(0,0);lastMoveSent=z(0,0);parent;divider;internvalHandle=0;dividerType;constructor(e,t,r="column"){this.parent=e,this.divider=t,this.dividerType=r,this.divider.addEventListener("mousedown",this.mousedown.bind(this))}detach(){this.parent.removeEventListener("mousemove",this.mousemove.bind(this)),this.divider.removeEventListener("mousedown",this.mousedown.bind(this)),this.parent.removeEventListener("mouseup",this.mouseup.bind(this)),this.parent.removeEventListener("mouseleave",this.mouseleave.bind(this)),window.clearInterval(this.internvalHandle)}onTimeout(){if(!Ut(this.currentMoveLocation,this.lastMoveSent)){let e=0;this.dividerType==="column"?e=100*(this.currentMoveLocation.x-this.parentRect.left)/this.parentRect.width:e=100*(this.currentMoveLocation.y-this.parentRect.top)/this.parentRect.height,e=at(e,5,95),this.parent.dispatchEvent(new CustomEvent(Ks,{detail:{before:e,after:100-e}})),this.lastMoveSent=Qe(this.currentMoveLocation)}}mousemove(e){this.begin!==null&&(this.currentMoveLocation.x=e.pageX,this.currentMoveLocation.y=e.pageY)}mousedown(e){this.internvalHandle=window.setInterval(this.onTimeout.bind(this),16),this.parentRect=_l(this.parent),this.parent.classList.add(Da),this.parent.addEventListener("mousemove",this.mousemove.bind(this)),this.parent.addEventListener("mouseup",this.mouseup.bind(this)),this.parent.addEventListener("mouseleave",this.mouseleave.bind(this)),this.begin=z(e.pageX,e.pageY)}mouseup(e){this.begin!==null&&this.finished(z(e.pageX,e.pageY))}mouseleave(e){this.begin!==null&&this.finished(z(e.pageX,e.pageY))}finished(e){window.clearInterval(this.internvalHandle),this.parent.classList.remove(Da),this.parent.removeEventListener("mousemove",this.mousemove.bind(this)),this.parent.removeEventListener("mouseup",this.mouseup.bind(this)),this.parent.removeEventListener("mouseleave",this.mouseleave.bind(this)),this.currentMoveLocation=e,this.onTimeout(),this.begin=null,this.currentMoveLocation=z(0,0),this.lastMoveSent=z(0,0)}};var Gs="dragrange",Si=class{begin=null;currentMoveLocation=z(0,0);lastMoveSent=z(0,0);ele;internvalHandle=0;constructor(e){this.ele=e,e.addEventListener("mousemove",this.mousemove.bind(this)),e.addEventListener("mousedown",this.mousedown.bind(this)),e.addEventListener("mouseup",this.mouseup.bind(this)),e.addEventListener("mouseleave",this.mouseleave.bind(this))}detach(){this.ele.removeEventListener("mousemove",this.mousemove.bind(this)),this.ele.removeEventListener("mousedown",this.mousedown.bind(this)),this.ele.removeEventListener("mouseup",this.mouseup.bind(this)),this.ele.removeEventListener("mouseleave",this.mouseleave.bind(this)),window.clearInterval(this.internvalHandle)}onTimeout(){Ut(this.currentMoveLocation,this.lastMoveSent)||(this.ele.dispatchEvent(new CustomEvent(Gs,{detail:{begin:Qe(this.begin),end:Qe(this.currentMoveLocation)}})),this.lastMoveSent=Qe(this.currentMoveLocation))}mousemove(e){this.begin!==null&&(this.currentMoveLocation.x=e.offsetX,this.currentMoveLocation.y=e.offsetY)}mousedown(e){this.internvalHandle=window.setInterval(this.onTimeout.bind(this),16),this.begin=z(e.offsetX,e.offsetY)}mouseup(e){this.finished(z(e.offsetX,e.offsetY))}mouseleave(e){this.begin!==null&&this.finished(z(e.offsetX,e.offsetY))}finished(e){window.clearInterval(this.internvalHandle),this.currentMoveLocation=e,this.onTimeout(),this.begin=null,this.currentMoveLocation=z(0,0),this.lastMoveSent=z(0,0)}};var wi=class{currentMoveLocation=z(0,0);lastReadLocation=z(0,0);ele;constructor(e){this.ele=e,e.addEventListener("mousemove",this.mousemove.bind(this))}detach(){this.ele.removeEventListener("mousemove",this.mousemove.bind(this))}mousemove(e){this.currentMoveLocation.x=e.offsetX,this.currentMoveLocation.y=e.offsetY}readLocation(){return Ut(this.currentMoveLocation,this.lastReadLocation)?null:(this.lastReadLocation=Qe(this.currentMoveLocation),Qe(this.lastReadLocation))}};var vn=class{_begin;_end;constructor(e,t){this._begin=e,this._end=t,this._begin>this._end&&([this._end,this._begin]=[this._begin,this._end]),this._end-this._begin<7&&(this._end=this._begin+7)}in(e){return e>=this._begin&&e<=this._end}get begin(){return this._begin}get end(){return this._end}get rangeInDays(){return this._end-this._begin}};var Ma=(n,e,t,r,i,s)=>{let o=lt(n);if(!o.ok)return o;let a=o.value;if(e===null){let C=new Map;for(let A=0;A<n.Vertices.length;A++)C.set(A,A);return d({chartLike:n,displayOrder:o.value,emphasizedTasks:t,spans:r,labels:i,fromFilteredIndexToOriginalIndex:C,fromOriginalIndexToFilteredIndex:C,selectedTaskIndex:s})}let l=[],h=[],u=[],p=[],m=[],T=new Map,S=new Map;n.Vertices.forEach((C,A)=>{if(e(C,A)){l.push(C),p.push(r[A]),m.push(i[A]);let $=l.length-1;S.set(A,$),T.set($,A)}}),n.Edges.forEach(C=>{!S.has(C.i)||!S.has(C.j)||h.push(new se(S.get(C.i),S.get(C.j)))}),a.forEach(C=>{let A=n.Vertices[C];e(A,C)&&u.push(S.get(C))});let P=t.map(C=>S.get(C));return d({chartLike:{Edges:h,Vertices:l},displayOrder:u,emphasizedTasks:P,spans:p,labels:m,fromFilteredIndexToOriginalIndex:T,fromOriginalIndexToFilteredIndex:S,selectedTaskIndex:S.get(s)||-1})};var D={taskLineStart:"taskLineStart",textStart:"textStart",groupTextStart:"groupTextStart",percentStart:"percentStart",verticalArrowDestTop:"verticalArrowDestTop",verticalArrowDestBottom:"verticalArrowDestBottom",horizontalArrowDest:"horizontalArrowDest",verticalArrowStart:"verticalArrowStart",horizontalArrowStart:"horizontalArrowStart",verticalArrowDestToMilestoneTop:"verticalArrowDestToMilestoneTop",verticalArrowDestToMilestoneBottom:"verticalArrowDestToMilestoneBottom",horizontalArrowDestToMilestone:"horizontalArrowDestToMilestone",verticalArrowStartFromMilestoneTop:"verticalArrowStartFromMilestoneTop",verticalArrowStartFromMilestoneBottom:"verticalArrowStartFromMilestoneBottom",horizontalArrowStartFromMilestone:"horizontalArrowStartFromMilestone",groupEnvelopeStart:"groupEnvelopeStart",taskEnvelopeTop:"taskEnvelopeTop",displayRangeTop:"displayRangeTop",taskRowBottom:"taskRowBottom",timeMarkStart:"timeMarkStart",timeMarkEnd:"timeMarkEnd",timeTextStart:"timeTextStart",timeTextStartBefore:"timeTextStartBefore",groupTitleTextStart:"groupTitleTextStart",tasksClipRectOrigin:"tasksClipRectOrigin",groupByOrigin:"groupByOrigin"},Z={taskLineHeight:"taskLineHeight",percentHeight:"percentHeight",arrowHeadHeight:"arrowHeadHeight",arrowHeadWidth:"arrowHeadWidth",milestoneDiameter:"milestoneDiameter",lineDashLine:"lineDashLine",lineDashGap:"lineDashGap",textXOffset:"textXOffset",minTaskWidthPx:"minTaskWidthPx",rowHeight:"rowHeight"},Nl=n=>n%2===0?n+1:n,kn=class{dayWidthPx;rowHeightPx;blockSizePx;taskHeightPx;lineWidthPx;marginSizePx;timelineHeightPx;origin;totalNumberOfDays;groupByColumnWidthPx;timelineOrigin;tasksOrigin;groupByOrigin;tasksClipRectOrigin;constructor(e,t,r,i=0){this.totalNumberOfDays=r,this.groupByColumnWidthPx=i*e.fontSizePx,this.blockSizePx=Math.floor(e.fontSizePx/3),this.taskHeightPx=this.blockSizePx,this.lineWidthPx=Nl(Math.floor(this.taskHeightPx/3));let s=Math.ceil(this.taskHeightPx/2)+this.lineWidthPx;this.marginSizePx=2*s,this.timelineHeightPx=e.hasTimeline?Math.ceil(e.fontSizePx*4/3):0,this.timelineOrigin=z(s,0),this.groupByOrigin=z(0,s+this.timelineHeightPx);let o=0;e.displayRange===null||e.displayRangeUsage==="highlight"?(this.dayWidthPx=(t-this.groupByColumnWidthPx-2*this.marginSizePx)/r,this.origin=z(0,0)):(this.dayWidthPx=(t-this.groupByColumnWidthPx-2*this.marginSizePx)/e.displayRange.rangeInDays,o=Math.floor(this.dayWidthPx*e.displayRange.begin+this.marginSizePx),this.origin=z(-o+this.marginSizePx,0)),this.tasksOrigin=z(this.groupByColumnWidthPx-o+s,this.timelineHeightPx+s),this.tasksClipRectOrigin=z(this.groupByColumnWidthPx,this.timelineHeightPx),e.hasText?this.rowHeightPx=6*this.blockSizePx:this.rowHeightPx=1.1*this.blockSizePx}height(e){return e*this.rowHeightPx+this.timelineHeightPx+2*this.marginSizePx}dayRowFromPoint(e){return{day:at(Math.floor((window.devicePixelRatio*e.x-this.origin.x-this.marginSizePx-this.groupByColumnWidthPx)/this.dayWidthPx),0,this.totalNumberOfDays),row:Math.floor((window.devicePixelRatio*e.y-this.origin.y-this.marginSizePx-this.timelineHeightPx)/this.rowHeightPx)}}taskRowEnvelopeStart(e,t){return re(this.origin,[Math.floor(t*this.dayWidthPx+this.marginSizePx+this.groupByColumnWidthPx),Math.floor(e*this.rowHeightPx+this.marginSizePx+this.timelineHeightPx)])}groupRowEnvelopeStart(e,t){return re(this.groupByOrigin,[0,e*this.rowHeightPx+this.marginSizePx+this.timelineHeightPx])}groupHeaderStart(){return re(this.origin,[this.marginSizePx,this.marginSizePx])}timeEnvelopeStart(e){return re(this.origin,[e*this.dayWidthPx+this.marginSizePx+this.groupByColumnWidthPx,0])}feature(e,t,r){switch(r){case D.taskLineStart:case D.verticalArrowDestTop:case D.verticalArrowStart:return re(this.taskRowEnvelopeStart(e,t),[0,this.rowHeightPx-this.blockSizePx]);case D.verticalArrowDestBottom:return re(this.taskRowEnvelopeStart(e,t),[0,this.rowHeightPx]);case D.textStart:return re(this.taskRowEnvelopeStart(e,t),[this.blockSizePx,this.blockSizePx]);case D.groupTextStart:return re(this.groupRowEnvelopeStart(e,t),[this.blockSizePx,this.blockSizePx]);case D.percentStart:return re(this.taskRowEnvelopeStart(e,t),[0,this.rowHeightPx-this.lineWidthPx]);case D.horizontalArrowDest:case D.horizontalArrowStart:return re(this.taskRowEnvelopeStart(e,t),[0,Math.floor(this.rowHeightPx-.5*this.blockSizePx)-1]);case D.verticalArrowDestToMilestoneTop:return re(this.feature(e,t,D.verticalArrowDestTop),[0,-1*this.metric(Z.milestoneDiameter)]);case D.verticalArrowDestToMilestoneBottom:return re(this.feature(e,t,D.verticalArrowDestTop),[0,this.metric(Z.milestoneDiameter)]);case D.horizontalArrowDestToMilestone:return re(this.feature(e,t,D.horizontalArrowDest),[-1*this.metric(Z.milestoneDiameter),-.5*this.metric(Z.milestoneDiameter)]);case D.verticalArrowStartFromMilestoneTop:return re(this.feature(e,t,D.verticalArrowStart),[0,-1*this.metric(Z.milestoneDiameter)]);case D.verticalArrowStartFromMilestoneBottom:return re(this.feature(e,t,D.verticalArrowStart),[0,this.metric(Z.milestoneDiameter)]);case D.horizontalArrowStartFromMilestone:return re(this.feature(e,t,D.horizontalArrowStart),[this.metric(Z.milestoneDiameter),0]);case D.taskEnvelopeTop:return this.taskRowEnvelopeStart(e,t);case D.groupEnvelopeStart:return this.groupRowEnvelopeStart(e,t);case D.timeMarkStart:return this.timeEnvelopeStart(t);case D.timeMarkEnd:return re(this.timeEnvelopeStart(t),[0,this.rowHeightPx*(e+1)]);case D.timeTextStart:return re(this.timeEnvelopeStart(t),[this.blockSizePx,0]);case D.timeTextStartBefore:return re(this.timeEnvelopeStart(t),[-this.blockSizePx,0]);case D.groupTitleTextStart:return re(this.groupHeaderStart(),[this.blockSizePx,0]);case D.displayRangeTop:return this.timeEnvelopeStart(t);case D.taskRowBottom:return this.taskRowEnvelopeStart(e+1,t);case D.tasksClipRectOrigin:return this.tasksClipRectOrigin;case D.groupByOrigin:return this.groupByOrigin;default:return z(0,0)}}metric(e){switch(e){case Z.taskLineHeight:return this.taskHeightPx;case Z.percentHeight:return this.lineWidthPx;case Z.arrowHeadHeight:return this.taskHeightPx*2;case Z.arrowHeadWidth:return Math.ceil(this.taskHeightPx);case Z.milestoneDiameter:return Math.ceil(this.taskHeightPx);case Z.lineDashLine:return this.blockSizePx;case Z.lineDashGap:return this.blockSizePx;case Z.textXOffset:return this.blockSizePx;case Z.minTaskWidthPx:return this.blockSizePx*10;case Z.rowHeight:return this.rowHeightPx;default:return 0}}};var Hl=(n,e)=>e.topLeft.y<=n&&e.bottomRight.y>=n,Ul=(n,e)=>e.topLeft.x<=n&&e.bottomRight.x>=n,Ri=class{rects;constructor(e){this.rects=e.sort((t,r)=>t.topLeft.y-r.topLeft.y)}hit(e){let t=0,r=this.rects.length-1;for(;t<=r;){let i=Math.floor((t+r)/2);if(Hl(e.y,this.rects[i]))return Ul(e.x,this.rects[i])?this.rects[i]:null;this.rects[i].topLeft.y<e.y?t=i+1:r=i-1}return null}};var Ia=(n,e)=>n.duration===0?e==="down"?D.verticalArrowStartFromMilestoneBottom:D.verticalArrowStartFromMilestoneTop:D.verticalArrowStart,$a=(n,e)=>n.duration===0?e==="down"?D.verticalArrowDestToMilestoneTop:D.verticalArrowDestToMilestoneBottom:e==="down"?D.verticalArrowDestTop:D.verticalArrowDestBottom;var Ca=n=>n.duration===0?D.horizontalArrowDestToMilestone:D.horizontalArrowDest;function Js(n,e,t,r){return t.hasTasks||(r=0),new kn(t,n.width,e[e.length-1].finish+1).height(r)}function Xs(n,e,t,r,i,s,o=null){let a=lt(r.chart);if(!a.ok)return a;let l=r.chart.Vertices.map((E,x)=>s.taskLabel(x)),h=Ma(r.chart,s.filterFunc,s.taskEmphasize,i,l,s.selectedTaskIndex);if(!h.ok)return h;let u=h.value.chartLike,p=h.value.labels,m=r.getResourceDefinition(s.groupByResource),T=h.value.fromFilteredIndexToOriginalIndex,S=h.value.fromOriginalIndexToFilteredIndex,P=E=>{let x=T.get(E);if(x===void 0)return 0;let b=r.getTaskCompletion(x);if(!b.ok)return 0;let w=b.value;switch(w.stage){case"unstarted":return 0;case"started":return w.percentComplete;case"finished":return 100;default:return 0}},C=s.selectedTaskIndex,A=new Set(h.value.emphasizedTasks);i=h.value.spans;let $=0;s.groupByResource!==""&&s.hasText&&($=s.groupByResource.length,m!==void 0&&m.values.forEach(E=>{$=Math.max($,E.length)}));let tt=i.length,Se=i[i.length-1].finish,O=new kn(s,e.width,Se+1,$),we=O.metric(Z.taskLineHeight),me=O.metric(Z.milestoneDiameter),nt=O.metric(Z.percentHeight),Fe=O.metric(Z.arrowHeadHeight),ce=O.metric(Z.arrowHeadWidth),ve=O.metric(Z.minTaskWidthPx),Be=new Set,ge=Yl(s,m,u,h.value.displayOrder);if(!ge.ok)return ge;let Re=ge.value.taskIndexToRow,ue=ge.value.rowRanges;Fl(t,s,e),Bl(t,s);let ke=new Path2D,ee=O.feature(0,0,D.tasksClipRectOrigin),pt=e.width-ee.x;ke.rect(ee.x,0,pt,e.height),t.fillStyle=s.colors.get("on-surface"),t.strokeStyle=s.colors.get("on-surface"),ue!==null&&(s.hasTasks&&Ql(t,O,ue,Se,s.colors.get("group-color")),m!==void 0&&s.hasText&&Zl(t,s,m,O,ue)),t.fillStyle=s.colors.get("on-surface"),t.strokeStyle=s.colors.get("on-surface"),t.save(),t.clip(ke);let Q=new Map,rt=[],Bt=O.feature(0,Se,D.timeTextStartBefore),Dt=s.durationDisplay(Se),f=t.measureText(Dt);if(Bt.x=Bt.x-f.width,rt.push([Bt.x,ee.x+pt]),u.Vertices.forEach((E,x)=>{let b=Re.get(x),w=i[x],R=O.feature(b,w.start,D.taskLineStart),_=O.feature(b,w.finish,D.taskLineStart),L=P(x);t.fillStyle=s.colors.get("on-surface-muted"),t.strokeStyle=s.colors.get("on-surface-muted"),s.drawTimeMarkersOnTasks&&Xl(t,b,w.start,E,s,O,Be,rt,Se),t.lineWidth=1,A.has(x)?r._status.stage==="started"?L===100?(t.fillStyle=s.colors.get("secondary-variant"),t.strokeStyle=s.colors.get("secondary-variant")):L>0?(t.fillStyle=Vt(t,s.colors.get("secondary"),s.colors.get("surface")),t.strokeStyle=s.colors.get("secondary")):(t.fillStyle=Vt(t,s.colors.get("primary"),s.colors.get("surface")),t.strokeStyle=s.colors.get("primary")):(t.fillStyle=Vt(t,s.colors.get("primary"),s.colors.get("surface")),t.strokeStyle=s.colors.get("primary")):r._status.stage==="started"?L===100?(t.fillStyle=s.colors.get("secondary-variant"),t.strokeStyle=s.colors.get("secondary-variant")):L>0?(t.fillStyle=Vt(t,s.colors.get("secondary"),s.colors.get("surface")),t.strokeStyle=s.colors.get("secondary")):t.fillStyle=Vt(t,s.colors.get("on-surface"),s.colors.get("surface")):(t.fillStyle=Vt(t,s.colors.get("on-surface"),s.colors.get("surface")),t.strokeStyle=s.colors.get("on-surface"));let q=O.feature(b,w.start,D.taskEnvelopeTop),K=O.feature(b+1,w.finish,D.taskEnvelopeTop),[F,de]=Ra(q,K);F<ve&&(K.x=q.x+ve),Q.set(x,{topLeft:q,bottomRight:K,filteredTaskIndex:x}),s.hasTasks&&(R.x===_.x?Gl(t,R,me,nt):ql(t,s,R,_,we,L,r._status.stage==="started"),x!==0&&x!==tt-1&&Wl(t,s,O,b,w,E,x,T.get(x),pt,p))}),t.lineWidth=1,t.strokeStyle=s.colors.get("on-surface-muted"),s.hasEdges&&s.hasTasks){let E=[],x=[];u.Edges.forEach(b=>{let w=T.get(b.j);w!==void 0&&s.taskIsStarted(w)||(A.has(b.i)&&A.has(b.j)?E.push(b):x.push(b))}),t.strokeStyle=s.colors.get("on-surface-muted"),Aa(t,s,x,i,u.Vertices,O,Re,ce,Fe,A),t.strokeStyle=s.colors.get("primary"),Aa(t,s,E,i,u.Vertices,O,Re,ce,Fe,A)}t.restore(),s.displayRange!==null&&s.displayRangeUsage==="highlight"&&(s.displayRange.begin>0&&Pa(t,s,O,0,s.displayRange.begin,tt),s.displayRange.end<Se&&Pa(t,s,O,s.displayRange.end,Se+1,tt)),s.today!==-1&&Jl(t,s.today,s.colors,tt,O);let c=null,y=null;if(o!==null){let E=o.getContext("2d"),x=new Ri([...Q.values()]),b=-1;c=(R,_)=>{R.x=R.x*window.devicePixelRatio,R.y=R.y*window.devicePixelRatio;let L=x.hit(R),q=L===null?-1:T.get(L.filteredTaskIndex);if(q===0||q===r.chart.Vertices.length-1)return null;if(_==="mousemove"){if(q===b)return q}else if(q===C)return q;_==="mousemove"?b=q:C=q,E.clearRect(0,0,o.width,o.height);let K=Q.get(S.get(b));return K!==void 0&&Kl(E,K.topLeft,K.bottomRight,s.colors.get("primary-variant"),we),K=Q.get(S.get(C)),K!==void 0&&Oa(E,K.topLeft,K.bottomRight,s.colors.get("primary-variant")),q};let w=Q.get(S.get(C));w!==void 0&&Oa(E,w.topLeft,w.bottomRight,s.colors.get("primary-variant"))}Q.forEach(E=>{if(y===null){y=E.topLeft;return}E.topLeft.y<y.y&&(y=E.topLeft)}),s.selectedTaskIndex!==-1&&S.has(s.selectedTaskIndex)&&(y=Q.get(S.get(s.selectedTaskIndex)).topLeft);let M=null;return y!==null&&(M=z(y.x/window.devicePixelRatio,y.y/window.devicePixelRatio)),d({scale:O,updateHighlightFromMousePos:c,selectedTaskLocation:M})}function Aa(n,e,t,r,i,s,o,a,l,h){t.forEach(u=>{let p=r[u.i],m=r[u.j],T=i[u.i],S=i[u.j],P=o.get(u.i),C=o.get(u.j),A=p.finish,$=m.start;h.has(u.i)&&h.has(u.j)?(n.strokeStyle=e.colors.get("primary"),n.fillStyle=e.colors.get("primary")):(n.strokeStyle=e.colors.get("on-surface-muted"),n.fillStyle=e.colors.get("on-surface-muted")),Vl(n,A,$,s,P,T,C,S,a,l)})}function Pa(n,e,t,r,i,s){let o=t.feature(0,r,D.displayRangeTop),a=t.feature(s,i,D.taskRowBottom);n.fillStyle=e.colors.get("transparent-overlay"),n.fillRect(o.x,o.y,a.x-o.x,a.y-o.y)}function Vl(n,e,t,r,i,s,o,a,l,h){e===t?jl(n,r,i,e,s,o,t,a,l,h):zl(n,r,i,e,s,o,a,t,h,l)}function Fl(n,e,t){n.fillStyle=e.colors.get("background"),n.strokeStyle=e.colors.get("on-background"),n.fillRect(0,0,t.width,t.height)}function Bl(n,e){n.font=`${e.fontSizePx}px serif`}function zl(n,e,t,r,i,s,o,a,l,h){n.beginPath();let u=t<s?"down":"up",p=e.feature(t,r,Ia(i,u)),m=e.feature(s,r,Ca(o));n.moveTo(p.x+.5,p.y),n.lineTo(p.x+.5,m.y);let T=m,S=e.feature(s,a,Ca(o));n.moveTo(p.x+.5,T.y),n.lineTo(S.x+.5,S.y),n.stroke(),n.beginPath(),n.moveTo(S.x+.5,S.y),n.lineTo(S.x-l+.5,S.y+h),n.lineTo(S.x-l+.5,S.y-h),n.fill()}function jl(n,e,t,r,i,s,o,a,l,h){let u=t<s?"down":"up",p=e.feature(t,r,Ia(i,u)),m=e.feature(s,o,$a(a,u));n.beginPath(),n.moveTo(p.x+.5,p.y),n.lineTo(m.x+.5,m.y),n.stroke(),n.beginPath();let T=u==="down"?-h:h;n.moveTo(m.x+.5,m.y),n.lineTo(m.x-l+.5,m.y+T),n.lineTo(m.x+l+.5,m.y+T),n.fill()}function Wl(n,e,t,r,i,s,o,a,l,h){if(!e.hasText)return;let u=h[o],p=i.start,m=0;e.displayRange!==null&&e.displayRangeUsage==="restrict"&&(e.displayRange.in(i.start)?(p=i.start,m=0):e.displayRange.in(i.finish)?(p=i.finish,m=-n.measureText(u).width-2*t.metric(Z.textXOffset)):i.start<e.displayRange.begin&&i.finish>e.displayRange.end&&(p=e.displayRange.begin,m=l/2)),n.lineWidth=1,n.fillStyle=e.colors.get("on-surface"),n.textBaseline="top";let T=t.feature(r,p,D.textStart);n.fillText(u,T.x+m,T.y)}function ql(n,e,t,r,i,s,o){n.fillRect(t.x,t.y,r.x-t.x,i),n.strokeRect(t.x,t.y,r.x-t.x,i),o&&s!==100&&(n.fillStyle=e.colors.get("secondary"),n.strokeStyle=e.colors.get("secondary"),n.fillRect(t.x,t.y,(r.x-t.x)*s/100,i))}function Kl(n,e,t,r,i){n.strokeStyle=r,n.lineWidth=i,n.strokeRect(e.x,e.y,t.x-e.x,t.y-e.y)}function Oa(n,e,t,r){n.fillStyle=r,n.fillRect(e.x,e.y,t.x-e.x,t.y-e.y)}function Gl(n,e,t,r){n.beginPath(),n.lineWidth=r/2,n.moveTo(e.x,e.y-t),n.lineTo(e.x+t,e.y),n.lineTo(e.x,e.y+t),n.lineTo(e.x-t,e.y),n.closePath(),n.stroke()}var Jl=(n,e,t,r,i)=>{let s=i.feature(0,e,D.timeMarkStart),o=i.feature(r+1,e,D.taskEnvelopeTop);n.beginPath(),n.lineWidth=i.metric("percentHeight"),n.strokeStyle=t.get("error"),n.setLineDash([n.lineWidth*2,n.lineWidth*2]),n.moveTo(s.x,s.y),n.lineTo(o.x,o.y),n.stroke()},Xl=(n,e,t,r,i,s,o,a,l)=>{if(o.has(t))return;o.add(t);let h=s.feature(e,t,D.timeMarkStart);if(t!==l&&a.findIndex(([A,$])=>h.x>=A&&h.x<=$)!==-1)return;let u=s.feature(e,t,$a(r,"down"));n.lineWidth=.5,n.strokeStyle=i.colors.get("on-surface-muted"),n.moveTo(h.x+.5,h.y),n.lineTo(h.x+.5,u.y),n.stroke(),n.setLineDash([]),n.fillStyle=i.colors.get("on-surface"),n.textBaseline="top";let p=i.durationDisplay(t),m=n.measureText(p),T=s.feature(e,t,D.timeTextStart),S=T.x;t===l?(T=s.feature(e,t,D.timeTextStartBefore),T.x=T.x-m.width):S+=m.width;let P=T.x,C=T.x+m.width;i.hasText&&i.hasTimeline&&(t===l||a.findIndex(([A,$])=>P<=A&&C>=A||P<=$&&C>=$)===-1)&&(n.fillText(`${p}`,T.x,T.y),a.push([P,S]))},Yl=(n,e,t,r)=>{let i=new Map(r.map((m,T)=>[m,T]));if(e===void 0)return d({taskIndexToRow:i,rowRanges:null,resourceDefinition:null});let s=0,o=t.Vertices.length-1,a=[s,o],l=new Map;r.forEach(m=>{let T=t.Vertices[m].getResource(n.groupByResource)||"",S=l.get(T)||[];S.push(m),l.set(T,S)});let h=new Map;h.set(0,0);let u=1,p=new Map;return e.values.forEach((m,T)=>{let S=u;(l.get(m)||[]).forEach(P=>{a.includes(P)||(h.set(P,u),u++)}),p.set(T,{start:S,finish:u})}),h.set(o,u),d({taskIndexToRow:h,rowRanges:p,resourceDefinition:e})},Ql=(n,e,t,r,i)=>{n.fillStyle=i;let s=0;t.forEach(o=>{let a=e.feature(o.start,0,D.groupEnvelopeStart),l=e.feature(o.finish,r+1,D.taskEnvelopeTop);s++,s%2!=1&&n.fillRect(a.x,a.y,l.x-a.x,l.y-a.y)})},Zl=(n,e,t,r,i)=>{i&&(n.lineWidth=1),n.fillStyle=e.colors.get("on-surface");let s=r.feature(0,0,D.groupByOrigin);e.hasTimeline&&(n.textBaseline="bottom",n.fillText(e.groupByResource,s.x,s.y)),e.hasTasks&&(n.textBaseline="top",i.forEach((o,a)=>{if(o.start===o.finish)return;let l=r.feature(o.start,0,D.groupTextStart);n.fillText(t.values[a],l.x,l.y)}))},La=new Map,Vt=(n,e,t)=>{let r=`${e}:${t}`,i=La.get(r);if(i!==void 0)return i;let s=document.createElement("canvas");s.width=4,s.height=4;let o=s.getContext("2d");return o.fillStyle=t,o.fillRect(0,0,s.width,s.height),o.strokeStyle=e,o.lineWidth=1,o.moveTo(0,4),o.lineTo(4,0),o.stroke(),i=n.createPattern(s,"repeat"),La.set(r,i),i};var ec=["primary","on-primary","primary-variant","on-primary-variant","secondary","secondary-variant","on-secondary","background","on-background","surface","on-surface","on-surface-muted","surface-1dp","surface-2dp","disabled","on-disabled","error","on-error","transparent-overlay","group-color"],Tn=class{values=new Map;_fontSize=14;loadFromElement(e){let t=getComputedStyle(e);ec.forEach(r=>{this.values.set(r,t.getPropertyValue(`--${r}`))}),this._fontSize=+t.getPropertyValue("font-size").split("px")[0]*window.devicePixelRatio*1.8,this._fontSize===0&&(this._fontSize=24)}fontSize(){return this._fontSize}get(e){return this.values.get(e)||""}};var Rt=["Fred","Barney","Wilma","Betty"],_a=["low","moderate","high"],tc=50,Ze=n=>Math.floor(Math.random()*n),Ys=()=>Ze(tc),Qs=()=>_a[Ze(_a.length)],Ha=()=>{let n=new He,e=Ii([Kn(0),Ne("Uncertainty","low",1)],n);return H(e),n},Ua=()=>{let n=new He,e=[Hr("Person")];Rt.forEach(i=>{e.push(Ur("Person",i))}),e.push(Vr("Person","")),e.push(Pn("Cost ($/hr)",new $e(15,new le(0))),wo(0),Pt("Duration",Ys(),1),It(1,Zs()),Ne("Person",Rt[Ze(Rt.length)],1),Ne("Uncertainty",Qs(),1));let t=1;for(let i=0;i<20;i++){let s=Ze(t)+1;e.push(jn(s),Pt("Duration",Ys(),s+1),It(s+1,Zs()),Ne("Person",Rt[Ze(Rt.length)],s+1),Ne("Uncertainty",Qs(),s+1)),t++,s=Ze(t)+1,e.push(Wn(s),Pt("Duration",Ys(),s+1),It(s+1,Zs()),Ne("Person",Rt[Ze(Rt.length)],s+1),Ne("Uncertainty",Qs(),s+1)),t++}let r=Ii(e,n);return H(r),n},eo=["lorem","ipsum","dolor","sit","amet","consectetur","adipiscing","elit","sed","do","eiusmod","tempor","incididunt","ut","labore","et","dolore","magna","aliqua","ut","enim","ad","minim","veniam","quis","nostrud","exercitation","ullamco","laboris","nisi","ut","aliquip","ex","ea","commodo","consequat","euis","aute","irure","dolor","in","reprehenderit","in","voluptate","velit","esse","cillum","dolore","eu","fugiat","nulla","pariatur","excepteur","sint","occaecat","cupidatat","non","proident","sunt","in","culpa","qui","officia","deserunt","mollit","anim","id","est","laborum"],Na=eo.length,Zs=()=>`${eo[Ze(Na)]} ${eo[Ze(Na)]}`;var yn=new Uint8Array([137,80,78,71,13,10,26,10]),et=class n{static textDecoder=new TextDecoder;static textEncoder=new TextEncoder;static isPNG(e){let t=new Uint8Array(e.slice(0,8));return t.byteLength<8?!1:t.every((r,i)=>r===yn[i])}static splitChunks(e){let t=new DataView(e instanceof ArrayBuffer?e:e.buffer),r=yn.length,i=[];for(;r<t.byteLength&&!(r+8>t.byteLength);){let s=t.getUint32(r);r+=4;let o=n.textDecoder.decode(new Uint8Array(e.slice(r,r+4)));if(r+=4,r+s+4>t.byteLength)break;let a=new Uint8Array(e.slice(r,r+s));r+=s;let l=t.getUint32(r);r+=4,i.push({size:s,type:o,data:a,crc:l})}return i}static joinChunks(e){let t=yn.length+e.reduce((a,l)=>a+12+l.size,0),r=new ArrayBuffer(t),i=new DataView(r),s=new Uint8Array(r);s.set(yn,0);let o=yn.length;for(let a of e)i.setUint32(o,a.size),o+=4,s.set(n.textEncoder.encode(a.type),o),o+=4,s.set(a.data,o),o+=a.size,i.setUint32(o,a.crc),o+=4;return r}static createChunk(e,t){let r=n.textEncoder.encode(e),i=n.crc32(new Uint8Array([...r,...t]));return{size:t.length,type:e,data:t,crc:i}}static crc32(e){let t=-1;for(let r=0;r<e.length;r++)t=t>>>8^n.crcTable[(t^e[r])&255];return(t^-1)>>>0}static crcTable=(()=>{let e=new Array(256);for(let t=0;t<256;t++){let r=t;for(let i=0;i<8;i++)r=r&1?3988292384^r>>>1:r>>>1;e[t]=r}return e})()};var Ft=[97,112,112,108,105,99,97,116,105,111,110,47,118,110,100,46,101,120,112,108,97,110,46,111,114,103,43,106,115,111,110,0],Va=async(n,e)=>{let t=new Uint8Array(await e.arrayBuffer()),r=et.splitChunks(t),i=new TextEncoder().encode(nc(n)),s=new Uint8Array(new ArrayBuffer(Ft.length+i.length));s.set(Ft,0),s.set(i,Ft.length);let o=et.createChunk("tEXt",s);return r.splice(-1,0,o),new Blob([et.joinChunks(r)])},Fa=async n=>{let t=et.splitChunks(n).filter(i=>i.type==="tEXt").filter(i=>i.data.slice(0,Ft.length).every((s,o)=>s===Ft[o]));if(t.length===0)return v(new Error("No tEXt chunks found."));let r=t[0].data.slice(Ft.length);return d(rc(new TextDecoder().decode(r)))},nc=n=>btoa(encodeURIComponent(n).replace(/%([0-9A-F]{2})/g,(e,t)=>String.fromCharCode(parseInt(t,16)))),rc=n=>decodeURIComponent(Array.prototype.map.call(atob(n),function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)}).join(""));var ic=32,sc=100,Ba=1e3,to=class extends HTMLElement{plan=new He;spans=[];criticalPath=[];displayRange=null;radarScale=null;groupBySelection="";selectedTask=-1;topTimeline=!1;criticalPathsOnly=!1;focusOnTask=!1;mouseMove=null;dependenciesPanel=null;downloadLink=null;selectedTaskPanel=null;taskCompletionPanel=null;alternateTaskDurations=null;simulationPanel=null;_imageExportWidthPx=Ba;_imageExportBackgroundTransparent=!1;updateHighlightFromMousePos=null;connectedCallback(){this.simulationPanel=this.querySelector("simulation-panel"),this.simulationPanel.addEventListener("simulation-select",o=>{this.alternateTaskDurations=o.detail.durations,this.criticalPath=o.detail.criticalPath,this.recalculateSpansAndCriticalPath(),this.paintChart()}),this.downloadLink=this.querySelector("#download-link"),this.querySelector("#download-button").addEventListener("click",async()=>await this.prepareDownload()),this.querySelector("#download-json").addEventListener("click",async()=>await this.prepareJSONDownload()),this.querySelector("#catchup").addEventListener("click",async()=>await this.catchUp()),this.dependenciesPanel=this.querySelector("dependencies-panel"),this.dependenciesPanel.addEventListener("add-dependency",async o=>{let a="AddPredecessorAction";o.detail.depType==="succ"&&(a="AddSuccessorAction");let l=await be(a,this);H(l)}),this.dependenciesPanel.addEventListener("delete-dependency",async o=>{let[a,l]=[o.detail.taskIndex,this.selectedTask];o.detail.depType==="succ"&&([a,l]=[l,a]);let h=Mo(a,l),u=await X(h,"planDefinitionChanged",!0,this);H(u)}),this.selectedTaskPanel=this.querySelector("selected-task-panel"),this.selectedTaskPanel.addEventListener("task-name-change",async o=>{let a=It(o.detail.taskIndex,o.detail.name);H(await X(a,"planDefinitionChanged",!0,this))}),this.selectedTaskPanel.addEventListener("task-resource-value-change",async o=>{let{name:a,value:l,taskIndex:h}=o.detail,u=Ne(a,l,h);H(await X(u,"planDefinitionChanged",!0,this))}),this.selectedTaskPanel.addEventListener("task-metric-value-change",async o=>{let{name:a,value:l,taskIndex:h}=o.detail,u=Pt(a,l,h);H(await X(u,"planDefinitionChanged",!0,this))}),this.taskCompletionPanel=this.querySelector("task-completion-panel");let e=this.querySelector("#radar");new Si(e),e.addEventListener(Gs,this.dragRangeHandler.bind(this));let t=this.querySelector("vertical-divider");new Ei(document.body,t,"column"),document.body.addEventListener(Ks,o=>{this.style.setProperty("grid-template-columns",`calc(${o.detail.before}% - 15px) 10px auto`),this.paintChart()}),this.querySelector("#dark-mode-toggle").addEventListener("click",()=>{be("ToggleDarkModeAction",this)}),$o(),this.querySelector("#radar-toggle").addEventListener("input",o=>{this.setRadar(o.target.checked)}),this.querySelector("#critical-paths-toggle").addEventListener("input",o=>{this.criticalPathsOnly=o.target.checked,this.paintChart()});let r=this.querySelector("#overlay");this.mouseMove=new wi(r),window.requestAnimationFrame(this.onMouseMove.bind(this)),r.addEventListener("mousedown",o=>{let a=z(o.offsetX,o.offsetY);this.updateHighlightFromMousePos!==null&&this.setSelection(this.updateHighlightFromMousePos(a,"mousedown")||-1,!1)}),r.addEventListener("dblclick",o=>{let a=z(o.offsetX,o.offsetY);if(this.updateHighlightFromMousePos!==null){let l=this.updateHighlightFromMousePos(a,"mousedown")||-1;l===-1&&be("ResetZoomAction",this),this.setSelection(l,!0,!0)}});let i=document.querySelector("#file-upload");i.addEventListener("change",async()=>{let a=await i.files[0].arrayBuffer(),l=await this.fromUint8Array(new Uint8Array(a));H(l)}),this.querySelector("#simulate").addEventListener("click",()=>{this.recalculateSpansAndCriticalPath();let o=new Set;this.plan.chart.Vertices.filter((a,l)=>{this.plan.taskCompletion[a.id]?.stage==="finished"&&o.add(l)}),this.criticalPath=this.simulationPanel.simulate(this.plan.chart,sc,this.criticalPath,o),this.paintChart()}),this.querySelector("edit-resources-panel").setConfig(this),this.querySelector("plan-config-panel").setConfig(this),this.querySelector("edit-metrics-panel").setConfig(this),this.querySelector("image-export-panel").setConfig(this);let s=this.querySelector("groupby-control");s.setConfig(this),s.addEventListener("group-by-resource-changed",o=>{this.groupBySelection=o.detail,this.planDefinitionHasBeenChanged()}),this.plan=Ha(),this.updateTaskPanels(this.selectedTask),this.planDefinitionHasBeenChanged(),window.addEventListener("resize",()=>this.paintChart()),Bo(this),console.log("Finished Init"),document.dispatchEvent(new CustomEvent("finished-init"))}get imageExportWidthPx(){let e=window.localStorage.getItem("imageExportWidthPx")||"";return e===""?Ba:+e}set imageExportWidthPx(e){window.localStorage.setItem("imageExportWidthPx",e.toString())}get imageExportBackgroundTransparent(){return(window.localStorage.getItem("imageExportBackgroundTransparent")||"")==="true"}set imageExportBackgroundTransparent(e){window.localStorage.setItem("imageExportBackgroundTransparent",e.toString())}toggleTopTimeline(){this.topTimeline=!this.topTimeline,this.paintChart()}async prepareDownload(){let e=await this.toPNG();if(!e.ok){H(e);return}let t=e.value;this.downloadLink.href=URL.createObjectURL(t),this.downloadLink.download="plan.png",this.downloadLink.click()}async catchUp(){let e=this.getToday();if(!e.ok){H(e);return}let t=await X(Co(e.value,this.spans),"planDefinitionChanged",!0,this);H(t)}async prepareJSONDownload(){let e=new Blob([JSON.stringify(this.plan,null,"  ")],{type:"application/json"});this.downloadLink.href=URL.createObjectURL(e),this.downloadLink.download="plan.json",this.downloadLink.click()}async undo(){let e=await be("UndoAction",this);H(e)}async redo(){let e=await be("RedoAction",this);H(e)}embedded(){zo(),document.querySelector("#download-controls").classList.add("hidden"),document.querySelector("#upload").classList.add("hidden"),Vo("DocumentEvent")}toJSON(){return JSON.stringify(this.plan,null,"  ")}fromJSON(e){let t=He.FromJSONText(e);return t.ok?(this.plan=t.value,this.planDefinitionHasBeenChanged(),d(null)):t}async fromUint8Array(e){let t="";if(et.isPNG(e)){let i=await Fa(new Uint8Array(e));if(!i.ok)return i;t=i.value}else t=new TextDecoder("utf-8").decode(e);let r=this.fromJSON(t);return r.ok?d(null):r}async toUnit8Array(e){if(e==="image/png"){let t=await this.toPNG();return t.ok?d(new Uint8Array(await t.value.arrayBuffer())):t}return d(new TextEncoder().encode(this.toJSON()))}async toPNG(){let e=await this.renderChartToPNG();return e.ok?d(await Va(this.toJSON(),e.value)):e}async renderChartToPNG(){let e=document.createElement("canvas");e.width=this.imageExportWidthPx;let t=new Tn;t.loadFromElement(document.body),this.imageExportBackgroundTransparent&&t.values.set("background","rgba(0,0,0,0)");let r=m=>this.plan.durationUnits.displayTime(m),i=m=>{let T=this.plan.getTaskCompletion(m);return T.ok?T.value.stage!=="unstarted":!1},s={fontSizePx:16,hasText:!0,displayRange:null,displayRangeUsage:"restrict",colors:t,hasTimeline:!0,hasTasks:!0,hasEdges:!0,drawTimeMarkersOnTasks:!0,taskLabel:this.getTaskLabeller(),taskDuration:this.getTaskDurationFunc(),taskEmphasize:this.criticalPath,filterFunc:null,groupByResource:"",highlightedTask:null,selectedTaskIndex:-1,durationDisplay:r,taskIsStarted:i,today:-1},o=Js(e,this.spans,s,this.plan.chart.Vertices.length+2);e.height=o;let a=e.getContext("2d"),l=Xs(null,e,a,this.plan,this.spans,s,null);if(!l.ok)return v(l.error);let h,u,p=new Promise((m,T)=>{h=m,u=T});return e.toBlob(m=>{m===null?u():h(m)},"image/png"),d(await p)}updateTaskPanels(e){this.selectedTask=e,this.selectedTaskPanel.updateSelectedTaskPanel(this,this.selectedTask),this.taskCompletionPanel.update(this,this.selectedTask,this.spans[this.selectedTask]);let t=We(this.plan.chart.Edges);this.dependenciesPanel.setTasksAndIndices(this.plan.chart.Vertices,(t.byDst.get(e)||[]).map(r=>r.i).reverse(),(t.bySrc.get(e)||[]).map(r=>r.j).reverse()),this.dependenciesPanel.classList.toggle("hidden",this.selectedTask===-1)}setSelection(e,t,r=!1){this.selectedTask=e,t&&this.forceFocusOnTask(),this.selectedTask===-1&&(this.focusOnTask=!1),this.paintChart(r),this.updateTaskPanels(this.selectedTask)}onMouseMove(){let e=this.mouseMove.readLocation();e!==null&&this.updateHighlightFromMousePos!==null&&this.updateHighlightFromMousePos(e,"mousemove"),window.requestAnimationFrame(this.onMouseMove.bind(this))}planDefinitionHasBeenChanged(){this.radarScale=null,this.displayRange=null,this.alternateTaskDurations=null,this.recalculateSpansAndCriticalPath(),this.paintChart(),document.dispatchEvent(new CustomEvent("plan-definition-changed"))}getTaskDurationFunc(){return this.alternateTaskDurations!==null?e=>this.alternateTaskDurations[e]:e=>this.plan.chart.Vertices[e].duration}recalculateSpansAndCriticalPath(){let e=[],t=this.plan.getStaticMetricDefinition("Duration").precision.rounder(),r=o=>{let a=this.plan.getTaskCompletion(o);if(!a.ok)return;let l=a.value;switch(l.stage){case"unstarted":return;case"started":return l.start;case"finished":return l.span.start;default:break}},i=o=>{let a=this.plan.getTaskCompletion(o);if(!a.ok)return;let l=a.value;switch(l.stage){case"unstarted":return;case"started":return;case"finished":return l.span.finish;default:break}},s=In(this.plan.chart,this.getTaskDurationFunc(),t,r,i);s.ok?e=s.value:console.error(s),this.spans=e.map(o=>o.early),this.criticalPath=$n(e,t),this.updateTaskPanels(this.selectedTask)}getTaskLabeller(){return e=>`${this.plan.chart.Vertices[e].name}`}dragRangeHandler(e){if(this.radarScale===null)return;let t=this.radarScale.dayRowFromPoint(e.detail.begin),r=this.radarScale.dayRowFromPoint(e.detail.end);this.displayRange=new vn(t.day,r.day),this.paintChart()}toggleRadar(){this.querySelector("radar-parent").classList.toggle("hidden")}setRadar(e){this.querySelector("radar-parent").classList.toggle("hidden",!e)}toggleCriticalPathsOnly(){this.criticalPathsOnly=!this.criticalPathsOnly}forceFocusOnTask(){this.focusOnTask=!0}getToday(){return this.plan.status.stage!=="started"?v(new Error("Plan is not started.")):this.plan.durationUnits.kind()=="Unitless"?v(new Error("Unitless plans have no start date.")):this.plan.durationUnits.dateStringToDuration(new Date().toISOString().slice(0,10))}paintChart(e=!1){let t=new Tn;t.loadFromElement(document.body);let r=null,i=[0,this.plan.chart.Vertices.length-1];if(this.criticalPathsOnly){let S=new Set(this.criticalPath);r=(P,C)=>i.includes(C)?!0:S.has(C)}else if(this.focusOnTask&&this.selectedTask!=-1){let S=new Set;S.add(this.selectedTask);let P=this.spans[this.selectedTask].start,C=this.spans[this.selectedTask].finish;this.plan.chart.Edges.forEach(A=>{A.i===this.selectedTask&&(S.add(A.j),C<this.spans[A.j].finish&&(C=this.spans[A.j].finish)),A.j===this.selectedTask&&(S.add(A.i),P>this.spans[A.i].start&&(P=this.spans[A.i].start))}),this.displayRange=new vn(P-1,C+1),r=(A,$)=>i.includes($)?!0:S.has($)}let s=S=>this.plan.durationUnits.displayTime(S),o=S=>{let P=this.plan.getTaskCompletion(S);return P.ok?P.value.stage!=="unstarted":!1},a=-1,l=this.getToday();l.ok&&(a=l.value);let h={fontSizePx:6,hasText:!1,displayRange:this.displayRange,displayRangeUsage:"highlight",colors:t,hasTimeline:!1,hasTasks:!0,hasEdges:!1,drawTimeMarkersOnTasks:!1,taskLabel:this.getTaskLabeller(),taskDuration:this.getTaskDurationFunc(),taskEmphasize:this.criticalPath,filterFunc:null,groupByResource:this.groupBySelection,highlightedTask:null,selectedTaskIndex:this.selectedTask,durationDisplay:s,taskIsStarted:o,today:a},u={fontSizePx:t.fontSize(),hasText:!0,displayRange:this.displayRange,displayRangeUsage:"restrict",colors:t,hasTimeline:this.topTimeline,hasTasks:!0,hasEdges:!0,drawTimeMarkersOnTasks:!0,taskLabel:this.getTaskLabeller(),taskDuration:this.getTaskDurationFunc(),taskEmphasize:this.criticalPath,filterFunc:r,groupByResource:this.groupBySelection,highlightedTask:1,selectedTaskIndex:this.selectedTask,durationDisplay:s,taskIsStarted:o,today:a},p={fontSizePx:t.fontSize(),hasText:!0,displayRange:this.displayRange,displayRangeUsage:"restrict",colors:t,hasTimeline:!0,hasTasks:!1,hasEdges:!0,drawTimeMarkersOnTasks:!0,taskLabel:this.getTaskLabeller(),taskDuration:this.getTaskDurationFunc(),taskEmphasize:this.criticalPath,filterFunc:r,groupByResource:this.groupBySelection,highlightedTask:null,selectedTaskIndex:this.selectedTask,durationDisplay:s,taskIsStarted:o,today:a},m=this.paintOneChart("#radar",h);if(!m.ok)return;this.radarScale=m.value.scale,this.paintOneChart("#timeline",p);let T=this.paintOneChart("#zoomed",u,"#overlay");if(T.ok&&(this.updateHighlightFromMousePos=T.value.updateHighlightFromMousePos,T.value.selectedTaskLocation!==null&&e)){let S=0;this.focusOnTask||(S=T.value.selectedTaskLocation.y),document.querySelector("chart-parent").scrollTo({top:S,left:0,behavior:"smooth"})}}prepareCanvas(e,t,r,i,s){e.width=t,e.height=r,e.style.width=`${i}px`,e.style.height=`${s}px`;let o=e.getContext("2d");return o.imageSmoothingEnabled=!1,o}paintOneChart(e,t,r=""){let i=this.querySelector(e),s=i.parentElement,o=window.devicePixelRatio,a=s.clientWidth-ic,l=s.clientHeight,h=Math.ceil(a*o),u=Math.ceil(l*o),p=Js(i,this.spans,t,this.plan.chart.Vertices.length+2);u=p,l=p/window.devicePixelRatio;let m=null;r&&(m=document.querySelector(r),this.prepareCanvas(m,h,u,a,l));let T=this.prepareCanvas(i,h,u,a,l);return Xs(s,i,T,this.plan,this.spans,t,m)}};customElements.define("explan-main",to);var no=class extends HTMLElement{explanMain=null;render(){N(this.template(),this)}template(){let[e,t]=Ho();return k`
      <dialog>
        <button @click=${()=>this.generateRandomPlan()}>Generate</button>
        <button @click=${()=>this.explanMain.toggleTopTimeline()}>
          Toggle Top Timeline
        </button>
        <section>
          <h3>Undo</h3>
          <ul>
            ${e.map(r=>k`<li>${r.description}</li>`)}
          </ul>
          <h3>Redo</h3>
          <ul>
            ${t.map(r=>k`<li>${r.description}</li>`)}
          </ul>
        </section>
        <div class="dialog-footer">
          <button @click=${()=>this.cancel()}>Close</button>
        </div>
      </dialog>
    `}generateRandomPlan(){this.explanMain.plan=Ua(),this.explanMain.planDefinitionHasBeenChanged()}cancel(){this.querySelector("dialog").close()}showDialog(e){this.explanMain=e,this.render(),this.querySelector("dialog").showModal()}};customElements.define("developer-panel",no);})();
/*! Bundled license information:

lit-html/lit-html.js:
  (**
   * @license
   * Copyright 2017 Google LLC
   * SPDX-License-Identifier: BSD-3-Clause
   *)

lit-html/directive.js:
  (**
   * @license
   * Copyright 2017 Google LLC
   * SPDX-License-Identifier: BSD-3-Clause
   *)

lit-html/directive-helpers.js:
  (**
   * @license
   * Copyright 2020 Google LLC
   * SPDX-License-Identifier: BSD-3-Clause
   *)

lit-html/directives/live.js:
  (**
   * @license
   * Copyright 2020 Google LLC
   * SPDX-License-Identifier: BSD-3-Clause
   *)

lit-html/directives/unsafe-html.js:
  (**
   * @license
   * Copyright 2017 Google LLC
   * SPDX-License-Identifier: BSD-3-Clause
   *)
*/

    </script>
    
    <div id="extensions"></div>
  </body>
</html>

    